<html>
<head>
  <title>BB-ANS conding</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/603932 (zh-CN, DDL); Windows/10.0.0 (Win64); EDAMVersion=V2;"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 12pt;
    }
  </style>
</head>
<body>
<a name="9240"/>
<h1>BB-ANS conding</h1>
<div>
<table bgcolor="#D4DDE5" border="0">
<tr><td><b>创建时间：</b></td><td><i>2021/12/10 14:52</i></td></tr>
<tr><td><b>更新时间：</b></td><td><i>2022/2/27 17:31</i></td></tr>
</table>
</div>
<br/>

<div><span>
  <div style="--en-clipped-content:article; --en-clipped-source-url:https://medium.com/beyondminds/bb-ans-coding-7b9d512cc841; --en-clipped-source-title:Original text;">
<div><br/></div><div style="min-height: 19442px; font-size: 16px; display: block; min-width: 100%; position: relative;"> <div style="box-sizing:inherit;"><div style="box-sizing:inherit;text-rendering:optimizelegibility;-webkit-font-smoothing:antialiased;color:rgba(0, 0, 0, 0.8);"><div style="box-sizing:inherit;"><div style="box-sizing:inherit;font-family:medium-content-sans-serif-font, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, Oxygen, Ubuntu, Cantarell, &quot;Open Sans&quot;, &quot;Helvetica Neue&quot;, sans-serif;font-weight:400;background-color:rgb(255, 255, 255);"><div style="box-sizing:inherit;background-color:rgb(255, 255, 255);"><div style="box-sizing:inherit;"><div style="box-sizing:inherit;justify-content:space-between;"><div style="box-sizing:inherit;min-width:0px;"><div style="box-sizing:inherit;"><div style="box-sizing:inherit;"><div style="box-sizing:inherit;justify-content:center;"><div style="box-sizing:inherit;min-width:0px;"><div style="box-sizing:inherit;"><div style="box-sizing:inherit;"><div style="box-sizing:inherit;"><div style="box-sizing:inherit;"><div style="box-sizing:inherit;"><div style="box-sizing:inherit;left:0px;position:absolute;top:calc(100vh + 100px);bottom:calc(100vh + 100px);width:10px;pointer-events:none;"></div><div style="box-sizing:inherit;word-break:break-word;overflow-wrap:break-word;"><div style="box-sizing:inherit;"><h1 style="box-sizing:inherit;margin:0px;font-family:sohne, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;color:rgb(41, 41, 41);font-style:normal;font-weight:700;margin-bottom:-0.27em;font-size:32px;margin-top:0.64em;line-height:40px;letter-spacing:-0.016em;">BB-ANS coding</h1></div><blockquote style="box-sizing:inherit;margin:0px;padding-left:30px;"><p style="box-sizing:inherit;margin:0px;color:rgb(117, 117, 117);font-family:sohne, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-style:normal;line-height:40px;letter-spacing:-0.009em;font-weight:300;font-size:28px;margin-bottom:-0.46em;margin-top:1.42em;">“Decoding” the State-of-the-art Coding Method</p></blockquote><div style="box-sizing:inherit;margin:0px;width:100%;clear:both;margin-top:48px;"><img src="BB-ANS conding_files/18qWepzjUW3gw19mXYulFww.png" type="image/png" data-filename="18qWepzjUW3gw19mXYulFww.png" height="725" style="box-sizing:inherit;vertical-align:middle;width:100%;max-width:100%;height:auto;" width="1804"/><div style="box-sizing:inherit;font-weight:400;color:rgb(117, 117, 117);font-family:sohne, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:14px;line-height:20px;margin-right:auto;max-width:728px;margin-top:10px;margin-left:auto;text-align:center;">Images generated by decoding 15%, 30%, 60% and 100% of the compressed data, using <a href="https://medium.com/beyondminds/bb-ans-coding-7b9d512cc841" rel="noopener ugc nofollow" style="box-sizing:inherit;-webkit-tap-highlight-color:transparent;color:inherit;text-decoration:underline;" target="_blank">Integer Discrete Flows</a>. Image from <a href="https://medium.com/beyondminds/bb-ans-coding-7b9d512cc841" rel="noopener ugc nofollow" style="box-sizing:inherit;-webkit-tap-highlight-color:transparent;color:inherit;text-decoration:underline;" target="_blank">IDF</a></div></div><h1 style="box-sizing:inherit;margin:0px;font-family:sohne, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;color:rgb(41, 41, 41);font-style:normal;font-weight:600;margin-bottom:-0.37em;font-size:20px;margin-top:1.9em;line-height:24px;letter-spacing:0px;"><strong style="box-sizing:inherit;font-weight:inherit;">1. Introduction</strong></h1><p style="box-sizing:inherit;margin:0px;font-weight:400;color:rgb(41, 41, 41);word-break:break-word;font-style:normal;margin-bottom:-0.46em;font-family:charter, Georgia, Cambria, &quot;Times New Roman&quot;, Times, serif;font-size:18px;margin-top:0.67em;line-height:28px;letter-spacing:-0.003em;"><em style="box-sizing:inherit;font-style:italic;">I’ve been fascinated by the field of lossless compression for quite some time, and recently got a great opportunity to dive deep into it, to learn about an exciting recent breakthrough. As part of our job, Hai Morgenstern and I started playing around with lossless compression algorithms, and have stumbled across the state-of-the-art algorithm called BB-ANS [</em><a href="https://medium.com/beyondminds/bb-ans-coding-7b9d512cc841" rel="noopener ugc nofollow" style="box-sizing:inherit;-webkit-tap-highlight-color:transparent;color:inherit;text-decoration:underline;" target="_blank"><em style="box-sizing:inherit;font-style:italic;">Townsend 2019a</em></a><em style="box-sizing:inherit;font-style:italic;">]. In several recent works, BB-ANS-based methods have achieved record-breaking compression rates for image compression, up to 30% better than the widely-used lossless compression algorithm, bzip2! [</em><a href="https://medium.com/beyondminds/bb-ans-coding-7b9d512cc841" rel="noopener ugc nofollow" style="box-sizing:inherit;-webkit-tap-highlight-color:transparent;color:inherit;text-decoration:underline;" target="_blank"><em style="box-sizing:inherit;font-style:italic;">Townsend 2019a</em></a><em style="box-sizing:inherit;font-style:italic;">, </em><a href="https://medium.com/beyondminds/bb-ans-coding-7b9d512cc841" rel="noopener ugc nofollow" style="box-sizing:inherit;-webkit-tap-highlight-color:transparent;color:inherit;text-decoration:underline;" target="_blank"><em style="box-sizing:inherit;font-style:italic;">Kingma 2019</em></a><em style="box-sizing:inherit;font-style:italic;">, </em><a href="https://medium.com/beyondminds/bb-ans-coding-7b9d512cc841" rel="noopener ugc nofollow" style="box-sizing:inherit;-webkit-tap-highlight-color:transparent;color:inherit;text-decoration:underline;" target="_blank"><em style="box-sizing:inherit;font-style:italic;">Ho 2019</em></a><em style="box-sizing:inherit;font-style:italic;">]</em></p><p style="box-sizing:inherit;margin:0px;font-weight:400;color:rgb(41, 41, 41);word-break:break-word;font-style:normal;margin-bottom:-0.46em;font-family:charter, Georgia, Cambria, &quot;Times New Roman&quot;, Times, serif;font-size:18px;line-height:28px;letter-spacing:-0.003em;margin-top:1.56em;"><em style="box-sizing:inherit;font-style:italic;">Neural networks are at the heart of this breakthrough, as their ability to capture complex relationships in real-world data enables this new method to be used for a wide variety of applications (such as images, videos, and more). Though BB-ANS was hard to grasp at first, it comprises several algorithms, which are highly theoretical and some counter-intuitive, which interact brilliantly. After an extensive survey based on seminal papers that date back to the 90’s(!), we are happy to share our understanding of this elegant algorithm and to try to give the complete picture using pseudo-code explanations and simplifying schematic diagrams.</em></p><div style="box-sizing:inherit;margin:0px;margin-left:auto;margin-right:auto;clear:both;margin-top:40px;"><div style="box-sizing:inherit;margin-left:auto;margin-right:auto;max-width:640px;"><img src="BB-ANS conding_files/1Lkba846cqTYBXXgU0ytiqQ.png" type="image/png" data-filename="1Lkba846cqTYBXXgU0ytiqQ.png" height="300" style="box-sizing:inherit;vertical-align:middle;width:100%;max-width:100%;height:auto;" width="640"/></div><div style="box-sizing:inherit;font-weight:400;color:rgb(117, 117, 117);font-family:sohne, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:14px;line-height:20px;margin-right:auto;max-width:728px;margin-top:10px;margin-left:auto;text-align:center;">Demonstration of lossless and lossy image compression. Image from <a href="https://medium.com/beyondminds/bb-ans-coding-7b9d512cc841" rel="noopener ugc nofollow" style="box-sizing:inherit;-webkit-tap-highlight-color:transparent;color:inherit;text-decoration:underline;" target="_blank">Bangtan</a></div></div><p style="box-sizing:inherit;margin:0px;font-weight:400;color:rgb(41, 41, 41);word-break:break-word;font-style:normal;margin-bottom:-0.46em;font-family:charter, Georgia, Cambria, &quot;Times New Roman&quot;, Times, serif;font-size:18px;line-height:28px;letter-spacing:-0.003em;margin-top:1.56em;">The rest of the blog is arranged as follows. First, some background regarding entropy coding, and in particular Huffman coding, is provided. This is followed by the algorithms that construct BB-ANS [<a href="https://medium.com/beyondminds/bb-ans-coding-7b9d512cc841" rel="noopener ugc nofollow" style="box-sizing:inherit;-webkit-tap-highlight-color:transparent;color:inherit;text-decoration:underline;" target="_blank">Townsend 2019a</a>]; namely, ranged asymmetric numeral systems (rANS) [<a href="https://medium.com/beyondminds/bb-ans-coding-7b9d512cc841" rel="noopener ugc nofollow" style="box-sizing:inherit;-webkit-tap-highlight-color:transparent;color:inherit;text-decoration:underline;" target="_blank">Duda 2013</a>], streaming rANS, the bits-back (BB) argument [<a href="https://medium.com/beyondminds/bb-ans-coding-7b9d512cc841" rel="noopener ugc nofollow" style="box-sizing:inherit;-webkit-tap-highlight-color:transparent;color:inherit;text-decoration:underline;" target="_blank">Frey and Hinton 1997</a>], and chaining BB [<a href="https://medium.com/beyondminds/bb-ans-coding-7b9d512cc841" rel="noopener ugc nofollow" style="box-sizing:inherit;-webkit-tap-highlight-color:transparent;color:inherit;text-decoration:underline;" target="_blank">Frey 1998</a>]. In particular, chaining BB is demonstrated with an rANS stream, which gives the ultimate BB-ANS [<a href="https://medium.com/beyondminds/bb-ans-coding-7b9d512cc841" rel="noopener ugc nofollow" style="box-sizing:inherit;-webkit-tap-highlight-color:transparent;color:inherit;text-decoration:underline;" target="_blank">Townsend 2019a</a>].</p><span style="display:block;clear:both;"></span></div><div style="box-sizing:inherit;display:flex;justify-content:center;margin-top:32px;padding-top:24px;margin-bottom:14px;padding-bottom:10px;"><span style="box-sizing:inherit;display:inline-block;margin-right:20px;border-radius:50%;background-color:rgb(8, 8, 8);height:3px;width:3px;"></span><span style="box-sizing:inherit;display:inline-block;margin-right:20px;border-radius:50%;background-color:rgb(8, 8, 8);height:3px;width:3px;"></span><span style="box-sizing:inherit;display:inline-block;border-radius:50%;background-color:rgb(8, 8, 8);height:3px;width:3px;"></span></div><div style="box-sizing:inherit;word-break:break-word;overflow-wrap:break-word;"><h1 style="box-sizing:inherit;margin:0px;font-family:sohne, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;color:rgb(41, 41, 41);font-style:normal;font-weight:600;margin-bottom:-0.37em;font-size:20px;line-height:24px;letter-spacing:0px;margin-top:1.5em;"><strong style="box-sizing:inherit;font-weight:inherit;">2. Entropy coding</strong></h1><p style="box-sizing:inherit;margin:0px;font-weight:400;color:rgb(41, 41, 41);word-break:break-word;font-style:normal;margin-bottom:-0.46em;font-family:charter, Georgia, Cambria, &quot;Times New Roman&quot;, Times, serif;font-size:18px;margin-top:0.67em;line-height:28px;letter-spacing:-0.003em;">Lossless compression methods aim to compress files (such as images, videos, text ) to the minimal amount of bits, without losing any information in the process. Entropy coding is a lossless compression scheme, which aims to achieve this goal by utilizing the probabilities of the objects we wish to compress (known as <strong style="box-sizing:inherit;font-weight:700;font-family:charter, Georgia, Cambria, &quot;Times New Roman&quot;, Times, serif;">“symbols”</strong>).</p><div style="box-sizing:inherit;margin:0px;margin-left:auto;margin-right:auto;clear:both;margin-top:40px;"><div style="box-sizing:inherit;position:relative;width:100%;cursor:zoom-in;z-index:auto;transition:transform 300ms cubic-bezier(0.2, 0, 0.2, 1) 0s;"><div style="box-sizing:inherit;margin-left:auto;margin-right:auto;max-width:482px;"><img src="BB-ANS conding_files/1xkU992crBJWnY0inxKqstg.png" type="image/png" data-filename="1xkU992crBJWnY0inxKqstg.png" height="504" style="box-sizing:inherit;vertical-align:middle;width:100%;max-width:100%;height:auto;" width="482"/></div></div><div style="box-sizing:inherit;font-weight:400;color:rgb(117, 117, 117);font-family:sohne, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:14px;line-height:20px;margin-right:auto;max-width:728px;margin-top:10px;margin-left:auto;text-align:center;"><strong style="box-sizing:inherit;font-family:sohne, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-weight:600;">Figure 1: </strong>Assignment of binary identifiers for different letters, using a Huffman tree. Image from <a href="https://medium.com/beyondminds/bb-ans-coding-7b9d512cc841" rel="noopener ugc nofollow" style="box-sizing:inherit;-webkit-tap-highlight-color:transparent;color:inherit;text-decoration:underline;" target="_blank">GatVidyalay</a></div></div><p style="box-sizing:inherit;margin:0px;font-weight:400;color:rgb(41, 41, 41);word-break:break-word;font-style:normal;margin-bottom:-0.46em;font-family:charter, Georgia, Cambria, &quot;Times New Roman&quot;, Times, serif;font-size:18px;line-height:28px;letter-spacing:-0.003em;margin-top:1.56em;">The symbols to be encoded (or decoded), are from a finite set of symbols <code style="box-sizing:inherit;font-weight:400;background-color:rgb(242, 242, 242);padding:2px 4px;font-size:75%;font-family:Menlo, Monaco, &quot;Courier New&quot;, Courier, monospace;">sᵢ</code>, and occur with a known probability. Compression performance is typically evaluated based on two metrics: <strong style="box-sizing:inherit;font-weight:700;font-family:charter, Georgia, Cambria, &quot;Times New Roman&quot;, Times, serif;">compression rate </strong>and <strong style="box-sizing:inherit;font-weight:700;font-family:charter, Georgia, Cambria, &quot;Times New Roman&quot;, Times, serif;">compression speed</strong>, which we will use for comparing the different methods surveyed in this blog. The optimal compression rate that any entropy coding method can achieve is known as the Shanon entropy of the data, which can be calculated from the probabilities of the symbols. (check out <a href="https://medium.com/beyondminds/bb-ans-coding-7b9d512cc841" rel="noopener" style="box-sizing:inherit;-webkit-tap-highlight-color:transparent;color:inherit;text-decoration:underline;">this blog</a> for more details). Amongst entropy coding methods, in Huffman coding, a well-known method, each symbol in a sequence is encoded individually, using a prefix-free coding scheme. Encoding each symbol at a time renders Huffman the entropy method with the highest compression speed. However, the prefix-free coding scheme also leads to <strong style="box-sizing:inherit;font-weight:700;font-family:charter, Georgia, Cambria, &quot;Times New Roman&quot;, Times, serif;">sub-optimal</strong> compression rates when the probabilities of occurrence of some symbols are <strong style="box-sizing:inherit;font-weight:700;font-family:charter, Georgia, Cambria, &quot;Times New Roman&quot;, Times, serif;">not inverse powers of two</strong>. This is opposed to methods that encode symbols into a state, such as rANS coding, presented in the next section.</p><span style="display:block;clear:both;"></span></div><div style="box-sizing:inherit;display:flex;justify-content:center;margin-top:32px;padding-top:24px;margin-bottom:14px;padding-bottom:10px;"><span style="box-sizing:inherit;display:inline-block;margin-right:20px;border-radius:50%;background-color:rgb(8, 8, 8);height:3px;width:3px;"></span><span style="box-sizing:inherit;display:inline-block;margin-right:20px;border-radius:50%;background-color:rgb(8, 8, 8);height:3px;width:3px;"></span><span style="box-sizing:inherit;display:inline-block;border-radius:50%;background-color:rgb(8, 8, 8);height:3px;width:3px;"></span></div><div style="box-sizing:inherit;word-break:break-word;overflow-wrap:break-word;"><h1 style="box-sizing:inherit;margin:0px;font-family:sohne, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;color:rgb(41, 41, 41);font-style:normal;font-weight:600;margin-bottom:-0.37em;font-size:20px;line-height:24px;letter-spacing:0px;margin-top:1.5em;"><strong style="box-sizing:inherit;font-weight:inherit;">3. rANS coding</strong></h1><p style="box-sizing:inherit;margin:0px;font-weight:400;color:rgb(41, 41, 41);word-break:break-word;font-style:normal;margin-bottom:-0.46em;font-family:charter, Georgia, Cambria, &quot;Times New Roman&quot;, Times, serif;font-size:18px;margin-top:0.67em;line-height:28px;letter-spacing:-0.003em;">A recent entropy-based method for coding, Asymmetric Numeral Systems (ANS), has been proposed by Jarek Duda in 2009 [<a href="https://medium.com/beyondminds/bb-ans-coding-7b9d512cc841" rel="noopener ugc nofollow" style="box-sizing:inherit;-webkit-tap-highlight-color:transparent;color:inherit;text-decoration:underline;" target="_blank">Duda 2013</a>]. This method, which is at the heart of BB-ANS, achieves better compression rates than Huffman and at comparable speeds! In this blog, we will focus on ranged ANS (rANS), covered well in reference [<a href="https://medium.com/beyondminds/bb-ans-coding-7b9d512cc841" rel="noopener ugc nofollow" style="box-sizing:inherit;-webkit-tap-highlight-color:transparent;color:inherit;text-decoration:underline;" target="_blank">Tatwawadi 2017</a> ]. The key idea of rANS coding is to model a sequence of symbols as a state <code style="box-sizing:inherit;font-weight:400;background-color:rgb(242, 242, 242);padding:2px 4px;font-size:75%;font-family:Menlo, Monaco, &quot;Courier New&quot;, Courier, monospace;">x</code>, which is expressed as a <strong style="box-sizing:inherit;font-weight:700;font-family:charter, Georgia, Cambria, &quot;Times New Roman&quot;, Times, serif;">single integer number</strong>. This state is updated every time a new symbol is encoded/decoded using computationally efficient operations (discussed below), making it a desirable coding scheme for deployment in real-world applications.</p><div style="box-sizing:inherit;margin:0px;margin-left:auto;margin-right:auto;clear:both;margin-top:40px;"><div style="box-sizing:inherit;position:relative;width:100%;cursor:zoom-in;z-index:auto;transition:transform 300ms cubic-bezier(0.2, 0, 0.2, 1) 0s;"><div style="box-sizing:inherit;margin-left:auto;margin-right:auto;max-width:918px;"><img src="BB-ANS conding_files/1KWd4_Ls85PT70pt0aor5iw.png" type="image/png" data-filename="1KWd4_Ls85PT70pt0aor5iw.png" height="243" style="box-sizing:inherit;vertical-align:middle;width:100%;max-width:100%;height:auto;" width="700"/></div></div><div style="box-sizing:inherit;font-weight:400;color:rgb(117, 117, 117);font-family:sohne, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:14px;line-height:20px;margin-right:auto;max-width:728px;margin-top:10px;margin-left:auto;text-align:center;"><strong style="box-sizing:inherit;font-family:sohne, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-weight:600;">Figure 2:</strong> Illustration of changes in message length, when encoding/decoding symbols. Image from <a href="https://medium.com/beyondminds/bb-ans-coding-7b9d512cc841" rel="noopener ugc nofollow" style="box-sizing:inherit;-webkit-tap-highlight-color:transparent;color:inherit;text-decoration:underline;" target="_blank">Bit-Swap</a></div></div><p style="box-sizing:inherit;margin:0px;font-weight:400;color:rgb(41, 41, 41);word-break:break-word;font-style:normal;margin-bottom:-0.46em;font-family:charter, Georgia, Cambria, &quot;Times New Roman&quot;, Times, serif;font-size:18px;line-height:28px;letter-spacing:-0.003em;margin-top:1.56em;">In rANS coding, a sequence of <code style="box-sizing:inherit;font-weight:400;background-color:rgb(242, 242, 242);padding:2px 4px;font-size:75%;font-family:Menlo, Monaco, &quot;Courier New&quot;, Courier, monospace;">N</code> symbols,<em style="box-sizing:inherit;font-style:italic;"> </em><code style="box-sizing:inherit;font-weight:400;background-color:rgb(242, 242, 242);padding:2px 4px;font-size:75%;font-family:Menlo, Monaco, &quot;Courier New&quot;, Courier, monospace;">s₁, s₂, …, sₙ</code>, is encoded sequentially into the state <code style="box-sizing:inherit;font-weight:400;background-color:rgb(242, 242, 242);padding:2px 4px;font-size:75%;font-family:Menlo, Monaco, &quot;Courier New&quot;, Courier, monospace;">x</code>, starting from an initial state <code style="box-sizing:inherit;font-weight:400;background-color:rgb(242, 242, 242);padding:2px 4px;font-size:75%;font-family:Menlo, Monaco, &quot;Courier New&quot;, Courier, monospace;">x₀</code>. This initial state is typically set as<strong style="box-sizing:inherit;font-weight:700;font-family:charter, Georgia, Cambria, &quot;Times New Roman&quot;, Times, serif;"> </strong><code style="box-sizing:inherit;font-weight:400;background-color:rgb(242, 242, 242);padding:2px 4px;font-size:75%;font-family:Menlo, Monaco, &quot;Courier New&quot;, Courier, monospace;">x₀ = 0</code>,<strong style="box-sizing:inherit;font-weight:700;font-family:charter, Georgia, Cambria, &quot;Times New Roman&quot;, Times, serif;"> </strong>and can be set differently to encrypt communicated data (please refer to [<a href="https://medium.com/beyondminds/bb-ans-coding-7b9d512cc841" rel="noopener ugc nofollow" style="box-sizing:inherit;-webkit-tap-highlight-color:transparent;color:inherit;text-decoration:underline;" target="_blank">Duda 2013</a>] for more details). The probability of each symbol, <code style="box-sizing:inherit;font-weight:400;background-color:rgb(242, 242, 242);padding:2px 4px;font-size:75%;font-family:Menlo, Monaco, &quot;Courier New&quot;, Courier, monospace;">p(s)</code>, is <strong style="box-sizing:inherit;font-weight:700;font-family:charter, Georgia, Cambria, &quot;Times New Roman&quot;, Times, serif;">assumed to be i.i.d</strong>, and, in this setting, is known to both the sender and the receiver. <strong style="box-sizing:inherit;font-weight:700;font-family:charter, Georgia, Cambria, &quot;Times New Roman&quot;, Times, serif;">Algorithm 1</strong> demonstrates the encoding of the i’th symbol, <code style="box-sizing:inherit;font-weight:400;background-color:rgb(242, 242, 242);padding:2px 4px;font-size:75%;font-family:Menlo, Monaco, &quot;Courier New&quot;, Courier, monospace;">sᵢ</code>, to the state at the previous discrete index <code style="box-sizing:inherit;font-weight:400;background-color:rgb(242, 242, 242);padding:2px 4px;font-size:75%;font-family:Menlo, Monaco, &quot;Courier New&quot;, Courier, monospace;">i−1</code>,<code style="box-sizing:inherit;font-weight:400;background-color:rgb(242, 242, 242);padding:2px 4px;font-size:75%;font-family:Menlo, Monaco, &quot;Courier New&quot;, Courier, monospace;"> x_{i−1}</code>, resulting in an updated state, <code style="box-sizing:inherit;font-weight:400;background-color:rgb(242, 242, 242);padding:2px 4px;font-size:75%;font-family:Menlo, Monaco, &quot;Courier New&quot;, Courier, monospace;">xᵢ</code>.</p><div style="box-sizing:inherit;margin:0px;margin-left:auto;margin-right:auto;clear:both;margin-top:40px;"><div style="box-sizing:inherit;position:relative;width:100%;cursor:zoom-in;z-index:auto;transition:transform 300ms cubic-bezier(0.2, 0, 0.2, 1) 0s;"><div style="box-sizing:inherit;margin-left:auto;margin-right:auto;max-width:5815px;"><img src="BB-ANS conding_files/1PROqdWfPwEaWsir-dQGH2g.png" type="image/png" data-filename="1PROqdWfPwEaWsir-dQGH2g.png" height="232" style="box-sizing:inherit;vertical-align:middle;width:100%;max-width:100%;height:auto;" width="700"/></div></div></div><p style="box-sizing:inherit;margin:0px;font-weight:400;color:rgb(41, 41, 41);word-break:break-word;font-style:normal;margin-bottom:-0.46em;font-family:charter, Georgia, Cambria, &quot;Times New Roman&quot;, Times, serif;font-size:18px;line-height:28px;letter-spacing:-0.003em;margin-top:1.56em;">As this coding method is entropy-based, <code style="box-sizing:inherit;font-weight:400;background-color:rgb(242, 242, 242);padding:2px 4px;font-size:75%;font-family:Menlo, Monaco, &quot;Courier New&quot;, Courier, monospace;">p(s)</code> is used for constructing the encoding operation <code style="box-sizing:inherit;font-weight:400;background-color:rgb(242, 242, 242);padding:2px 4px;font-size:75%;font-family:Menlo, Monaco, &quot;Courier New&quot;, Courier, monospace;">C</code>.</p><p style="box-sizing:inherit;margin:0px;font-weight:400;color:rgb(41, 41, 41);word-break:break-word;font-style:normal;margin-bottom:-0.46em;font-family:charter, Georgia, Cambria, &quot;Times New Roman&quot;, Times, serif;font-size:18px;line-height:28px;letter-spacing:-0.003em;margin-top:1.56em;">Decoding a symbol from state <em style="box-sizing:inherit;font-style:italic;">xᵢ </em>gives as an output both<em style="box-sizing:inherit;font-style:italic;"> </em><code style="box-sizing:inherit;font-weight:400;background-color:rgb(242, 242, 242);padding:2px 4px;font-size:75%;font-family:Menlo, Monaco, &quot;Courier New&quot;, Courier, monospace;">sᵢ</code> and the previous state, <code style="box-sizing:inherit;font-weight:400;background-color:rgb(242, 242, 242);padding:2px 4px;font-size:75%;font-family:Menlo, Monaco, &quot;Courier New&quot;, Courier, monospace;">x_{i−1}</code>, as described in <strong style="box-sizing:inherit;font-weight:700;font-family:charter, Georgia, Cambria, &quot;Times New Roman&quot;, Times, serif;">Algorithm 2</strong>.</p><div style="box-sizing:inherit;margin:0px;margin-left:auto;margin-right:auto;clear:both;margin-top:40px;"><div style="box-sizing:inherit;position:relative;width:100%;cursor:zoom-in;z-index:auto;transition:transform 300ms cubic-bezier(0.2, 0, 0.2, 1) 0s;"><div style="box-sizing:inherit;margin-left:auto;margin-right:auto;max-width:4549px;"><img src="BB-ANS conding_files/1gHcmSgc3I6DjmqRhHwAcSQ.png" type="image/png" data-filename="1gHcmSgc3I6DjmqRhHwAcSQ.png" height="235" style="box-sizing:inherit;vertical-align:middle;width:100%;max-width:100%;height:auto;" width="700"/></div></div></div><p style="box-sizing:inherit;margin:0px;font-weight:400;color:rgb(41, 41, 41);word-break:break-word;font-style:normal;margin-bottom:-0.46em;font-family:charter, Georgia, Cambria, &quot;Times New Roman&quot;, Times, serif;font-size:18px;line-height:28px;letter-spacing:-0.003em;margin-top:1.56em;">As for <code style="box-sizing:inherit;font-weight:400;background-color:rgb(242, 242, 242);padding:2px 4px;font-size:75%;font-family:Menlo, Monaco, &quot;Courier New&quot;, Courier, monospace;">C</code>, the decoding operation <code style="box-sizing:inherit;font-weight:400;background-color:rgb(242, 242, 242);padding:2px 4px;font-size:75%;font-family:Menlo, Monaco, &quot;Courier New&quot;, Courier, monospace;">D</code> is also based on <code style="box-sizing:inherit;font-weight:400;background-color:rgb(242, 242, 242);padding:2px 4px;font-size:75%;font-family:Menlo, Monaco, &quot;Courier New&quot;, Courier, monospace;">p(s)</code>.</p><p style="box-sizing:inherit;margin:0px;font-weight:400;color:rgb(41, 41, 41);word-break:break-word;font-style:normal;margin-bottom:-0.46em;font-family:charter, Georgia, Cambria, &quot;Times New Roman&quot;, Times, serif;font-size:18px;line-height:28px;letter-spacing:-0.003em;margin-top:1.56em;">To conclude, this section presented the rANS coding and decoding algorithms. rANS coding scheme achieves close to optimal compression rates, and compression speeds that are slightly lower than Huffman coding. Moreover, the exact manner of how <code style="box-sizing:inherit;font-weight:400;background-color:rgb(242, 242, 242);padding:2px 4px;font-size:75%;font-family:Menlo, Monaco, &quot;Courier New&quot;, Courier, monospace;">C</code> and <code style="box-sizing:inherit;font-weight:400;background-color:rgb(242, 242, 242);padding:2px 4px;font-size:75%;font-family:Menlo, Monaco, &quot;Courier New&quot;, Courier, monospace;">D</code> perform coding and decoding, while interesting, is not required for understanding the construction of BB-ANS, and therefore not covered in this blog. Please refer to [<a href="https://medium.com/beyondminds/bb-ans-coding-7b9d512cc841" rel="noopener ugc nofollow" style="box-sizing:inherit;-webkit-tap-highlight-color:transparent;color:inherit;text-decoration:underline;" target="_blank">Duda 2013</a>], [<a href="https://medium.com/beyondminds/bb-ans-coding-7b9d512cc841" rel="noopener ugc nofollow" style="box-sizing:inherit;-webkit-tap-highlight-color:transparent;color:inherit;text-decoration:underline;" target="_blank">Tatwawadi 2017</a> ] for more details.</p><h2 style="box-sizing:inherit;margin:0px;font-family:sohne, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;color:rgb(41, 41, 41);font-style:normal;font-weight:600;margin-bottom:-0.31em;letter-spacing:0px;font-size:16px;line-height:20px;margin-top:2.07em;">More about rANS</h2><p style="box-sizing:inherit;margin:0px;font-weight:400;color:rgb(41, 41, 41);word-break:break-word;font-style:normal;margin-bottom:-0.46em;font-family:charter, Georgia, Cambria, &quot;Times New Roman&quot;, Times, serif;font-size:18px;margin-top:0.67em;line-height:28px;letter-spacing:-0.003em;">Note also that:</p><p style="box-sizing:inherit;margin:0px;font-weight:400;color:rgb(41, 41, 41);word-break:break-word;font-style:normal;margin-bottom:-0.46em;font-family:charter, Georgia, Cambria, &quot;Times New Roman&quot;, Times, serif;font-size:18px;line-height:28px;letter-spacing:-0.003em;margin-top:1.56em;">(i) Though <code style="box-sizing:inherit;font-weight:400;background-color:rgb(242, 242, 242);padding:2px 4px;font-size:75%;font-family:Menlo, Monaco, &quot;Courier New&quot;, Courier, monospace;">p(s)</code> is typically known to both sender and receiver, it is written explicitly as an input argument in <strong style="box-sizing:inherit;font-weight:700;font-family:charter, Georgia, Cambria, &quot;Times New Roman&quot;, Times, serif;">Algorithms 1</strong> and <strong style="box-sizing:inherit;font-weight:700;font-family:charter, Georgia, Cambria, &quot;Times New Roman&quot;, Times, serif;">2</strong>. This is because different probabilities will be used for encoding and decoding as part of the BB-ANS algorithm, as will be apparent soon.</p><p style="box-sizing:inherit;margin:0px;font-weight:400;color:rgb(41, 41, 41);word-break:break-word;font-style:normal;margin-bottom:-0.46em;font-family:charter, Georgia, Cambria, &quot;Times New Roman&quot;, Times, serif;font-size:18px;line-height:28px;letter-spacing:-0.003em;margin-top:1.56em;">(ii) The encoded message length in this case is given by:</p><p style="box-sizing:inherit;margin:0px;font-weight:400;color:rgb(41, 41, 41);word-break:break-word;font-style:normal;margin-bottom:-0.46em;font-family:charter, Georgia, Cambria, &quot;Times New Roman&quot;, Times, serif;font-size:18px;line-height:28px;letter-spacing:-0.003em;margin-top:1.56em;"><code style="box-sizing:inherit;font-weight:400;background-color:rgb(242, 242, 242);padding:2px 4px;font-size:75%;font-family:Menlo, Monaco, &quot;Courier New&quot;, Courier, monospace;">L = len(binary(x))</code></p><p style="box-sizing:inherit;margin:0px;font-weight:400;color:rgb(41, 41, 41);word-break:break-word;font-style:normal;margin-bottom:-0.46em;font-family:charter, Georgia, Cambria, &quot;Times New Roman&quot;, Times, serif;font-size:18px;line-height:28px;letter-spacing:-0.003em;margin-top:1.56em;">For individual symbols, the expected length is:</p><p style="box-sizing:inherit;margin:0px;font-weight:400;color:rgb(41, 41, 41);word-break:break-word;font-style:normal;margin-bottom:-0.46em;font-family:charter, Georgia, Cambria, &quot;Times New Roman&quot;, Times, serif;font-size:18px;line-height:28px;letter-spacing:-0.003em;margin-top:1.56em;"><code style="box-sizing:inherit;font-weight:400;background-color:rgb(242, 242, 242);padding:2px 4px;font-size:75%;font-family:Menlo, Monaco, &quot;Courier New&quot;, Courier, monospace;">L/N ≈ −E[log(p(s))]</code></p><p style="box-sizing:inherit;margin:0px;font-weight:400;color:rgb(41, 41, 41);word-break:break-word;font-style:normal;margin-bottom:-0.46em;font-family:charter, Georgia, Cambria, &quot;Times New Roman&quot;, Times, serif;font-size:18px;line-height:28px;letter-spacing:-0.003em;margin-top:1.56em;">This means that the rANS coding scheme is indeed <strong style="box-sizing:inherit;font-weight:700;font-family:charter, Georgia, Cambria, &quot;Times New Roman&quot;, Times, serif;">close to optimal</strong>.</p><p style="box-sizing:inherit;margin:0px;font-weight:400;color:rgb(41, 41, 41);word-break:break-word;font-style:normal;margin-bottom:-0.46em;font-family:charter, Georgia, Cambria, &quot;Times New Roman&quot;, Times, serif;font-size:18px;line-height:28px;letter-spacing:-0.003em;margin-top:1.56em;">(iii) Symbols are encoded and then decoded in a last-in-first-out (LIFO) manner. The LIFO processing nature renders rANS to be compatible with BB-ANS, as demonstrated in a later section. This is opposed to a related entropy-coding method, arithmetic coding, that, while achieving compression rates similar to rANS (yet at slower compression speeds), is not compatible with BB-ANS as it employs a first-in-first-out (FIFO) coding scheme [<a href="https://medium.com/beyondminds/bb-ans-coding-7b9d512cc841" rel="noopener ugc nofollow" style="box-sizing:inherit;-webkit-tap-highlight-color:transparent;color:inherit;text-decoration:underline;" target="_blank">Witten 1987</a>].</p><div style="box-sizing:inherit;margin:0px;margin-left:auto;margin-right:auto;clear:both;margin-top:40px;"><div style="box-sizing:inherit;position:relative;width:100%;cursor:zoom-in;z-index:auto;transition:transform 300ms cubic-bezier(0.2, 0, 0.2, 1) 0s;"><div style="box-sizing:inherit;margin-left:auto;margin-right:auto;max-width:5472px;"><img src="BB-ANS conding_files/1-epDKh4om1nhGYKdJJN_qw.jpeg" type="image/jpeg" data-filename="1-epDKh4om1nhGYKdJJN_qw.jpeg" height="467" style="box-sizing:inherit;vertical-align:middle;width:100%;max-width:100%;height:auto;" width="700"/></div></div><div style="box-sizing:inherit;font-weight:400;color:rgb(117, 117, 117);font-family:sohne, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:14px;line-height:20px;margin-right:auto;max-width:728px;margin-top:10px;margin-left:auto;text-align:center;">Compressed paper. Image by JJ Ying on Unisplash</div></div><p style="box-sizing:inherit;margin:0px;font-weight:400;color:rgb(41, 41, 41);word-break:break-word;font-style:normal;margin-bottom:-0.46em;font-family:charter, Georgia, Cambria, &quot;Times New Roman&quot;, Times, serif;font-size:18px;line-height:28px;letter-spacing:-0.003em;margin-top:1.56em;">Though rANS coding achieves close to optimal compression rates, it is not compatible with finite-bit digital representations; <strong style="box-sizing:inherit;font-weight:700;font-family:charter, Georgia, Cambria, &quot;Times New Roman&quot;, Times, serif;">for long sequences of symbols, the state may eventually become too large</strong> to be represented using a finite-bit representation, which leads to <strong style="box-sizing:inherit;font-weight:700;font-family:charter, Georgia, Cambria, &quot;Times New Roman&quot;, Times, serif;">overflow</strong>. To handle this issue, streaming rANS coding [<a href="https://medium.com/beyondminds/bb-ans-coding-7b9d512cc841" rel="noopener ugc nofollow" style="box-sizing:inherit;-webkit-tap-highlight-color:transparent;color:inherit;text-decoration:underline;" target="_blank">Duda 2013</a>], [<a href="https://medium.com/beyondminds/bb-ans-coding-7b9d512cc841" rel="noopener ugc nofollow" style="box-sizing:inherit;-webkit-tap-highlight-color:transparent;color:inherit;text-decoration:underline;" target="_blank">Tatwawadi 2017 </a>] has been proposed, and is presented in the next section.</p><span style="display:block;clear:both;"></span></div><div style="box-sizing:inherit;display:flex;justify-content:center;margin-top:32px;padding-top:24px;margin-bottom:14px;padding-bottom:10px;"><span style="box-sizing:inherit;display:inline-block;margin-right:20px;border-radius:50%;background-color:rgb(8, 8, 8);height:3px;width:3px;"></span><span style="box-sizing:inherit;display:inline-block;margin-right:20px;border-radius:50%;background-color:rgb(8, 8, 8);height:3px;width:3px;"></span><span style="box-sizing:inherit;display:inline-block;border-radius:50%;background-color:rgb(8, 8, 8);height:3px;width:3px;"></span></div><div style="box-sizing:inherit;word-break:break-word;overflow-wrap:break-word;"><h1 style="box-sizing:inherit;margin:0px;font-family:sohne, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;color:rgb(41, 41, 41);font-style:normal;font-weight:600;margin-bottom:-0.37em;font-size:20px;line-height:24px;letter-spacing:0px;margin-top:1.5em;"><strong style="box-sizing:inherit;font-weight:inherit;">4. Streaming rANS coding</strong></h1><p style="box-sizing:inherit;margin:0px;font-weight:400;color:rgb(41, 41, 41);word-break:break-word;font-style:normal;margin-bottom:-0.46em;font-family:charter, Georgia, Cambria, &quot;Times New Roman&quot;, Times, serif;font-size:18px;margin-top:0.67em;line-height:28px;letter-spacing:-0.003em;">Streaming rANS avoids the problem of overflow by maintaining the rANS state within a predefined “decodable” range of values. This is done by systematically transferring bits from a binary representation of a state to a stream of bits, such that the new state representation can facilitate coding or decoding of additional symbols without overflow. In particular, the state <code style="box-sizing:inherit;font-weight:400;background-color:rgb(242, 242, 242);padding:2px 4px;font-size:75%;font-family:Menlo, Monaco, &quot;Courier New&quot;, Courier, monospace;">xᵢ</code> in the standard rANS coding (see <strong style="box-sizing:inherit;font-weight:700;font-family:charter, Georgia, Cambria, &quot;Times New Roman&quot;, Times, serif;">Algorithm 1</strong>), is now represented by a bit stack, <code style="box-sizing:inherit;font-weight:400;background-color:rgb(242, 242, 242);padding:2px 4px;font-size:75%;font-family:Menlo, Monaco, &quot;Courier New&quot;, Courier, monospace;">Bᵢ</code>, with <code style="box-sizing:inherit;font-weight:400;background-color:rgb(242, 242, 242);padding:2px 4px;font-size:75%;font-family:Menlo, Monaco, &quot;Courier New&quot;, Courier, monospace;">B₀</code> initialized as an empty bit stack.</p><p style="box-sizing:inherit;margin:0px;font-weight:400;color:rgb(41, 41, 41);word-break:break-word;font-style:normal;margin-bottom:-0.46em;font-family:charter, Georgia, Cambria, &quot;Times New Roman&quot;, Times, serif;font-size:18px;line-height:28px;letter-spacing:-0.003em;margin-top:1.56em;">To encode a new symbol, <code style="box-sizing:inherit;font-weight:400;background-color:rgb(242, 242, 242);padding:2px 4px;font-size:75%;font-family:Menlo, Monaco, &quot;Courier New&quot;, Courier, monospace;">sᵢ</code>, the state vector is initially extracted from <code style="box-sizing:inherit;font-weight:400;background-color:rgb(242, 242, 242);padding:2px 4px;font-size:75%;font-family:Menlo, Monaco, &quot;Courier New&quot;, Courier, monospace;">B_{i−1}</code><em style="box-sizing:inherit;font-style:italic;"> </em>and then modified in iterations, so that encoding <code style="box-sizing:inherit;font-weight:400;background-color:rgb(242, 242, 242);padding:2px 4px;font-size:75%;font-family:Menlo, Monaco, &quot;Courier New&quot;, Courier, monospace;">sᵢ</code> will not lead to an overflow in the modified state representation. <strong style="box-sizing:inherit;font-weight:700;font-family:charter, Georgia, Cambria, &quot;Times New Roman&quot;, Times, serif;">Algorithm 3</strong> presents the encoding of the i’th symbol,<strong style="box-sizing:inherit;font-weight:700;font-family:charter, Georgia, Cambria, &quot;Times New Roman&quot;, Times, serif;"> </strong><code style="box-sizing:inherit;font-weight:400;background-color:rgb(242, 242, 242);padding:2px 4px;font-size:75%;font-family:Menlo, Monaco, &quot;Courier New&quot;, Courier, monospace;">sᵢ</code>, to the bit stack at the previous discrete index <code style="box-sizing:inherit;font-weight:400;background-color:rgb(242, 242, 242);padding:2px 4px;font-size:75%;font-family:Menlo, Monaco, &quot;Courier New&quot;, Courier, monospace;">i−1</code>, <code style="box-sizing:inherit;font-weight:400;background-color:rgb(242, 242, 242);padding:2px 4px;font-size:75%;font-family:Menlo, Monaco, &quot;Courier New&quot;, Courier, monospace;">B_{i−1}</code>, using the probability distribution <code style="box-sizing:inherit;font-weight:400;background-color:rgb(242, 242, 242);padding:2px 4px;font-size:75%;font-family:Menlo, Monaco, &quot;Courier New&quot;, Courier, monospace;">p(s)</code>, which results in an updated bit stack, <code style="box-sizing:inherit;font-weight:400;background-color:rgb(242, 242, 242);padding:2px 4px;font-size:75%;font-family:Menlo, Monaco, &quot;Courier New&quot;, Courier, monospace;">Bᵢ</code>.</p><p style="box-sizing:inherit;margin:0px;font-weight:400;color:rgb(41, 41, 41);word-break:break-word;font-style:normal;margin-bottom:-0.46em;font-family:charter, Georgia, Cambria, &quot;Times New Roman&quot;, Times, serif;font-size:18px;line-height:28px;letter-spacing:-0.003em;margin-top:1.56em;">A specific choice of the decoding range <code style="box-sizing:inherit;font-weight:400;background-color:rgb(242, 242, 242);padding:2px 4px;font-size:75%;font-family:Menlo, Monaco, &quot;Courier New&quot;, Courier, monospace;">I = [2³¹, 2³²−1]</code><em style="box-sizing:inherit;font-style:italic;">,</em> was chosen for a 32-bit integer representation, for consistency with the original BB-ANS paper [<a href="https://medium.com/beyondminds/bb-ans-coding-7b9d512cc841" rel="noopener ugc nofollow" style="box-sizing:inherit;-webkit-tap-highlight-color:transparent;color:inherit;text-decoration:underline;" target="_blank">Townsend 2019a</a>].</p><div style="box-sizing:inherit;margin:0px;margin-left:auto;margin-right:auto;clear:both;margin-top:40px;"><div style="box-sizing:inherit;position:relative;width:100%;cursor:zoom-in;z-index:auto;transition:transform 300ms cubic-bezier(0.2, 0, 0.2, 1) 0s;"><div style="box-sizing:inherit;margin-left:auto;margin-right:auto;max-width:1458px;"><img src="BB-ANS conding_files/1I4q4VdB9z9BYs73A6RuyIg.png" type="image/png" data-filename="1I4q4VdB9z9BYs73A6RuyIg.png" height="409" style="box-sizing:inherit;vertical-align:middle;width:100%;max-width:100%;height:auto;" width="700"/></div></div></div><p style="box-sizing:inherit;margin:0px;font-weight:400;color:rgb(41, 41, 41);word-break:break-word;font-style:normal;margin-bottom:-0.46em;font-family:charter, Georgia, Cambria, &quot;Times New Roman&quot;, Times, serif;font-size:18px;line-height:28px;letter-spacing:-0.003em;margin-top:1.56em;">As seen in <strong style="box-sizing:inherit;font-weight:700;font-family:charter, Georgia, Cambria, &quot;Times New Roman&quot;, Times, serif;">Algorithm 3</strong>, <code style="box-sizing:inherit;font-weight:400;background-color:rgb(242, 242, 242);padding:2px 4px;font-size:75%;font-family:Menlo, Monaco, &quot;Courier New&quot;, Courier, monospace;">x_{i−1}</code> is initially extracted in line 3, and then represented as an integer in line 4<span style="box-sizing:inherit;cursor:pointer;color:currentcolor;background-color:rgb(229, 231, 244);">. The state is then modified in th</span>e while loop in lines 5–8, until encoding <code style="box-sizing:inherit;font-weight:400;background-color:rgb(242, 242, 242);padding:2px 4px;font-size:75%;font-family:Menlo, Monaco, &quot;Courier New&quot;, Courier, monospace;">sᵢ</code> <strong style="box-sizing:inherit;font-weight:700;font-family:charter, Georgia, Cambria, &quot;Times New Roman&quot;, Times, serif;">does not lead to an overflow</strong>. In each iteration, a bit is pushed to the bit stream (line 6) from the state. Hence, the number of bits added to the bit stream during encoding is equal to the number of iterations of the while loop. After exiting the while loop, in line 8 the new symbol is encoded onto the modified state (without overflow!) in line 9, resulting in a new state, which is then pushed onto the bit stack in line 10.</p><p style="box-sizing:inherit;margin:0px;font-weight:400;color:rgb(41, 41, 41);word-break:break-word;font-style:normal;margin-bottom:-0.46em;font-family:charter, Georgia, Cambria, &quot;Times New Roman&quot;, Times, serif;font-size:18px;line-height:28px;letter-spacing:-0.003em;margin-top:1.56em;">Decoding a symbol from a stack <code style="box-sizing:inherit;font-weight:400;background-color:rgb(242, 242, 242);padding:2px 4px;font-size:75%;font-family:Menlo, Monaco, &quot;Courier New&quot;, Courier, monospace;">Bᵢ</code> is described in <strong style="box-sizing:inherit;font-weight:700;font-family:charter, Georgia, Cambria, &quot;Times New Roman&quot;, Times, serif;">Algorithm 4.</strong> It extracts symbol<em style="box-sizing:inherit;font-style:italic;"> </em><code style="box-sizing:inherit;font-weight:400;background-color:rgb(242, 242, 242);padding:2px 4px;font-size:75%;font-family:Menlo, Monaco, &quot;Courier New&quot;, Courier, monospace;">sᵢ</code> from the bit stack at the discrete index <code style="box-sizing:inherit;font-weight:400;background-color:rgb(242, 242, 242);padding:2px 4px;font-size:75%;font-family:Menlo, Monaco, &quot;Courier New&quot;, Courier, monospace;">i</code>, <code style="box-sizing:inherit;font-weight:400;background-color:rgb(242, 242, 242);padding:2px 4px;font-size:75%;font-family:Menlo, Monaco, &quot;Courier New&quot;, Courier, monospace;">Bᵢ</code>, and returns <code style="box-sizing:inherit;font-weight:400;background-color:rgb(242, 242, 242);padding:2px 4px;font-size:75%;font-family:Menlo, Monaco, &quot;Courier New&quot;, Courier, monospace;">sᵢ</code> and <code style="box-sizing:inherit;font-weight:400;background-color:rgb(242, 242, 242);padding:2px 4px;font-size:75%;font-family:Menlo, Monaco, &quot;Courier New&quot;, Courier, monospace;">B_{i−1}</code>.</p><div style="box-sizing:inherit;margin:0px;margin-left:auto;margin-right:auto;clear:both;margin-top:40px;"><div style="box-sizing:inherit;position:relative;width:100%;cursor:zoom-in;z-index:auto;transition:transform 300ms cubic-bezier(0.2, 0, 0.2, 1) 0s;"><div style="box-sizing:inherit;margin-left:auto;margin-right:auto;max-width:1100px;"><img src="BB-ANS conding_files/1dpgTqHVrOgnmHS9t6dNEdg.png" type="image/png" data-filename="1dpgTqHVrOgnmHS9t6dNEdg.png" height="546" style="box-sizing:inherit;vertical-align:middle;width:100%;max-width:100%;height:auto;" width="700"/></div></div></div><p style="box-sizing:inherit;margin:0px;font-weight:400;color:rgb(41, 41, 41);word-break:break-word;font-style:normal;margin-bottom:-0.46em;font-family:charter, Georgia, Cambria, &quot;Times New Roman&quot;, Times, serif;font-size:18px;line-height:28px;letter-spacing:-0.003em;margin-top:1.56em;">As seen in <strong style="box-sizing:inherit;font-weight:700;font-family:charter, Georgia, Cambria, &quot;Times New Roman&quot;, Times, serif;">Algorithm 4</strong>, <code style="box-sizing:inherit;font-weight:400;background-color:rgb(242, 242, 242);padding:2px 4px;font-size:75%;font-family:Menlo, Monaco, &quot;Courier New&quot;, Courier, monospace;">xᵢ</code> is initially popped off the bit stack in line 3, and then transformed to an integer representation in line 4. Symbol<em style="box-sizing:inherit;font-style:italic;"> sᵢ</em> is then decoded in line 5 given the state, resulting in the previous state<em style="box-sizing:inherit;font-style:italic;"> </em><code style="box-sizing:inherit;font-weight:400;background-color:rgb(242, 242, 242);padding:2px 4px;font-size:75%;font-family:Menlo, Monaco, &quot;Courier New&quot;, Courier, monospace;">x_{i−1}</code>. <code style="box-sizing:inherit;font-weight:400;background-color:rgb(242, 242, 242);padding:2px 4px;font-size:75%;font-family:Menlo, Monaco, &quot;Courier New&quot;, Courier, monospace;">x_{i−1}</code> is then modified to be within the decoding range, in order to enable further encoding or decoding, in the while loop in lines 6–9. In each iteration, a single bit is popped from the stack. Hence, <strong style="box-sizing:inherit;font-weight:700;font-family:charter, Georgia, Cambria, &quot;Times New Roman&quot;, Times, serif;">the overall number of bits removed during decoding is equal to the number of iterations of the while loop</strong>. The encoding and decoding of two subsequent symbols in a sequence using streaming rANS algorithms is presented in <strong style="box-sizing:inherit;font-weight:700;font-family:charter, Georgia, Cambria, &quot;Times New Roman&quot;, Times, serif;">Figure 3</strong>.</p><div style="box-sizing:inherit;margin:0px;margin-left:auto;margin-right:auto;clear:both;margin-top:40px;"><div style="box-sizing:inherit;position:relative;width:100%;cursor:zoom-in;z-index:auto;transition:transform 300ms cubic-bezier(0.2, 0, 0.2, 1) 0s;"><div style="box-sizing:inherit;margin-left:auto;margin-right:auto;max-width:1870px;"><img src="BB-ANS conding_files/1yE6_yoa6SowuhSgRPqmGHw.png" type="image/png" data-filename="1yE6_yoa6SowuhSgRPqmGHw.png" height="307" style="box-sizing:inherit;vertical-align:middle;width:100%;max-width:100%;height:auto;" width="700"/></div></div><div style="box-sizing:inherit;font-weight:400;color:rgb(117, 117, 117);font-family:sohne, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:14px;line-height:20px;margin-right:auto;max-width:728px;margin-top:10px;margin-left:auto;text-align:center;"><strong style="box-sizing:inherit;font-family:sohne, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-weight:600;">Figure 3</strong>: Illustration of coding and decoding of two symbols using streaming rANS coding [<a href="https://medium.com/beyondminds/bb-ans-coding-7b9d512cc841" rel="noopener ugc nofollow" style="box-sizing:inherit;-webkit-tap-highlight-color:transparent;color:inherit;text-decoration:underline;" target="_blank">Duda, 2013</a>].</div></div><p style="box-sizing:inherit;margin:0px;font-weight:400;color:rgb(41, 41, 41);word-break:break-word;font-style:normal;margin-bottom:-0.46em;font-family:charter, Georgia, Cambria, &quot;Times New Roman&quot;, Times, serif;font-size:18px;line-height:28px;letter-spacing:-0.003em;margin-top:1.56em;"><strong style="box-sizing:inherit;font-weight:700;font-family:charter, Georgia, Cambria, &quot;Times New Roman&quot;, Times, serif;">Figure 3</strong> demonstrates that the encoding and decoding operations are performed in the opposite order, revealing the LIFO nature of this algorithm. Since this is a near-optimal entropy coding scheme, the approximate change in the length of the bit-stream <em style="box-sizing:inherit;font-style:italic;">B</em> after encoding/decoding symbol <code style="box-sizing:inherit;font-weight:400;background-color:rgb(242, 242, 242);padding:2px 4px;font-size:75%;font-family:Menlo, Monaco, &quot;Courier New&quot;, Courier, monospace;">sᵢ</code> is:</p><p style="box-sizing:inherit;margin:0px;font-weight:400;color:rgb(41, 41, 41);word-break:break-word;font-style:normal;margin-bottom:-0.46em;font-family:charter, Georgia, Cambria, &quot;Times New Roman&quot;, Times, serif;font-size:18px;line-height:28px;letter-spacing:-0.003em;margin-top:1.56em;"><code style="box-sizing:inherit;font-weight:400;background-color:rgb(242, 242, 242);padding:2px 4px;font-size:75%;font-family:Menlo, Monaco, &quot;Courier New&quot;, Courier, monospace;">ΔL ≈ −log(P(sᵢ))</code></p><p style="box-sizing:inherit;margin:0px;font-weight:400;color:rgb(41, 41, 41);word-break:break-word;font-style:normal;margin-bottom:-0.46em;font-family:charter, Georgia, Cambria, &quot;Times New Roman&quot;, Times, serif;font-size:18px;line-height:28px;letter-spacing:-0.003em;margin-top:1.56em;">As in the case of standard rANS compression, <strong style="box-sizing:inherit;font-weight:700;font-family:charter, Georgia, Cambria, &quot;Times New Roman&quot;, Times, serif;">streaming rANS </strong>achieves <strong style="box-sizing:inherit;font-weight:700;font-family:charter, Georgia, Cambria, &quot;Times New Roman&quot;, Times, serif;">close to optimal </strong>compression rates. Moreover, it facilitates encoding while avoiding overflow in finite-bit representations. However, the additional operations required to prevent overflow render slightly lower compression speeds compared to standard rANS. Finally, there are also variants of streaming rANS coding, in which multiple bits are added or deleted from the stack within the while loops in the respective algorithms [<a href="https://medium.com/beyondminds/bb-ans-coding-7b9d512cc841" rel="noopener ugc nofollow" style="box-sizing:inherit;-webkit-tap-highlight-color:transparent;color:inherit;text-decoration:underline;" target="_blank">Tatwawadi 2017</a> ], which are out of the scope of this blog. Since one of its main assumptions is that <strong style="box-sizing:inherit;font-weight:700;font-family:charter, Georgia, Cambria, &quot;Times New Roman&quot;, Times, serif;">all symbols are i.i.d</strong>, streaming rANS coding achieves <strong style="box-sizing:inherit;font-weight:700;font-family:charter, Georgia, Cambria, &quot;Times New Roman&quot;, Times, serif;">sub-optimal compression rates in scenarios that contain dependencies </strong>between consecutive encodings. Such dependencies are especially important in scenarios which involve latent variable models (to be discussed in the next section) and will require further improvements to the coding algorithms, if we wish to utilize them.</p><span style="display:block;clear:both;"></span></div><div style="box-sizing:inherit;display:flex;justify-content:center;margin-top:32px;padding-top:24px;margin-bottom:14px;padding-bottom:10px;"><span style="box-sizing:inherit;display:inline-block;margin-right:20px;border-radius:50%;background-color:rgb(8, 8, 8);height:3px;width:3px;"></span><span style="box-sizing:inherit;display:inline-block;margin-right:20px;border-radius:50%;background-color:rgb(8, 8, 8);height:3px;width:3px;"></span><span style="box-sizing:inherit;display:inline-block;border-radius:50%;background-color:rgb(8, 8, 8);height:3px;width:3px;"></span></div><div style="box-sizing:inherit;word-break:break-word;overflow-wrap:break-word;"><h1 style="box-sizing:inherit;margin:0px;font-family:sohne, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;color:rgb(41, 41, 41);font-style:normal;font-weight:600;margin-bottom:-0.37em;font-size:20px;line-height:24px;letter-spacing:0px;margin-top:1.5em;"><strong style="box-sizing:inherit;font-weight:inherit;">5. BB-ANS = Chaining Bits-back coding of an rANS stream</strong></h1><div style="box-sizing:inherit;margin:0px;margin-left:auto;margin-right:auto;clear:both;margin-top:40px;"><div style="box-sizing:inherit;position:relative;width:100%;cursor:zoom-in;z-index:auto;transition:transform 300ms cubic-bezier(0.2, 0, 0.2, 1) 0s;"><div style="box-sizing:inherit;margin-left:auto;margin-right:auto;max-width:1880px;"><img src="BB-ANS conding_files/11MHn05Hx5fUHVSiRnlrIqQ.png" type="image/png" data-filename="11MHn05Hx5fUHVSiRnlrIqQ.png" height="211" style="box-sizing:inherit;vertical-align:middle;width:100%;max-width:100%;height:auto;" width="700"/></div></div><div style="box-sizing:inherit;font-weight:400;color:rgb(117, 117, 117);font-family:sohne, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:14px;line-height:20px;margin-right:auto;max-width:728px;margin-top:10px;margin-left:auto;text-align:center;"><strong style="box-sizing:inherit;font-family:sohne, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-weight:600;">Figure 4: </strong>BB ANS coding as compared to other lossless compression methods. Image from <a href="https://medium.com/beyondminds/bb-ans-coding-7b9d512cc841" rel="noopener ugc nofollow" style="box-sizing:inherit;-webkit-tap-highlight-color:transparent;color:inherit;text-decoration:underline;" target="_blank">Townsend 2019a</a></div></div><p style="box-sizing:inherit;margin:0px;font-weight:400;color:rgb(41, 41, 41);word-break:break-word;font-style:normal;margin-bottom:-0.46em;font-family:charter, Georgia, Cambria, &quot;Times New Roman&quot;, Times, serif;font-size:18px;line-height:28px;letter-spacing:-0.003em;margin-top:1.56em;">In this section, chaining bits-back coding is applied to an rANS stream, giving the ultimate BB-ANS algorithm [<a href="https://medium.com/beyondminds/bb-ans-coding-7b9d512cc841" rel="noopener ugc nofollow" style="box-sizing:inherit;-webkit-tap-highlight-color:transparent;color:inherit;text-decoration:underline;" target="_blank">Townsend 2019a</a>]. Initially, the bits-back argument is briefly discussed, as it is employed for chaining bits-back.</p><p style="box-sizing:inherit;margin:0px;font-weight:400;color:rgb(41, 41, 41);word-break:break-word;font-style:normal;margin-bottom:-0.46em;font-family:charter, Georgia, Cambria, &quot;Times New Roman&quot;, Times, serif;font-size:18px;line-height:28px;letter-spacing:-0.003em;margin-top:1.56em;">The bits-back argument [<a href="https://medium.com/beyondminds/bb-ans-coding-7b9d512cc841" rel="noopener ugc nofollow" style="box-sizing:inherit;-webkit-tap-highlight-color:transparent;color:inherit;text-decoration:underline;" target="_blank">Wallace 1990</a>, <a href="https://medium.com/beyondminds/bb-ans-coding-7b9d512cc841" rel="noopener ugc nofollow" style="box-sizing:inherit;-webkit-tap-highlight-color:transparent;color:inherit;text-decoration:underline;" target="_blank">Frey and Hinton 1997</a>] was, for us, counter-intuitive at first. It proposes to employ a one-to-many source-coding scheme, arguing that the stochastic complexity can be used to improve compression rates [<a href="https://medium.com/beyondminds/bb-ans-coding-7b9d512cc841" rel="noopener ugc nofollow" style="box-sizing:inherit;-webkit-tap-highlight-color:transparent;color:inherit;text-decoration:underline;" target="_blank">Rissanen 1989</a>], as such a scheme enables the transmission of side information for “free”.</p><p style="box-sizing:inherit;margin:0px;font-weight:400;color:rgb(41, 41, 41);word-break:break-word;font-style:normal;margin-bottom:-0.46em;font-family:charter, Georgia, Cambria, &quot;Times New Roman&quot;, Times, serif;font-size:18px;line-height:28px;letter-spacing:-0.003em;margin-top:1.56em;"><strong style="box-sizing:inherit;font-weight:700;font-family:charter, Georgia, Cambria, &quot;Times New Roman&quot;, Times, serif;">The argument is focused on lossless compression using latent variable models</strong>, which enable a symbol <code style="box-sizing:inherit;font-weight:400;background-color:rgb(242, 242, 242);padding:2px 4px;font-size:75%;font-family:Menlo, Monaco, &quot;Courier New&quot;, Courier, monospace;">s</code> to be encoded more effectively when conditioned on a corresponding latent variable <code style="box-sizing:inherit;font-weight:400;background-color:rgb(242, 242, 242);padding:2px 4px;font-size:75%;font-family:Menlo, Monaco, &quot;Courier New&quot;, Courier, monospace;">y</code>. It proposes a method for utilizing conditional probabilities for encoding <em style="box-sizing:inherit;font-style:italic;">s</em> (<code style="box-sizing:inherit;font-weight:400;background-color:rgb(242, 242, 242);padding:2px 4px;font-size:75%;font-family:Menlo, Monaco, &quot;Courier New&quot;, Courier, monospace;">p(s|y)</code> rather than just <code style="box-sizing:inherit;font-weight:400;background-color:rgb(242, 242, 242);padding:2px 4px;font-size:75%;font-family:Menlo, Monaco, &quot;Courier New&quot;, Courier, monospace;">p(s)</code>), by sending <code style="box-sizing:inherit;font-weight:400;background-color:rgb(242, 242, 242);padding:2px 4px;font-size:75%;font-family:Menlo, Monaco, &quot;Courier New&quot;, Courier, monospace;">y</code> along with it, but in such a way that barely increases the message length! For every symbol <code style="box-sizing:inherit;font-weight:400;background-color:rgb(242, 242, 242);padding:2px 4px;font-size:75%;font-family:Menlo, Monaco, &quot;Courier New&quot;, Courier, monospace;">s</code>, a corresponding latent variable <code style="box-sizing:inherit;font-weight:400;background-color:rgb(242, 242, 242);padding:2px 4px;font-size:75%;font-family:Menlo, Monaco, &quot;Courier New&quot;, Courier, monospace;">y</code> is chosen out of a posterior distribution <code style="box-sizing:inherit;font-weight:400;background-color:rgb(242, 242, 242);padding:2px 4px;font-size:75%;font-family:Menlo, Monaco, &quot;Courier New&quot;, Courier, monospace;">q(y|s)</code>, using some “side information” which we can think of as an initial bit stack. <strong style="box-sizing:inherit;font-weight:700;font-family:charter, Georgia, Cambria, &quot;Times New Roman&quot;, Times, serif;">This “sampling” process removes information from the stack and reduces its length</strong>. It means that when we start encoding <code style="box-sizing:inherit;font-weight:400;background-color:rgb(242, 242, 242);padding:2px 4px;font-size:75%;font-family:Menlo, Monaco, &quot;Courier New&quot;, Courier, monospace;">s</code> and <code style="box-sizing:inherit;font-weight:400;background-color:rgb(242, 242, 242);padding:2px 4px;font-size:75%;font-family:Menlo, Monaco, &quot;Courier New&quot;, Courier, monospace;">y</code>, we are starting with a shorter bit stack, which reduces the effective message length for encoding the symbol <code style="box-sizing:inherit;font-weight:400;background-color:rgb(242, 242, 242);padding:2px 4px;font-size:75%;font-family:Menlo, Monaco, &quot;Courier New&quot;, Courier, monospace;">s</code>. This decrease in the length tends to (almost) cancel out the increase caused by encoding the latent variable <code style="box-sizing:inherit;font-weight:400;background-color:rgb(242, 242, 242);padding:2px 4px;font-size:75%;font-family:Menlo, Monaco, &quot;Courier New&quot;, Courier, monospace;">y</code>, enabling us to effectively encode it for free! To recover this “lost” information, <strong style="box-sizing:inherit;font-weight:700;font-family:charter, Georgia, Cambria, &quot;Times New Roman&quot;, Times, serif;">the decoder is instructed to encode the missing information back onto the stack</strong>, by performing the inverse operation used by the encoder during the “sampling” process — which is how we get our Bits Back!</p><div style="box-sizing:inherit;margin:0px;margin-left:auto;margin-right:auto;clear:both;margin-top:40px;"><div style="box-sizing:inherit;position:relative;width:100%;cursor:zoom-in;z-index:auto;transition:transform 300ms cubic-bezier(0.2, 0, 0.2, 1) 0s;"><div style="box-sizing:inherit;margin-left:auto;margin-right:auto;max-width:3031px;"><img src="BB-ANS conding_files/1bHsXzIEmU2bMUO3HCwELTA.jpeg" type="image/jpeg" data-filename="1bHsXzIEmU2bMUO3HCwELTA.jpeg" height="464" style="box-sizing:inherit;vertical-align:middle;width:100%;max-width:100%;height:auto;" width="700"/></div></div><div style="box-sizing:inherit;font-weight:400;color:rgb(117, 117, 117);font-family:sohne, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:14px;line-height:20px;margin-right:auto;max-width:728px;margin-top:10px;margin-left:auto;text-align:center;">Image by Tomas Sobek at Unisplash</div></div><p style="box-sizing:inherit;margin:0px;font-weight:400;color:rgb(41, 41, 41);word-break:break-word;font-style:normal;margin-bottom:-0.46em;font-family:charter, Georgia, Cambria, &quot;Times New Roman&quot;, Times, serif;font-size:18px;line-height:28px;letter-spacing:-0.003em;margin-top:1.56em;">Chaining bits-back [<a href="https://medium.com/beyondminds/bb-ans-coding-7b9d512cc841" rel="noopener ugc nofollow" style="box-sizing:inherit;-webkit-tap-highlight-color:transparent;color:inherit;text-decoration:underline;" target="_blank">Frey 1998</a>], was proposed later, and presented a method to exploit the bits-back argument, for a single stream of information (i.e., without additional side information). This is achieved using an elegant daisy-chain manipulation of a bit stream, as is described later in this section. <strong style="box-sizing:inherit;font-weight:700;font-family:charter, Georgia, Cambria, &quot;Times New Roman&quot;, Times, serif;">Chaining bits-back applied on an rANS stream gives the BB-ANS algorithm </strong>(finally!). As in the case of streaming rANS coding, symbols are encoded to a bit stream. <code style="box-sizing:inherit;font-weight:400;background-color:rgb(242, 242, 242);padding:2px 4px;font-size:75%;font-family:Menlo, Monaco, &quot;Courier New&quot;, Courier, monospace;">B₀</code> is populated with an initiation bit stream, as opposed to rANS streaming, which will be addressed in more detail at the end of this section.</p><p style="box-sizing:inherit;margin:0px;font-weight:400;color:rgb(41, 41, 41);word-break:break-word;font-style:normal;margin-bottom:-0.46em;font-family:charter, Georgia, Cambria, &quot;Times New Roman&quot;, Times, serif;font-size:18px;line-height:28px;letter-spacing:-0.003em;margin-top:1.56em;"><strong style="box-sizing:inherit;font-weight:700;font-family:charter, Georgia, Cambria, &quot;Times New Roman&quot;, Times, serif;">Algorithm 5 </strong>presents encoding a new symbol <code style="box-sizing:inherit;font-weight:400;background-color:rgb(242, 242, 242);padding:2px 4px;font-size:75%;font-family:Menlo, Monaco, &quot;Courier New&quot;, Courier, monospace;">sᵢ</code> onto <code style="box-sizing:inherit;font-weight:400;background-color:rgb(242, 242, 242);padding:2px 4px;font-size:75%;font-family:Menlo, Monaco, &quot;Courier New&quot;, Courier, monospace;">B_{i−1}</code> using BB-ANS coding, resulting in an updated bit stack <code style="box-sizing:inherit;font-weight:400;background-color:rgb(242, 242, 242);padding:2px 4px;font-size:75%;font-family:Menlo, Monaco, &quot;Courier New&quot;, Courier, monospace;">Bᵢ</code>. Though the operations on the bit stack are different than in<strong style="box-sizing:inherit;font-weight:700;font-family:charter, Georgia, Cambria, &quot;Times New Roman&quot;, Times, serif;"> Algorithm 3</strong>, the inputs and outputs are the same.</p><div style="box-sizing:inherit;margin:0px;margin-left:auto;margin-right:auto;clear:both;margin-top:40px;"><div style="box-sizing:inherit;position:relative;width:100%;cursor:zoom-in;z-index:auto;transition:transform 300ms cubic-bezier(0.2, 0, 0.2, 1) 0s;"><div style="box-sizing:inherit;margin-left:auto;margin-right:auto;max-width:1250px;"><img src="BB-ANS conding_files/1h54TeFTl6IGIyl5sCm9-mA.png" type="image/png" data-filename="1h54TeFTl6IGIyl5sCm9-mA.png" height="512" style="box-sizing:inherit;vertical-align:middle;width:100%;max-width:100%;height:auto;" width="700"/></div></div></div><p style="box-sizing:inherit;margin:0px;font-weight:400;color:rgb(41, 41, 41);word-break:break-word;font-style:normal;margin-bottom:-0.46em;font-family:charter, Georgia, Cambria, &quot;Times New Roman&quot;, Times, serif;font-size:18px;line-height:28px;letter-spacing:-0.003em;margin-top:1.56em;">The probability distributions <code style="box-sizing:inherit;font-weight:400;background-color:rgb(242, 242, 242);padding:2px 4px;font-size:75%;font-family:Menlo, Monaco, &quot;Courier New&quot;, Courier, monospace;">q(y|sᵢ)</code> and <code style="box-sizing:inherit;font-weight:400;background-color:rgb(242, 242, 242);padding:2px 4px;font-size:75%;font-family:Menlo, Monaco, &quot;Courier New&quot;, Courier, monospace;">p(s|yᵢ)</code>, which are fetched in lines 2 and 4, respectively, are typically <strong style="box-sizing:inherit;font-weight:700;font-family:charter, Georgia, Cambria, &quot;Times New Roman&quot;, Times, serif;">learned using latent variable models </strong>such as variational autoencoders (<a href="https://medium.com/beyondminds/bb-ans-coding-7b9d512cc841" rel="noopener" style="box-sizing:inherit;-webkit-tap-highlight-color:transparent;color:inherit;text-decoration:underline;" target="_blank">VAE</a>). In the BB-ANS setting, both sender and receiver have copies of the same pre-trained models, and thus can compute the same probability distributions needed for encoding/decoding. In addition, for compatibility with finite-length dictionaries (of the symbols), quantization is applied to the latent spaces of these models [<a href="https://medium.com/beyondminds/bb-ans-coding-7b9d512cc841" rel="noopener ugc nofollow" style="box-sizing:inherit;-webkit-tap-highlight-color:transparent;color:inherit;text-decoration:underline;" target="_blank">Townsend 2019a</a>].</p><div style="box-sizing:inherit;margin:0px;margin-left:auto;margin-right:auto;clear:both;margin-top:40px;"><div style="box-sizing:inherit;position:relative;width:100%;cursor:zoom-in;z-index:auto;transition:transform 300ms cubic-bezier(0.2, 0, 0.2, 1) 0s;"><div style="box-sizing:inherit;margin-left:auto;margin-right:auto;max-width:1757px;"><img src="BB-ANS conding_files/1V4sIKUh_hEQQWSFkemMefA.png" type="image/png" data-filename="1V4sIKUh_hEQQWSFkemMefA.png" height="331" style="box-sizing:inherit;vertical-align:middle;width:100%;max-width:100%;height:auto;" width="700"/></div></div><div style="box-sizing:inherit;font-weight:400;color:rgb(117, 117, 117);font-family:sohne, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:14px;line-height:20px;margin-right:auto;max-width:728px;margin-top:10px;margin-left:auto;text-align:center;"><strong style="box-sizing:inherit;font-family:sohne, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-weight:600;">Figure 5 :</strong> Illustration of encoding a symbol (an image of a flower) and its corresponding latent variable (the “random” pixels) to a bit-stack. Image from <a href="https://medium.com/beyondminds/bb-ans-coding-7b9d512cc841" rel="noopener ugc nofollow" style="box-sizing:inherit;-webkit-tap-highlight-color:transparent;color:inherit;text-decoration:underline;" target="_blank">HiLLoC</a></div></div><p style="box-sizing:inherit;margin:0px;font-weight:400;color:rgb(41, 41, 41);word-break:break-word;font-style:normal;margin-bottom:-0.46em;font-family:charter, Georgia, Cambria, &quot;Times New Roman&quot;, Times, serif;font-size:18px;line-height:28px;letter-spacing:-0.003em;margin-top:1.56em;">After<em style="box-sizing:inherit;font-style:italic;"> </em><code style="box-sizing:inherit;font-weight:400;background-color:rgb(242, 242, 242);padding:2px 4px;font-size:75%;font-family:Menlo, Monaco, &quot;Courier New&quot;, Courier, monospace;">q(y|sᵢ)</code> is computed, it is fed as an input to streaming_rANS_decode in line 3, along with <code style="box-sizing:inherit;font-weight:400;background-color:rgb(242, 242, 242);padding:2px 4px;font-size:75%;font-family:Menlo, Monaco, &quot;Courier New&quot;, Courier, monospace;">B_{i−1}</code>. This is where the magic happens: <strong style="box-sizing:inherit;font-weight:700;font-family:charter, Georgia, Cambria, &quot;Times New Roman&quot;, Times, serif;">applying streaming_rANS_decode “peels off” bits</strong> from <code style="box-sizing:inherit;font-weight:400;background-color:rgb(242, 242, 242);padding:2px 4px;font-size:75%;font-family:Menlo, Monaco, &quot;Courier New&quot;, Courier, monospace;">B_{i−1}</code>, which are used to choose the latent variable <code style="box-sizing:inherit;font-weight:400;background-color:rgb(242, 242, 242);padding:2px 4px;font-size:75%;font-family:Menlo, Monaco, &quot;Courier New&quot;, Courier, monospace;">yᵢ</code> from <code style="box-sizing:inherit;font-weight:400;background-color:rgb(242, 242, 242);padding:2px 4px;font-size:75%;font-family:Menlo, Monaco, &quot;Courier New&quot;, Courier, monospace;">q(y|sᵢ)</code>! <strong style="box-sizing:inherit;font-weight:700;font-family:charter, Georgia, Cambria, &quot;Times New Roman&quot;, Times, serif;">These are the bits that we will get back</strong>, as will be demonstrated in the BB_ANS_decode algorithm and the schematic diagrams soon to be presented. After <code style="box-sizing:inherit;font-weight:400;background-color:rgb(242, 242, 242);padding:2px 4px;font-size:75%;font-family:Menlo, Monaco, &quot;Courier New&quot;, Courier, monospace;">yᵢ</code> is chosen according to the “peeled-off” bits,<em style="box-sizing:inherit;font-style:italic;"> </em><code style="box-sizing:inherit;font-weight:400;background-color:rgb(242, 242, 242);padding:2px 4px;font-size:75%;font-family:Menlo, Monaco, &quot;Courier New&quot;, Courier, monospace;">sᵢ</code> conditioned on<em style="box-sizing:inherit;font-style:italic;"> </em><code style="box-sizing:inherit;font-weight:400;background-color:rgb(242, 242, 242);padding:2px 4px;font-size:75%;font-family:Menlo, Monaco, &quot;Courier New&quot;, Courier, monospace;">yᵢ</code> is encoded onto the stack in line 5 using learned probability <code style="box-sizing:inherit;font-weight:400;background-color:rgb(242, 242, 242);padding:2px 4px;font-size:75%;font-family:Menlo, Monaco, &quot;Courier New&quot;, Courier, monospace;">P(s|yᵢ)</code>, which is fetched in line 4. Then <code style="box-sizing:inherit;font-weight:400;background-color:rgb(242, 242, 242);padding:2px 4px;font-size:75%;font-family:Menlo, Monaco, &quot;Courier New&quot;, Courier, monospace;">yᵢ</code> is encoded onto the stack in line 7 of using a prior probability distribution <code style="box-sizing:inherit;font-weight:400;background-color:rgb(242, 242, 242);padding:2px 4px;font-size:75%;font-family:Menlo, Monaco, &quot;Courier New&quot;, Courier, monospace;">P(y)</code>, known to both sender and receiver, which gives the updated <em style="box-sizing:inherit;font-style:italic;">Bᵢ</em> in line 8. <code style="box-sizing:inherit;font-weight:400;background-color:rgb(242, 242, 242);padding:2px 4px;font-size:75%;font-family:Menlo, Monaco, &quot;Courier New&quot;, Courier, monospace;">P(y)</code> is typically chosen as a normal distribution, which maximizes the entropy among all <em style="box-sizing:inherit;font-style:italic;">y</em> distributions with fixed variance. Note that the initial decoding in line 3 of <strong style="box-sizing:inherit;font-weight:700;font-family:charter, Georgia, Cambria, &quot;Times New Roman&quot;, Times, serif;">Algorithm 5</strong> is the reason that <code style="box-sizing:inherit;font-weight:400;background-color:rgb(242, 242, 242);padding:2px 4px;font-size:75%;font-family:Menlo, Monaco, &quot;Courier New&quot;, Courier, monospace;">B₀</code> is initialized as a non-empty bit stack (compared to the empty <code style="box-sizing:inherit;font-weight:400;background-color:rgb(242, 242, 242);padding:2px 4px;font-size:75%;font-family:Menlo, Monaco, &quot;Courier New&quot;, Courier, monospace;">B₀</code> in the case of an rANS stream). The number of bits required typically depends on the entropy of <code style="box-sizing:inherit;font-weight:400;background-color:rgb(242, 242, 242);padding:2px 4px;font-size:75%;font-family:Menlo, Monaco, &quot;Courier New&quot;, Courier, monospace;">q(y|s)</code> and the architecture of the latent variable model [<a href="https://medium.com/beyondminds/bb-ans-coding-7b9d512cc841" rel="noopener ugc nofollow" style="box-sizing:inherit;-webkit-tap-highlight-color:transparent;color:inherit;text-decoration:underline;" target="_blank">Townsend 2019a</a>]. As these initial bits are non-informative, variants of BB-ANS have been proposed to decrease the amount of these bits, in scenarios involving hierarchical latent variable models [<a href="https://medium.com/beyondminds/bb-ans-coding-7b9d512cc841" rel="noopener ugc nofollow" style="box-sizing:inherit;-webkit-tap-highlight-color:transparent;color:inherit;text-decoration:underline;" target="_blank">Kingma 2019</a>, <a href="https://medium.com/beyondminds/bb-ans-coding-7b9d512cc841" rel="noopener ugc nofollow" style="box-sizing:inherit;-webkit-tap-highlight-color:transparent;color:inherit;text-decoration:underline;" target="_blank">Townsend 2019b</a>, <a href="https://medium.com/beyondminds/bb-ans-coding-7b9d512cc841" rel="noopener ugc nofollow" style="box-sizing:inherit;-webkit-tap-highlight-color:transparent;color:inherit;text-decoration:underline;" target="_blank">Ho 2019</a>].</p><p style="box-sizing:inherit;margin:0px;font-weight:400;color:rgb(41, 41, 41);word-break:break-word;font-style:normal;margin-bottom:-0.46em;font-family:charter, Georgia, Cambria, &quot;Times New Roman&quot;, Times, serif;font-size:18px;line-height:28px;letter-spacing:-0.003em;margin-top:1.56em;">Decoding symbol <code style="box-sizing:inherit;font-weight:400;background-color:rgb(242, 242, 242);padding:2px 4px;font-size:75%;font-family:Menlo, Monaco, &quot;Courier New&quot;, Courier, monospace;">sᵢ</code> from <code style="box-sizing:inherit;font-weight:400;background-color:rgb(242, 242, 242);padding:2px 4px;font-size:75%;font-family:Menlo, Monaco, &quot;Courier New&quot;, Courier, monospace;">Bᵢ</code> using the BB-ANS decoding is presented in <strong style="box-sizing:inherit;font-weight:700;font-family:charter, Georgia, Cambria, &quot;Times New Roman&quot;, Times, serif;">Algorithm 6</strong>. It performs the inverse operations to those performed in <strong style="box-sizing:inherit;font-weight:700;font-family:charter, Georgia, Cambria, &quot;Times New Roman&quot;, Times, serif;">Algorithm 5</strong>, returning the extracted symbol <code style="box-sizing:inherit;font-weight:400;background-color:rgb(242, 242, 242);padding:2px 4px;font-size:75%;font-family:Menlo, Monaco, &quot;Courier New&quot;, Courier, monospace;">sᵢ</code> and <code style="box-sizing:inherit;font-weight:400;background-color:rgb(242, 242, 242);padding:2px 4px;font-size:75%;font-family:Menlo, Monaco, &quot;Courier New&quot;, Courier, monospace;">B_{i−1}</code>.</p><div style="box-sizing:inherit;margin:0px;margin-left:auto;margin-right:auto;clear:both;margin-top:40px;"><div style="box-sizing:inherit;position:relative;width:100%;cursor:zoom-in;z-index:auto;transition:transform 300ms cubic-bezier(0.2, 0, 0.2, 1) 0s;"><div style="box-sizing:inherit;margin-left:auto;margin-right:auto;max-width:1173px;"><img src="BB-ANS conding_files/1w5VtJ131DU1orNp1uqMtEg.png" type="image/png" data-filename="1w5VtJ131DU1orNp1uqMtEg.png" height="543" style="box-sizing:inherit;vertical-align:middle;width:100%;max-width:100%;height:auto;" width="700"/></div></div></div><p style="box-sizing:inherit;margin:0px;font-weight:400;color:rgb(41, 41, 41);word-break:break-word;font-style:normal;margin-bottom:-0.46em;font-family:charter, Georgia, Cambria, &quot;Times New Roman&quot;, Times, serif;font-size:18px;line-height:28px;letter-spacing:-0.003em;margin-top:1.56em;">As seen in the algorithm, initially the latent variable <code style="box-sizing:inherit;font-weight:400;background-color:rgb(242, 242, 242);padding:2px 4px;font-size:75%;font-family:Menlo, Monaco, &quot;Courier New&quot;, Courier, monospace;">yᵢ</code> is decoded from the stack in line 3, using probability <code style="box-sizing:inherit;font-weight:400;background-color:rgb(242, 242, 242);padding:2px 4px;font-size:75%;font-family:Menlo, Monaco, &quot;Courier New&quot;, Courier, monospace;">P(y)</code> fetched in line 2. Then, <em style="box-sizing:inherit;font-style:italic;">sᵢ</em> is decoded from the stack in line 5, using probability <code style="box-sizing:inherit;font-weight:400;background-color:rgb(242, 242, 242);padding:2px 4px;font-size:75%;font-family:Menlo, Monaco, &quot;Courier New&quot;, Courier, monospace;">P(s|yᵢ)</code> fetched in line 5. Finally, the magic happens again: <strong style="box-sizing:inherit;font-weight:700;font-family:charter, Georgia, Cambria, &quot;Times New Roman&quot;, Times, serif;">after both </strong><code style="box-sizing:inherit;font-weight:400;background-color:rgb(242, 242, 242);padding:2px 4px;font-size:75%;font-family:Menlo, Monaco, &quot;Courier New&quot;, Courier, monospace;"><strong style="box-sizing:inherit;font-weight:700;font-family:inherit;">yᵢ</strong></code><strong style="box-sizing:inherit;font-weight:700;font-family:charter, Georgia, Cambria, &quot;Times New Roman&quot;, Times, serif;"> and <em style="box-sizing:inherit;font-style:italic;">sᵢ</em> have been successfully decoded, it is possible to restore the bits that were initially removed by the encoder, by performing the inverse operation that was used</strong>. Since the bits were removed by decoding <code style="box-sizing:inherit;font-weight:400;background-color:rgb(242, 242, 242);padding:2px 4px;font-size:75%;font-family:Menlo, Monaco, &quot;Courier New&quot;, Courier, monospace;">yᵢ</code>, using <code style="box-sizing:inherit;font-weight:400;background-color:rgb(242, 242, 242);padding:2px 4px;font-size:75%;font-family:Menlo, Monaco, &quot;Courier New&quot;, Courier, monospace;">q(y|sᵢ)</code>, (this was the “sampling” process), to restore those bits, we need only to encode <code style="box-sizing:inherit;font-weight:400;background-color:rgb(242, 242, 242);padding:2px 4px;font-size:75%;font-family:Menlo, Monaco, &quot;Courier New&quot;, Courier, monospace;">yᵢ</code> back onto the stack using <code style="box-sizing:inherit;font-weight:400;background-color:rgb(242, 242, 242);padding:2px 4px;font-size:75%;font-family:Menlo, Monaco, &quot;Courier New&quot;, Courier, monospace;">q(y|sᵢ)</code>. This ensures we return the exact state the bit stack was in before <em style="box-sizing:inherit;font-style:italic;">sᵢ</em> was encoded,<code style="box-sizing:inherit;font-weight:400;background-color:rgb(242, 242, 242);padding:2px 4px;font-size:75%;font-family:Menlo, Monaco, &quot;Courier New&quot;, Courier, monospace;"> B_{i-1}</code><em style="box-sizing:inherit;font-style:italic;">, </em>which means:</p><p style="box-sizing:inherit;margin:0px;font-weight:400;color:rgb(41, 41, 41);word-break:break-word;font-style:normal;margin-bottom:-0.46em;font-family:charter, Georgia, Cambria, &quot;Times New Roman&quot;, Times, serif;font-size:18px;line-height:28px;letter-spacing:-0.003em;margin-top:1.56em;"><strong style="box-sizing:inherit;font-weight:700;font-family:charter, Georgia, Cambria, &quot;Times New Roman&quot;, Times, serif;">We get our bits back!</strong></p><p style="box-sizing:inherit;margin:0px;font-weight:400;color:rgb(41, 41, 41);word-break:break-word;font-style:normal;margin-bottom:-0.46em;font-family:charter, Georgia, Cambria, &quot;Times New Roman&quot;, Times, serif;font-size:18px;line-height:28px;letter-spacing:-0.003em;margin-top:1.56em;">In <strong style="box-sizing:inherit;font-weight:700;font-family:charter, Georgia, Cambria, &quot;Times New Roman&quot;, Times, serif;">Algorithm 6</strong>, <code style="box-sizing:inherit;font-weight:400;background-color:rgb(242, 242, 242);padding:2px 4px;font-size:75%;font-family:Menlo, Monaco, &quot;Courier New&quot;, Courier, monospace;">q(y|sᵢ)</code> is fetched in line 6, is then used to encode the <code style="box-sizing:inherit;font-weight:400;background-color:rgb(242, 242, 242);padding:2px 4px;font-size:75%;font-family:Menlo, Monaco, &quot;Courier New&quot;, Courier, monospace;">yᵢ</code> onto the stack in line 7.</p><p style="box-sizing:inherit;margin:0px;font-weight:400;color:rgb(41, 41, 41);word-break:break-word;font-style:normal;margin-bottom:-0.46em;font-family:charter, Georgia, Cambria, &quot;Times New Roman&quot;, Times, serif;font-size:18px;line-height:28px;letter-spacing:-0.003em;margin-top:1.56em;">The encoding and decoding of two subsequent symbols in a sequence using BB-ANS is presented in <strong style="box-sizing:inherit;font-weight:700;font-family:charter, Georgia, Cambria, &quot;Times New Roman&quot;, Times, serif;">Figure 6</strong>.</p><div style="box-sizing:inherit;margin:0px;margin-left:auto;margin-right:auto;clear:both;margin-top:40px;"><div style="box-sizing:inherit;position:relative;width:100%;cursor:zoom-in;z-index:auto;transition:transform 300ms cubic-bezier(0.2, 0, 0.2, 1) 0s;"><div style="box-sizing:inherit;margin-left:auto;margin-right:auto;max-width:1680px;"><img src="BB-ANS conding_files/1DJj5s0zcLUZ9RubmXBA6cQ.png" type="image/png" data-filename="1DJj5s0zcLUZ9RubmXBA6cQ.png" height="349" style="box-sizing:inherit;vertical-align:middle;width:100%;max-width:100%;height:auto;" width="700"/></div></div><div style="box-sizing:inherit;font-weight:400;color:rgb(117, 117, 117);font-family:sohne, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:14px;line-height:20px;margin-right:auto;max-width:728px;margin-top:10px;margin-left:auto;text-align:center;"><strong style="box-sizing:inherit;font-family:sohne, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-weight:600;">Figure 6</strong>: Illustration of coding and decoding of two symbols using BB-ANS coding [<a href="https://medium.com/beyondminds/bb-ans-coding-7b9d512cc841" rel="noopener ugc nofollow" style="box-sizing:inherit;-webkit-tap-highlight-color:transparent;color:inherit;text-decoration:underline;" target="_blank">Townsend, 2019a</a>].</div></div><p style="box-sizing:inherit;margin:0px;font-weight:400;color:rgb(41, 41, 41);word-break:break-word;font-style:normal;margin-bottom:-0.46em;font-family:charter, Georgia, Cambria, &quot;Times New Roman&quot;, Times, serif;font-size:18px;line-height:28px;letter-spacing:-0.003em;margin-top:1.56em;">In <strong style="box-sizing:inherit;font-weight:700;font-family:charter, Georgia, Cambria, &quot;Times New Roman&quot;, Times, serif;">Figure 6</strong>, it is evident that three steps are required for encoding each symbol, as opposed to rANS streaming in <strong style="box-sizing:inherit;font-weight:700;font-family:charter, Georgia, Cambria, &quot;Times New Roman&quot;, Times, serif;">Figure 3</strong>, where only one operation is required for encoding and decoding. Though the encoding operation is more complex, it is <strong style="box-sizing:inherit;font-weight:700;font-family:charter, Georgia, Cambria, &quot;Times New Roman&quot;, Times, serif;">nonetheless uniquely decodable</strong>, since the operations are fully reversible. Same as for streaming rANS coding, the LIFO nature of BB-ANS is also apparent in the figure.</p><p style="box-sizing:inherit;margin:0px;font-weight:400;color:rgb(41, 41, 41);word-break:break-word;font-style:normal;margin-bottom:-0.46em;font-family:charter, Georgia, Cambria, &quot;Times New Roman&quot;, Times, serif;font-size:18px;line-height:28px;letter-spacing:-0.003em;margin-top:1.56em;">To conclude, this section presented BB-ANS coding and decoding. The average length of a message using this method is given by the average length of code <code style="box-sizing:inherit;font-weight:400;background-color:rgb(242, 242, 242);padding:2px 4px;font-size:75%;font-family:Menlo, Monaco, &quot;Courier New&quot;, Courier, monospace;">E[log(p(s|y))]</code> (with <code style="box-sizing:inherit;font-weight:400;background-color:rgb(242, 242, 242);padding:2px 4px;font-size:75%;font-family:Menlo, Monaco, &quot;Courier New&quot;, Courier, monospace;">E[·]</code> being the expectation operator) plus the average length of code <code style="box-sizing:inherit;font-weight:400;background-color:rgb(242, 242, 242);padding:2px 4px;font-size:75%;font-family:Menlo, Monaco, &quot;Courier New&quot;, Courier, monospace;">E[log(p(y))]</code> minus the bits that were initially “peeled off” with an average length of <code style="box-sizing:inherit;font-weight:400;background-color:rgb(242, 242, 242);padding:2px 4px;font-size:75%;font-family:Menlo, Monaco, &quot;Courier New&quot;, Courier, monospace;">E[log(q(y|s))]</code>. Putting it all together, the average increase in message length associated with sending a single symbol<code style="box-sizing:inherit;font-weight:400;background-color:rgb(242, 242, 242);padding:2px 4px;font-size:75%;font-family:Menlo, Monaco, &quot;Courier New&quot;, Courier, monospace;">s</code> is:</p><p style="box-sizing:inherit;margin:0px;font-weight:400;color:rgb(41, 41, 41);word-break:break-word;font-style:normal;margin-bottom:-0.46em;font-family:charter, Georgia, Cambria, &quot;Times New Roman&quot;, Times, serif;font-size:18px;line-height:28px;letter-spacing:-0.003em;margin-top:1.56em;"><code style="box-sizing:inherit;font-weight:400;background-color:rgb(242, 242, 242);padding:2px 4px;font-size:75%;font-family:Menlo, Monaco, &quot;Courier New&quot;, Courier, monospace;">ΔL = E[log(p(s|y))] + E[log(p(y))] − E[log(q(y|s))]</code></p><p style="box-sizing:inherit;margin:0px;font-weight:400;color:rgb(41, 41, 41);word-break:break-word;font-style:normal;margin-bottom:-0.46em;font-family:charter, Georgia, Cambria, &quot;Times New Roman&quot;, Times, serif;font-size:18px;line-height:28px;letter-spacing:-0.003em;margin-top:1.56em;">This effective average code-word length is referred to as the “free energy” in [<a href="https://medium.com/beyondminds/bb-ans-coding-7b9d512cc841" rel="noopener ugc nofollow" style="box-sizing:inherit;-webkit-tap-highlight-color:transparent;color:inherit;text-decoration:underline;" target="_blank">Frey and Hinton 1996</a>]. Note that since y is “sampled” using <code style="box-sizing:inherit;font-weight:400;background-color:rgb(242, 242, 242);padding:2px 4px;font-size:75%;font-family:Menlo, Monaco, &quot;Courier New&quot;, Courier, monospace;">E[log(q(y|s))]</code> and encoded using<em style="box-sizing:inherit;font-style:italic;"> </em><code style="box-sizing:inherit;font-weight:400;background-color:rgb(242, 242, 242);padding:2px 4px;font-size:75%;font-family:Menlo, Monaco, &quot;Courier New&quot;, Courier, monospace;">p(y)</code>, the effective increase in message length associated with sending <code style="box-sizing:inherit;font-weight:400;background-color:rgb(242, 242, 242);padding:2px 4px;font-size:75%;font-family:Menlo, Monaco, &quot;Courier New&quot;, Courier, monospace;">y</code> is:</p><p style="box-sizing:inherit;margin:0px;font-weight:400;color:rgb(41, 41, 41);word-break:break-word;font-style:normal;margin-bottom:-0.46em;font-family:charter, Georgia, Cambria, &quot;Times New Roman&quot;, Times, serif;font-size:18px;line-height:28px;letter-spacing:-0.003em;margin-top:1.56em;"><code style="box-sizing:inherit;font-weight:400;background-color:rgb(242, 242, 242);padding:2px 4px;font-size:75%;font-family:Menlo, Monaco, &quot;Courier New&quot;, Courier, monospace;">ΔL = E[log(p(y))] − E[log(q(y|s))] &gt; 0</code></p><p style="box-sizing:inherit;margin:0px;font-weight:400;color:rgb(41, 41, 41);word-break:break-word;font-style:normal;margin-bottom:-0.46em;font-family:charter, Georgia, Cambria, &quot;Times New Roman&quot;, Times, serif;font-size:18px;line-height:28px;letter-spacing:-0.003em;margin-top:1.56em;">which is actually the KL divergence of the two distributions and is typically small, compared to <code style="box-sizing:inherit;font-weight:400;background-color:rgb(242, 242, 242);padding:2px 4px;font-size:75%;font-family:Menlo, Monaco, &quot;Courier New&quot;, Courier, monospace;">E[log(p(s|y))]</code>. <strong style="box-sizing:inherit;font-weight:700;font-family:charter, Georgia, Cambria, &quot;Times New Roman&quot;, Times, serif;">BB-ANS-based methods achieve the best compression rates compared to other lossless compression schemes</strong>. However, the compression rates depend on the quality of learned probabilistic models (<code style="box-sizing:inherit;font-weight:400;background-color:rgb(242, 242, 242);padding:2px 4px;font-size:75%;font-family:Menlo, Monaco, &quot;Courier New&quot;, Courier, monospace;">q(y|sᵢ)</code> and <code style="box-sizing:inherit;font-weight:400;background-color:rgb(242, 242, 242);padding:2px 4px;font-size:75%;font-family:Menlo, Monaco, &quot;Courier New&quot;, Courier, monospace;">p(s|yᵢ)</code>); which is why recent efforts in the field, have focused on improving them by employing advanced neural network architectures, to efficiently approximate the probability distributions of the data. Furthermore, their compression speeds are typically lower than regular rANS coding, as BB-ANS based methods require more operations (and is apparent in <strong style="box-sizing:inherit;font-weight:700;font-family:charter, Georgia, Cambria, &quot;Times New Roman&quot;, Times, serif;">Figure 6</strong>). Performance of several recent BB ANS based methods as compared to generic methods are displayed in <strong style="box-sizing:inherit;font-weight:700;font-family:charter, Georgia, Cambria, &quot;Times New Roman&quot;, Times, serif;">Figure 7</strong>.</p><div style="box-sizing:inherit;margin:0px;margin-left:auto;margin-right:auto;clear:both;margin-top:40px;"><div style="box-sizing:inherit;position:relative;width:100%;cursor:zoom-in;z-index:auto;transition:transform 300ms cubic-bezier(0.2, 0, 0.2, 1) 0s;"><div style="box-sizing:inherit;margin-left:auto;margin-right:auto;max-width:1605px;"><img src="BB-ANS conding_files/1vIBQNZb7Fp2CqZC88bbSaA.png" type="image/png" data-filename="1vIBQNZb7Fp2CqZC88bbSaA.png" height="225" style="box-sizing:inherit;vertical-align:middle;width:100%;max-width:100%;height:auto;" width="700"/></div></div><div style="box-sizing:inherit;font-weight:400;color:rgb(117, 117, 117);font-family:sohne, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:14px;line-height:20px;margin-right:auto;max-width:728px;margin-top:10px;margin-left:auto;text-align:center;"><strong style="box-sizing:inherit;font-family:sohne, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-weight:600;">Figure 7</strong>: Performance of different compression methods, measured in average bits per pixel (8 is uncompressed), as evaluated on the test sets of several computer vision benchmarks. (<a href="https://medium.com/beyondminds/bb-ans-coding-7b9d512cc841" rel="noopener ugc nofollow" style="box-sizing:inherit;-webkit-tap-highlight-color:transparent;color:inherit;text-decoration:underline;" target="_blank">IDF</a>, <a href="https://medium.com/beyondminds/bb-ans-coding-7b9d512cc841" rel="noopener ugc nofollow" style="box-sizing:inherit;-webkit-tap-highlight-color:transparent;color:inherit;text-decoration:underline;" target="_blank">LBB</a>, <a href="https://medium.com/beyondminds/bb-ans-coding-7b9d512cc841" rel="noopener ugc nofollow" style="box-sizing:inherit;-webkit-tap-highlight-color:transparent;color:inherit;text-decoration:underline;" target="_blank">Bit-swap</a> and <a href="https://medium.com/beyondminds/bb-ans-coding-7b9d512cc841" rel="noopener ugc nofollow" style="box-sizing:inherit;-webkit-tap-highlight-color:transparent;color:inherit;text-decoration:underline;" target="_blank">HiLLoC </a>are BB ANS based method).<strong style="box-sizing:inherit;font-family:sohne, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-weight:600;"> </strong>Image taken from <a href="https://medium.com/beyondminds/bb-ans-coding-7b9d512cc841" rel="noopener ugc nofollow" style="box-sizing:inherit;-webkit-tap-highlight-color:transparent;color:inherit;text-decoration:underline;" target="_blank">HiLLoC</a></div></div><p style="box-sizing:inherit;margin:0px;font-weight:400;color:rgb(41, 41, 41);word-break:break-word;font-style:normal;margin-bottom:-0.46em;font-family:charter, Georgia, Cambria, &quot;Times New Roman&quot;, Times, serif;font-size:18px;line-height:28px;letter-spacing:-0.003em;margin-top:1.56em;">As seen in <strong style="box-sizing:inherit;font-weight:700;font-family:charter, Georgia, Cambria, &quot;Times New Roman&quot;, Times, serif;">Figure 7</strong>, <strong style="box-sizing:inherit;font-weight:700;font-family:charter, Georgia, Cambria, &quot;Times New Roman&quot;, Times, serif;">BB ANS based methods outperform generic compression methods such as </strong><a href="https://medium.com/beyondminds/bb-ans-coding-7b9d512cc841" rel="noopener ugc nofollow" style="box-sizing:inherit;-webkit-tap-highlight-color:transparent;color:inherit;text-decoration:underline;" target="_blank"><strong style="box-sizing:inherit;font-weight:700;font-family:charter, Georgia, Cambria, &quot;Times New Roman&quot;, Times, serif;">PNG</strong></a><strong style="box-sizing:inherit;font-weight:700;font-family:charter, Georgia, Cambria, &quot;Times New Roman&quot;, Times, serif;">, </strong><a href="https://medium.com/beyondminds/bb-ans-coding-7b9d512cc841" rel="noopener ugc nofollow" style="box-sizing:inherit;-webkit-tap-highlight-color:transparent;color:inherit;text-decoration:underline;" target="_blank"><strong style="box-sizing:inherit;font-weight:700;font-family:charter, Georgia, Cambria, &quot;Times New Roman&quot;, Times, serif;">WebP </strong></a><strong style="box-sizing:inherit;font-weight:700;font-family:charter, Georgia, Cambria, &quot;Times New Roman&quot;, Times, serif;">and </strong><a href="https://medium.com/beyondminds/bb-ans-coding-7b9d512cc841" rel="noopener ugc nofollow" style="box-sizing:inherit;-webkit-tap-highlight-color:transparent;color:inherit;text-decoration:underline;" target="_blank"><strong style="box-sizing:inherit;font-weight:700;font-family:charter, Georgia, Cambria, &quot;Times New Roman&quot;, Times, serif;">FLIF</strong></a><strong style="box-sizing:inherit;font-weight:700;font-family:charter, Georgia, Cambria, &quot;Times New Roman&quot;, Times, serif;">, across all benchmarks</strong>. For the <a href="https://medium.com/beyondminds/bb-ans-coding-7b9d512cc841" rel="noopener ugc nofollow" style="box-sizing:inherit;-webkit-tap-highlight-color:transparent;color:inherit;text-decoration:underline;" target="_blank">Cifar10</a> benchmark, <a href="https://medium.com/beyondminds/bb-ans-coding-7b9d512cc841" rel="noopener ugc nofollow" style="box-sizing:inherit;-webkit-tap-highlight-color:transparent;color:inherit;text-decoration:underline;" target="_blank">LBB </a>(a variant of BB ANS) achieves compression rates <strong style="box-sizing:inherit;font-weight:700;font-family:charter, Georgia, Cambria, &quot;Times New Roman&quot;, Times, serif;">46.8% percent better than </strong><a href="https://medium.com/beyondminds/bb-ans-coding-7b9d512cc841" rel="noopener ugc nofollow" style="box-sizing:inherit;-webkit-tap-highlight-color:transparent;color:inherit;text-decoration:underline;" target="_blank"><strong style="box-sizing:inherit;font-weight:700;font-family:charter, Georgia, Cambria, &quot;Times New Roman&quot;, Times, serif;">PNG</strong> </a>and 32.3% better than <a href="https://medium.com/beyondminds/bb-ans-coding-7b9d512cc841" rel="noopener ugc nofollow" style="box-sizing:inherit;-webkit-tap-highlight-color:transparent;color:inherit;text-decoration:underline;" target="_blank">WebP</a>! These results demonstrate the significance of this breakthrough and highlight the differences between compression methods.</p><div style="box-sizing:inherit;margin:0px;margin-left:auto;margin-right:auto;clear:both;margin-top:40px;"><div style="box-sizing:inherit;position:relative;width:100%;cursor:zoom-in;z-index:auto;transition:transform 300ms cubic-bezier(0.2, 0, 0.2, 1) 0s;"><div style="box-sizing:inherit;margin-left:auto;margin-right:auto;max-width:3471px;"><img src="BB-ANS conding_files/1Ibu2Z2gPQKLQjHCi6x8zbg.jpeg" type="image/jpeg" data-filename="1Ibu2Z2gPQKLQjHCi6x8zbg.jpeg" height="571" style="box-sizing:inherit;vertical-align:middle;width:100%;max-width:100%;height:auto;" width="700"/></div></div><div style="box-sizing:inherit;font-weight:400;color:rgb(117, 117, 117);font-family:sohne, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:14px;line-height:20px;margin-right:auto;max-width:728px;margin-top:10px;margin-left:auto;text-align:center;">image by Clay Banks at Unisplash</div></div><h1 style="box-sizing:inherit;margin:0px;font-family:sohne, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;color:rgb(41, 41, 41);font-style:normal;font-weight:600;margin-bottom:-0.37em;font-size:20px;margin-top:1.9em;line-height:24px;letter-spacing:0px;"><strong style="box-sizing:inherit;font-weight:inherit;">6. Conclusion</strong></h1><p style="box-sizing:inherit;margin:0px;font-weight:400;color:rgb(41, 41, 41);word-break:break-word;font-style:normal;margin-bottom:-0.46em;font-family:charter, Georgia, Cambria, &quot;Times New Roman&quot;, Times, serif;font-size:18px;margin-top:0.67em;line-height:28px;letter-spacing:-0.003em;">This blog has presented BB-ANS coding and decoding, including schematic diagrams for demonstration.</p><p style="box-sizing:inherit;margin:0px;font-weight:400;color:rgb(41, 41, 41);word-break:break-word;font-style:normal;margin-bottom:-0.46em;font-family:charter, Georgia, Cambria, &quot;Times New Roman&quot;, Times, serif;font-size:18px;line-height:28px;letter-spacing:-0.003em;margin-top:1.56em;">The remarkable compatibility of neural network-based latent variable models with BB-ANS compression enables these methods to achieve state-of-the-art compression rates. Though, from our own experience, the ability to apply these methods in real-world applications requires an ‘’under the hood’’ understanding of their inner workings. We hope this blog will help others apply these methods and keep advancing this fascinating new field of research!</p><span style="display:block;clear:both;"></span></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div>
</div>
</span>
</div></body></html> 