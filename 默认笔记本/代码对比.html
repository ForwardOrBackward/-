<html>
<head>
  <title>代码对比</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/603932 (zh-CN, DDL); Windows/10.0.0 (Win64); EDAMVersion=V2;"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 12pt;
    }
  </style>
</head>
<body>
<a name="8863"/>
<h1>代码对比</h1>
<div>
<table bgcolor="#D4DDE5" border="0">
<tr><td><b>创建时间：</b></td><td><i>2021/6/26 11:14</i></td></tr>
<tr><td><b>更新时间：</b></td><td><i>2021/8/30 14:30</i></td></tr>
</table>
</div>
<br/>

<div>
<span><div><div><br/></div><table style="border-collapse: collapse; min-width: 100%;"><colgroup><col style="width: 171px;"></col><col style="width: 207px;"></col><col style="width: 390px;"></col><col style="width: 343px;"></col></colgroup><tbody><tr><td style="width: 171px; padding: 8px; border: 1px solid;"><div><br/></div></td><td style="width: 207px; padding: 8px; border: 1px solid;"><div>snappy</div></td><td style="width: 390px; padding: 8px; border: 1px solid;"><div>databox</div></td><td style="width: 343px; padding: 8px; border: 1px solid;"><div><br/></div></td></tr><tr><td style="width: 171px; padding: 8px; border: 1px solid;"><div>Codec</div></td><td style="width: 207px; padding: 8px; border: 1px solid;"><div><span style="font-size: 9.8pt; color: rgb(0, 98, 122); font-family: &quot;JetBrains Mono&quot;, monospace;">checkNativeCodeLoaded</span></div><div><span style="font-size: 9.8pt; color: rgb(0, 98, 122); font-family: &quot;JetBrains Mono&quot;, monospace;">createDirectDecompressor</span></div></td><td style="width: 390px; padding: 8px; border: 1px solid;"><div><span style="font-size: 9.8pt; color: rgb(0, 98, 122); font-family: &quot;JetBrains Mono&quot;, monospace;">getMachineNodeName</span></div><div><span style="font-size: 9.8pt; color: rgb(0, 98, 122); font-family: &quot;JetBrains Mono&quot;, monospace;">getNativeLoadedErrorMsg</span></div><div><span style="font-size: 10pt; color: rgb(0, 98, 122); font-family: &quot;JetBrains Mono&quot;;">static块</span></div><div><span style="font-size: 10pt; color: rgb(0, 98, 122); font-family: &quot;JetBrains Mono&quot;;">属性:</span></div><div><span style="font-size: 9.8pt; color: rgb(135, 16, 148); font-family: &quot;JetBrains Mono&quot;, monospace; font-style: italic;">LOG</span></div><div><span style="font-size: 9.8pt; color: rgb(135, 16, 148); font-family: &quot;JetBrains Mono&quot;, monospace; font-style: italic;">nativeLoaded</span></div><div><span style="font-size: 9.8pt; color: rgb(135, 16, 148); font-family: &quot;JetBrains Mono&quot;, monospace; font-style: italic;">machineNodeName</span></div><div><span style="font-size: 9.8pt; color: rgb(135, 16, 148); font-family: &quot;JetBrains Mono&quot;, monospace; font-style: italic;">nativeLoadedErrorNum</span></div></td><td style="width: 343px; padding: 8px; border: 1px solid;"><div>重点关注<span style="font-size: 9.8pt; color: rgb(0, 98, 122); font-family: &quot;JetBrains Mono&quot;, monospace;">createOutputStream、</span><span style="font-size: 9.8pt; color: rgb(0, 98, 122); font-family: &quot;JetBrains Mono&quot;, monospace;">createInputStream、</span><span style="font-size: 9.8pt; color: rgb(0, 98, 122); font-family: &quot;JetBrains Mono&quot;, monospace;">createCompressor、</span><span style="font-size: 9.8pt; color: rgb(0, 98, 122); font-family: &quot;JetBrains Mono&quot;, monospace;">createDecompressor四个的</span><span style="font-size: 9.8pt; color: rgb(0, 98, 122); font-family: &quot;JetBrains Mono&quot;, monospace;">bufferSize为什么和snappy的不一样。</span></div></td></tr><tr><td style="width: 171px; padding: 8px; border: 1px solid;"><div>Compressor</div></td><td style="width: 207px; padding: 8px; border: 1px solid;"><div><span style="font-size: 9.8pt; color: rgb(0, 98, 122); font-family: &quot;JetBrains Mono&quot;, monospace;">isNativeCodeLoaded</span></div><div><span style="font-size: 9.8pt; color: rgb(0, 98, 122); font-family: &quot;JetBrains Mono&quot;, monospace;">属性:</span></div><div><span style="font-size: 9.8pt; color: rgb(135, 16, 148); font-family: &quot;JetBrains Mono&quot;, monospace; font-style: italic;">nativeSnappyLoaded</span></div></td><td style="width: 390px; padding: 8px; border: 1px solid;"><div><span style="background-color: rgb(255, 255, 255); font-size: 9.8pt; color: rgb(0, 98, 122); font-family: &quot;JetBrains Mono&quot;, monospace;">DataboxCompressor</span><span style="background-color: rgb(255, 255, 255); font-size: 9.8pt; color: rgb(8, 8, 8); font-family: &quot;JetBrains Mono&quot;, monospace;">(</span><span style="background-color: rgb(255, 255, 255); font-size: 9.8pt; color: rgb(0, 51, 179); font-family: &quot;JetBrains Mono&quot;, monospace;">int</span> <span style="background-color: rgb(255, 255, 255); font-size: 9.8pt; color: rgb(8, 8, 8); font-family: &quot;JetBrains Mono&quot;, monospace;">directBufferSize,</span> <span style="background-color: rgb(255, 255, 255); font-size: 9.8pt; color: rgb(0, 51, 179); font-family: &quot;JetBrains Mono&quot;, monospace;">boolean</span> <span style="font-size: 9.8pt; color: rgb(8, 8, 8); font-family: &quot;JetBrains Mono&quot;, monospace;">useInDataboxCodec)</span></div><div><span style="font-size: 9.8pt; color: rgb(0, 98, 122); font-family: &quot;JetBrains Mono&quot;, monospace;">getNativeLoadedErrorNum</span></div><div><span style="font-size: 9.8pt; color: rgb(0, 98, 122); font-family: &quot;JetBrains Mono&quot;, monospace;">isNativeLoaded</span></div><div><span style="font-size: 9.8pt; color: rgb(0, 98, 122); font-family: &quot;JetBrains Mono&quot;, monospace;">属性:</span></div><div><span style="font-size: 9.8pt; color: rgb(135, 16, 148); font-family: &quot;JetBrains Mono&quot;, monospace; font-style: italic;">DEFAULT_DIRECT_BUFFER_SIZE 和snappy的初始值不一样</span></div><div><span style="font-size: 9.8pt; color: rgb(135, 16, 148); font-family: &quot;JetBrains Mono&quot;, monospace;">encodeDirectBuf</span></div><div><span style="font-size: 9.8pt; color: rgb(135, 16, 148); font-family: &quot;JetBrains Mono&quot;, monospace; font-style: italic;">nativeLoaded</span></div><div><span style="font-size: 9.8pt; color: rgb(135, 16, 148); font-family: &quot;JetBrains Mono&quot;, monospace; font-style: italic;">nativeLoadedErrorNum</span></div></td><td style="width: 343px; padding: 8px; border: 1px solid;"><div><br/></div></td></tr><tr><td style="width: 171px; padding: 8px; border: 1px solid;"><div>Decompressor</div></td><td style="width: 207px; padding: 8px; border: 1px solid;"><div><span style="font-size: 9.8pt; color: rgb(0, 98, 122); font-family: &quot;JetBrains Mono&quot;, monospace;">decompressDirect</span></div><div><span style="font-size: 9.8pt; color: rgb(0, 98, 122); font-family: &quot;JetBrains Mono&quot;, monospace;">isNativeCodeLoaded</span></div><div><span style="font-size: 9.8pt; color: rgb(0, 98, 122); font-family: &quot;JetBrains Mono&quot;, monospace;">属性:</span></div><div><span style="font-size: 9.8pt; color: rgb(135, 16, 148); font-family: &quot;JetBrains Mono&quot;, monospace; font-style: italic;">nativeSnappyLoaded</span></div></td><td style="width: 390px; padding: 8px; border: 1px solid;"><div><span style="background-color: rgb(255, 255, 255); font-size: 9.8pt; color: rgb(0, 98, 122); font-family: &quot;JetBrains Mono&quot;, monospace;">DataboxDecompressor</span><span style="background-color: rgb(255, 255, 255); font-size: 9.8pt; color: rgb(8, 8, 8); font-family: &quot;JetBrains Mono&quot;, monospace;">(</span><span style="background-color: rgb(255, 255, 255); font-size: 9.8pt; color: rgb(0, 51, 179); font-family: &quot;JetBrains Mono&quot;, monospace;">int</span> <span style="background-color: rgb(255, 255, 255); font-size: 9.8pt; color: rgb(8, 8, 8); font-family: &quot;JetBrains Mono&quot;, monospace;">directBufferSize,</span> <span style="background-color: rgb(255, 255, 255); font-size: 9.8pt; color: rgb(0, 51, 179); font-family: &quot;JetBrains Mono&quot;, monospace;">boolean</span> <span style="font-size: 9.8pt; color: rgb(8, 8, 8); font-family: &quot;JetBrains Mono&quot;, monospace;">useInDataboxCodec)</span></div><div><span style="font-size: 9.8pt; color: rgb(0, 98, 122); font-family: &quot;JetBrains Mono&quot;, monospace;">getNativeLoadedErrorNum</span></div><div><span style="font-size: 9.8pt; color: rgb(0, 98, 122); font-family: &quot;JetBrains Mono&quot;, monospace;">isNativeLoaded</span></div><div><span style="font-size: 9.8pt; color: rgb(0, 98, 122); font-family: &quot;JetBrains Mono&quot;, monospace;">属性:</span></div><div><span style="font-size: 9.8pt; color: rgb(135, 16, 148); font-family: &quot;JetBrains Mono&quot;, monospace; font-style: italic;">DEFAULT_DIRECT_BUFFER_SIZE 和snappy的初始值不一样</span></div><div><span style="font-size: 9.8pt; color: rgb(135, 16, 148); font-family: &quot;JetBrains Mono&quot;, monospace;">decodeDirectBuf</span></div><div><span style="font-size: 9.8pt; color: rgb(135, 16, 148); font-family: &quot;JetBrains Mono&quot;, monospace; font-style: italic;">nativeLoaded</span></div><div><span style="font-size: 9.8pt; color: rgb(135, 16, 148); font-family: &quot;JetBrains Mono&quot;, monospace; font-style: italic;">nativeLoadedErrorNum</span></div></td><td style="width: 343px; padding: 8px; border: 1px solid;"><div><br/></div></td></tr><tr><td style="width: 171px; padding: 8px; border: 1px solid;"><div>NativeCodeLoader</div></td><td style="width: 207px; padding: 8px; border: 1px solid;"><div><br/></div></td><td style="width: 390px; padding: 8px; border: 1px solid;"><div>实现区别较大,建议仔细看看。</div></td><td style="width: 343px; padding: 8px; border: 1px solid;"><div><br/></div></td></tr><tr><td style="width: 171px; padding: 8px; border: 1px solid;"><div><span style="font-size: 9.8pt; color: rgb(0, 0, 0); font-family: &quot;JetBrains Mono&quot;, monospace;">DataboxConfigurationKeys</span></div><div><span style="font-size: 9.8pt; color: rgb(0, 0, 0); font-family: &quot;JetBrains Mono&quot;, monospace;">等价于</span></div><div><span style="font-size: 9.8pt; color: rgb(0, 0, 0); font-family: &quot;JetBrains Mono&quot;, monospace;">CommonConfigurationKeys</span></div></td><td style="width: 207px; padding: 8px; border: 1px solid;"><div><br/></div></td><td style="width: 390px; padding: 8px; border: 1px solid;"><div>两个类里面全是静态常量, 不过<span style="font-size: 9.8pt; color: rgb(0, 0, 0); font-family: &quot;JetBrains Mono&quot;, monospace;">DataboxConfigurationKeys</span>比<span style="font-size: 9.8pt; color: rgb(0, 0, 0); font-family: &quot;JetBrains Mono&quot;, monospace;">CommonConfigurationKeys少了很多静态常量</span></div></td><td style="width: 343px; padding: 8px; border: 1px solid;"><div><br/></div></td></tr></tbody></table><div><br/></div><div>可以画的图:</div><div>代码的层次结构图</div><div>java</div><div>jni</div><div>c</div><div>驱动</div><div>硬件(Verilog)</div><div><br/></div><div>了解jni、了解写入硬件的语言</div></div><div><br/></div><div>-----------------------------------------------------------------------------------------------</div><div>是将c的压缩算法转换为Verilog语言的?</div><div><br/></div><div><br/></div><div>题目要不要改成: 软硬件结合的大数据压缩算法的设计与实现?</div><div><br/></div><div>超压是什么意思</div><div>想想除了节约CPU时间, 还有什么地方是硬件加速快的原因。可以问磊哥</div><div>    硬件压缩的速度就是快于CPU跑软件代码? </div><div>    还是因为CPU是有时间片的,不能一直持续压缩,要不断切换上下文? </div><div>找一下c源码哪里调了驱动或硬件,以及c源码到底干了啥。(<span style="color: rgb(166, 0, 196);">重点看的是为啥数据头要12个字节,这12个字节是干啥用的</span>?  一次性压缩的最大数据量是不是跟硬件寄存器的数量有关?)</div><div>    c源码中的common.c文件是软件压缩算法吗? 比如pack_rle函数之类的。可以问问磊哥软件压缩方式在databox里是如何实现的。</div><div>打开虚拟机 ,用上利平给的jar包, 看看Text和Parquet格式是不是不用修改源码也能使用databox</div><div>看看v5代码和v7的区别</div><div>数据存储格式Parquet、Orc、Text</div><div>Verilog语言。</div><div><br/></div><div>-------------------------------------------</div><div>需要知道的内容:</div><div>(1)数据量小于DATABOX_BLOCK_MIN_SIZE, 硬件不能压缩?</div><div><img src="代码对比_files/Image.png" type="image/png" data-filename="Image.png"/></div><div>数据头为block_header, 是一个长度为3的unsigned int的数组, 所以数据头为12个字节,定义如下:</div><div>    <span style="background-color: rgb(30, 30, 30); font-size: 14px; white-space: pre; color: rgb(86, 156, 214); font-family: Consolas, &quot;Courier New&quot;, monospace; line-height: 19px;">unsigned</span><span style="background-color: rgb(30, 30, 30); font-size: 14px; white-space: pre; color: rgb(212, 212, 212); font-family: Consolas, &quot;Courier New&quot;, monospace; line-height: 19px;"> </span><span style="background-color: rgb(30, 30, 30); font-size: 14px; white-space: pre; color: rgb(86, 156, 214); font-family: Consolas, &quot;Courier New&quot;, monospace; line-height: 19px;">int</span><span style="background-color: rgb(30, 30, 30); font-size: 14px; white-space: pre; color: rgb(212, 212, 212); font-family: Consolas, &quot;Courier New&quot;, monospace; line-height: 19px;"> </span><span style="background-color: rgb(30, 30, 30); font-size: 14px; white-space: pre; color: rgb(156, 220, 254); font-family: Consolas, &quot;Courier New&quot;, monospace; line-height: 19px;">block_header</span><span style="background-color: rgb(30, 30, 30); font-size: 14px; white-space: pre; color: rgb(212, 212, 212); font-family: Consolas, &quot;Courier New&quot;, monospace; line-height: 19px;">[</span><span style="background-color: rgb(30, 30, 30); font-size: 14px; white-space: pre; color: rgb(181, 206, 168); font-family: Consolas, &quot;Courier New&quot;, monospace; line-height: 19px;">3</span><span style="background-color: rgb(30, 30, 30); font-size: 14px; white-space: pre; color: rgb(212, 212, 212); font-family: Consolas, &quot;Courier New&quot;, monospace; line-height: 19px;">];</span></div><div>压缩成功时 数据头的第一个元素(4字节)为:    </div><div>    <span style="background-color: rgb(30, 30, 30); font-size: 14px; white-space: pre; color: rgb(156, 220, 254); font-family: Consolas, &quot;Courier New&quot;, monospace; line-height: 19px;">block_header</span><span style="background-color: rgb(30, 30, 30); font-size: 14px; white-space: pre; color: rgb(212, 212, 212); font-family: Consolas, &quot;Courier New&quot;, monospace; line-height: 19px;">[</span><span style="background-color: rgb(30, 30, 30); font-size: 14px; white-space: pre; color: rgb(181, 206, 168); font-family: Consolas, &quot;Courier New&quot;, monospace; line-height: 19px;">0</span><span style="background-color: rgb(30, 30, 30); font-size: 14px; white-space: pre; color: rgb(212, 212, 212); font-family: Consolas, &quot;Courier New&quot;, monospace; line-height: 19px;">] = </span><span style="background-color: rgb(30, 30, 30); font-size: 14px; white-space: pre; color: rgb(181, 206, 168); font-family: Consolas, &quot;Courier New&quot;, monospace; line-height: 19px;">0x0000dbdb</span><span style="background-color: rgb(30, 30, 30); font-size: 14px; white-space: pre; color: rgb(212, 212, 212); font-family: Consolas, &quot;Courier New&quot;, monospace; line-height: 19px;"> | (</span><span style="background-color: rgb(30, 30, 30); font-size: 14px; white-space: pre; color: rgb(86, 156, 214); font-family: Consolas, &quot;Courier New&quot;, monospace; line-height: 19px;">DATABOX_ARCH_CUR</span><span style="background-color: rgb(30, 30, 30); font-size: 14px; white-space: pre; color: rgb(212, 212, 212); font-family: Consolas, &quot;Courier New&quot;, monospace; line-height: 19px;"> &lt;&lt; </span><span style="background-color: rgb(30, 30, 30); font-size: 14px; white-space: pre; color: rgb(181, 206, 168); font-family: Consolas, &quot;Courier New&quot;, monospace; line-height: 19px;">24</span><span style="background-color: rgb(30, 30, 30); font-size: 14px; white-space: pre; color: rgb(212, 212, 212); font-family: Consolas, &quot;Courier New&quot;, monospace; line-height: 19px;">);     </span><span style="background-color: rgb(30, 30, 30); font-size: 14px; white-space: pre; color: rgb(106, 153, 85); font-family: Consolas, &quot;Courier New&quot;, monospace; line-height: 19px;">// header info</span></div><div>压缩失败时, 数据头为:、</div><div>    <span style="background-color: rgb(30, 30, 30); font-size: 14px; white-space: pre; color: rgb(156, 220, 254); font-family: Consolas, &quot;Courier New&quot;, monospace; line-height: 19px;">block_header</span><span style="background-color: rgb(30, 30, 30); font-size: 14px; white-space: pre; color: rgb(212, 212, 212); font-family: Consolas, &quot;Courier New&quot;, monospace; line-height: 19px;">[</span><span style="background-color: rgb(30, 30, 30); font-size: 14px; white-space: pre; color: rgb(181, 206, 168); font-family: Consolas, &quot;Courier New&quot;, monospace; line-height: 19px;">0</span><span style="background-color: rgb(30, 30, 30); font-size: 14px; white-space: pre; color: rgb(212, 212, 212); font-family: Consolas, &quot;Courier New&quot;, monospace; line-height: 19px;">] = </span><span style="background-color: rgb(30, 30, 30); font-size: 14px; white-space: pre; color: rgb(181, 206, 168); font-family: Consolas, &quot;Courier New&quot;, monospace; line-height: 19px;">0x0001dbdb</span><span style="background-color: rgb(30, 30, 30); font-size: 14px; white-space: pre; color: rgb(212, 212, 212); font-family: Consolas, &quot;Courier New&quot;, monospace; line-height: 19px;">;                                </span><span style="background-color: rgb(30, 30, 30); font-size: 14px; white-space: pre; color: rgb(106, 153, 85); font-family: Consolas, &quot;Courier New&quot;, monospace; line-height: 19px;">//magic number</span></div><div><br/></div><div><br/></div><div>数据用硬件压缩失败时, block_header如下:</div><div><img src="代码对比_files/Image [1].png" type="image/png" data-filename="Image.png"/></div><div>数据用硬件压缩成功时, block_header如下: 可以看到block_header[0]是由magic number | hardware version组成的。</div><div><img src="代码对比_files/Image [2].png" type="image/png" data-filename="Image.png"/></div><div><img src="代码对比_files/Image [3].png" type="image/png" data-filename="Image.png"/></div><div><br/></div><div><br/></div><div><br/></div></span>
</div></body></html> 