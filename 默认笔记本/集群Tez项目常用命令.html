<html>
<head>
  <title>集群Tez项目常用命令:</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/603932 (zh-CN, DDL); Windows/10.0.0 (Win64); EDAMVersion=V2;"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 12pt;
    }
  </style>
</head>
<body>
<a name="6514"/>
<h1>集群Tez项目常用命令:</h1>
<div>
<table bgcolor="#D4DDE5" border="0">
<tr><td><b>创建时间：</b></td><td><i>2021/1/20 16:44</i></td></tr>
<tr><td><b>更新时间：</b></td><td><i>2021/4/9 9:41</i></td></tr>
</table>
</div>
<br/>

<div>
<span><div>SNAPPY:</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>create table xiaochuan_parquet_snappy_mr stored as parquet tblproperties(&quot;parquet.compression&quot;=&quot;SNAPPY&quot;) as select * from dns_text_100m_none;</div><div>select * from xiaochuan_parquet_snappy_mr limit 10;</div><div>drop table xiaochuan_parquet_snappy_mr;</div><div><br/></div><div>create table xiaochuan_parquet_snappy_mr stored as parquet tblproperties(&quot;parquet.compression&quot;=&quot;SNAPPY&quot;) as select * from test_dns_500g;</div><div>select * from xiaochuan_parquet_snappy_mr limit 10;</div><div>drop table xiaochuan_parquet_snappy_mr;</div></div><div><br/></div><div>DATABOX:</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>create table xiaochuan_parquet_databox_tez stored as parquet tblproperties(&quot;parquet.compression&quot;=&quot;DATABOX&quot;) as select * from dns_text_100m_none;</div><div>select * from xiaochuan_parquet_databox_tez limit 10;</div><div>drop table xiaochuan_parquet_databox_tez;</div><div><br/></div><div>create table xiaochuan_parquet_databox_tez stored as parquet tblproperties(&quot;parquet.compression&quot;=&quot;DATABOX&quot;) as select * from test_dns_500g;</div><div>select * from xiaochuan_parquet_databox_tez limit 10;</div><div>drop table xiaochuan_parquet_databox_tez;</div></div><div>    </div><div><span style="color: rgb(255, 0, 0);">set hive.execution.engine=tez;</span></div><div><br/></div><div>SNAPPY</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>create table xiaochuan_parquet_snappy_tez stored as parquet tblproperties(&quot;parquet.compression&quot;=&quot;SNAPPY&quot;) as select * from test_dns_500g;</div><div>select * from xiaochuan_parquet_snappy_tez limit 10;</div><div>drop table xiaochuan_parquet_snappy_tez;</div></div><div>DATABOX</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>create table xiaochuan_parquet_databox_tez stored as parquet tblproperties(&quot;parquet.compression&quot;=&quot;DATABOX&quot;) as select * from test_dns_500g;</div><div>select * from xiaochuan_parquet_databox_tez limit 10;</div><div>drop table xiaochuan_parquet_databox_tez;</div></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><span style="font-weight: bold;">dns数据建表和导入数据语句:</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>CREATE TABLE test_dns_500g(</div><div>LENGTH STRING,LOCAL_PROVINCE STRING,LOCAL_CITY STRING,OWNER_PROVINCE STRING,</div><div>OWNER_CITY STRING,ROAM_TYPE STRING,INTERFACE STRING,XDR_ID STRING,RAT STRING,</div><div>IMSI STRING,IMEI STRING,MSISDN STRING,MACHINE_IP_ADD_TYPE STRING,SGW_GGSN_IP_ADD STRING,</div><div>ENB_SGSN_IP_ADD STRING,PGW_ADD STRING,SGW_GGSN_PORT STRING,ENB_SGSN_PORT STRING,</div><div>PGW_PORT STRING,ENB_SGSN_GTP_TEID STRING,SGW_GGSN_GTP_TEID STRING,TAC STRING,ECI STRING,</div><div>APN STRING,APP_TYPE_CODE STRING,PROCEDURE_START_TIME STRING,PROCEDURE_END_TIME STRING,</div><div>LONGITUDE STRING,LATITUDE STRING,PROTOCOL_TYPE STRING,APP_TYPE STRING,APP_SUB_TYPE STRING,</div><div>APP_CONTENT STRING,APP_STATUS STRING,IP_ADDRESS_TYPE STRING,USER_IPV4 STRING,USER_IPV6 STRING,</div><div>USER_PORT STRING,L4_PROTOCAL STRING,APP_SERVER_IP_IPV4 STRING,APP_SERVER_IP_IPV6 STRING,</div><div>APP_SERVER_PORT STRING,UL_DATA STRING,DL_DATA STRING,UL_IP_PACKET STRING,DL_IP_PACKET STRING,</div><div>UL_DURA STRING,DL_DURA STRING,UL_DISORDER_IP_PACKET STRING,DL_DISORDER_IP_PACKET STRING,</div><div>UL_RETRANS_IP_PACKET STRING,DL_RETRANS_IP_PACKET STRING,TCP_RESPONSE_TIME STRING,TCP_ACK_TIME STRING,</div><div>UL_IP_FRAG_PACKETS STRING,DL_IP_FRAG_PACKETS STRING,FIRST_REQ_TIME STRING,FIRST_RESPONSE_TIME STRING,</div><div>WINDOW_SIZE STRING,MSS STRING,TCP_SYN_NUM STRING,TCP_STATUS STRING,SESSION_END STRING,TCP_SYN_ACK_MUM STRING,</div><div>TCP_ACK_NUM STRING,TCP1_2_HANDSHAKE_STATUS STRING,TCP2_3_HANDSHAKE_STATUS STRING,REPETITION STRING,</div><div>DOMAIN_NAME STRING,IP_ADDR_NUM STRING,IP_ADDR STRING,RCODE STRING,DNSREQ_NUM STRING,ANCOUNT STRING,</div><div>NSCOUNT STRING,ARCOUNT STRING,RESPONSE_TIME STRING)</div><div>ROW FORMAT DELIMITED FIELDS TERMINATED BY '|' LINES TERMINATED BY '\n';</div><div><br/></div><div>数据在hdfs上:</div><div>LOAD DATA INPATH '/tmp/testdata0504/dns/dnstestdata' OVERWRITE INTO TABLE test_dns_500g;</div><div><br/></div><div><br/></div><div>数据在本地:</div><div>LOAD DATA LOCAL INPATH '/tmp/testdata0504/dns/dnstestdata' OVERWRITE INTO TABLE test_dns_500g;</div></div><div><br/></div><div>在hdfs生成hive数据常用命令: </div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>hadoop jar ./databox-hadoop-utils-1.0.0.jar DataboxHiveDataGen -sqlGen -nrFiles 10 -fileSize 50GB -hdfsOutput /tmp/test/sqldata</div></div><div><br/></div><div>查看并杀死yarn application(MR或Tez的作业):</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>yarn application -list</div><div>yarn application -kill 具体的Application-Id</div></div><div><br/></div><div>清缓存命令:</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>ssh -o StrictHostKeyChecking=no datanode1 &quot;echo 3 &gt; /proc/sys/vm/drop_caches ; sync&quot; &amp;</div><div>ssh -o StrictHostKeyChecking=no datanode2 &quot;echo 3 &gt; /proc/sys/vm/drop_caches ; sync&quot; &amp;</div><div>ssh -o StrictHostKeyChecking=no datanode3 &quot;echo 3 &gt; /proc/sys/vm/drop_caches ; sync&quot; &amp;</div><div>ssh -o StrictHostKeyChecking=no datanode4 &quot;echo 3 &gt; /proc/sys/vm/drop_caches ; sync&quot;</div></div><div><br/></div><div><br/></div><div>测试:</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>清缓存:drop_caches.sh</div><div><br/></div><div>归零show_speed的压缩数据: compress_erase.sh</div><div><br/></div><div>归零show_speed的解压缩数据: decompress_erase.sh</div><div><br/></div><div>nmon工具启动: /root/xiaochuan_test/databox-bigdata-utils/DBAutoTests/commons/tools/nmon_x86_64_centos6</div></div><div><br/></div><div>parquet: </div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-weight: bold;">SNAPPY:</span></div><div>create table dns_parquet_snappy_tez stored as parquet tblproperties(&quot;<a href="http://parquet.compression/">parquet.compression&quot;=&quot;</a>SNAPPY&quot;) as select * from test_dns_500g;</div><div><br/></div><div>select * from dns_parquet_snappy_tez where length='716529006' and xdr_id='593f8aa00000005408175400405ca1d7' and imsi='460028477815285' and imei='8673520217878300' and msisdn='8615849138392' and sgw_ggsn_ip_add='100.232.255.48' and enb_sgsn_ip_add='100.205.133.28' and APN='tmcan.ncb002.hkk460.rpqa' and PROCEDURE_START_TIME='1497336478067228' and PROCEDURE_END_TIME='1497336481163059' and USER_IPV4='37.94.228.238' and APP_SERVER_IP_IPV4='22.138.91.253';</div><div><b><br/></b></div><div><b>GZIP:</b></div><div>create table dns_parquet_gzip_tez stored as parquet tblproperties(&quot;parquet.compression&quot;=&quot;GZIP&quot;) as select * from test_dns_500g;</div><div><br/></div><div>select * from dns_parquet_gzip_tez where length='716529006' and xdr_id='593f8aa00000005408175400405ca1d7' and imsi='460028477815285' and imei='8673520217878300' and msisdn='8615849138392' and sgw_ggsn_ip_add='100.232.255.48' and enb_sgsn_ip_add='100.205.133.28' and APN='tmcan.ncb002.hkk460.rpqa' and PROCEDURE_START_TIME='1497336478067228' and PROCEDURE_END_TIME='1497336481163059' and USER_IPV4='37.94.228.238' and APP_SERVER_IP_IPV4='22.138.91.253';</div><div><br/></div><div><span style="font-weight: bold;">DATABOX:</span></div><div>create table dns_parquet_databox_tez stored as parquet tblproperties(&quot;<a href="http://parquet.compression/">parquet.compression&quot;=&quot;DATABOX</a>&quot;) as select * from test_dns_500g;</div><div><br/></div><div>select * from dns_parquet_databox_tez where length='716529006' and xdr_id='593f8aa00000005408175400405ca1d7' and imsi='460028477815285' and imei='8673520217878300' and msisdn='8615849138392' and sgw_ggsn_ip_add='100.232.255.48' and enb_sgsn_ip_add='100.205.133.28' and APN='tmcan.ncb002.hkk460.rpqa' and PROCEDURE_START_TIME='1497336478067228' and PROCEDURE_END_TIME='1497336481163059' and USER_IPV4='37.94.228.238' and APP_SERVER_IP_IPV4='22.138.91.253';</div></div><div>orc:</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-weight: bold;">SNAPPY:</span></div><div>create table dns_orc_snappy_tez stored as orc tblproperties(&quot;<a href="http://orc.compress/">orc.compress&quot;=&quot;SNAPPY</a>&quot;) as select * from test_dns_500g;</div><div><br/></div><div>select * from dns_orc_snappy_tez where length='716529006' and xdr_id='593f8aa00000005408175400405ca1d7' and imsi='460028477815285' and imei='8673520217878300' and msisdn='8615849138392' and sgw_ggsn_ip_add='100.232.255.48' and enb_sgsn_ip_add='100.205.133.28' and APN='tmcan.ncb002.hkk460.rpqa' and PROCEDURE_START_TIME='1497336478067228' and PROCEDURE_END_TIME='1497336481163059' and USER_IPV4='37.94.228.238' and APP_SERVER_IP_IPV4='22.138.91.253';</div><div><br/></div><div><b>ZLIB:</b></div><div>create table dns_orc_zlib_tez stored as orc tblproperties(&quot;orc.compress&quot;=&quot;ZLIB&quot;) as select * from test_dns_500g;</div><div><br/></div><div>select * from dns_orc_zlib_tez where length='716529006' and xdr_id='593f8aa00000005408175400405ca1d7' and imsi='460028477815285' and imei='8673520217878300' and msisdn='8615849138392' and sgw_ggsn_ip_add='100.232.255.48' and enb_sgsn_ip_add='100.205.133.28' and APN='tmcan.ncb002.hkk460.rpqa' and PROCEDURE_START_TIME='1497336478067228' and PROCEDURE_END_TIME='1497336481163059' and USER_IPV4='37.94.228.238' and APP_SERVER_IP_IPV4='22.138.91.253';</div><div><br/></div><div><span style="font-weight: bold;">DATABOX:</span></div><div>create table dns_orc_databox_tez stored as orc tblproperties(&quot;<a href="http://orc.compress/">orc.compress&quot;=&quot;DATABOX</a>&quot;) as select * from test_dns_500g;</div><div><br/></div><div>select * from dns_orc_databox_tez where length='716529006' and xdr_id='593f8aa00000005408175400405ca1d7' and imsi='460028477815285' and imei='8673520217878300' and msisdn='8615849138392' and sgw_ggsn_ip_add='100.232.255.48' and enb_sgsn_ip_add='100.205.133.28' and APN='tmcan.ncb002.hkk460.rpqa' and PROCEDURE_START_TIME='1497336478067228' and PROCEDURE_END_TIME='1497336481163059' and USER_IPV4='37.94.228.238' and APP_SERVER_IP_IPV4='22.138.91.253';</div></div><div>text:</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-weight: bold;">SNAPPY:</span></div><div>set hive.exec.compress.output=true;</div><div>set mapreduce.output.fileoutputformat.compress.codec=org.apache.hadoop.io.compress.SnappyCodec;</div><div>set mapreduce.output.fileoutputformat.compress.type=BLOCK;</div><div>create table dns_text_snappy_tez stored as TEXTFILE as select * from test_dns_500g;</div><div><br/></div><div>select * from dns_text_snappy_tez where length='716529006' and xdr_id='593f8aa00000005408175400405ca1d7' and imsi='460028477815285' and imei='8673520217878300' and msisdn='8615849138392' and sgw_ggsn_ip_add='100.232.255.48' and enb_sgsn_ip_add='100.205.133.28' and APN='tmcan.ncb002.hkk460.rpqa' and PROCEDURE_START_TIME='1497336478067228' and PROCEDURE_END_TIME='1497336481163059' and USER_IPV4='37.94.228.238' and APP_SERVER_IP_IPV4='22.138.91.253';</div><div><br/></div><div><b>Gzip:</b></div><div>set hive.exec.compress.output=true;</div><div>set mapreduce.output.fileoutputformat.compress.codec=org.apache.hadoop.io.compress.GzipCodec;</div><div>set mapreduce.output.fileoutputformat.compress.type=BLOCK;</div><div>create table dns_text_gzip_tez stored as TEXTFILE as select * from test_dns_500g;</div><div><br/></div><div>select * from dns_text_gzip_tez where length='716529006' and xdr_id='593f8aa00000005408175400405ca1d7' and imsi='460028477815285' and imei='8673520217878300' and msisdn='8615849138392' and sgw_ggsn_ip_add='100.232.255.48' and enb_sgsn_ip_add='100.205.133.28' and APN='tmcan.ncb002.hkk460.rpqa' and PROCEDURE_START_TIME='1497336478067228' and PROCEDURE_END_TIME='1497336481163059' and USER_IPV4='37.94.228.238' and APP_SERVER_IP_IPV4='22.138.91.253';</div><div><br/></div><div><span style="font-weight: bold;">DATABOX:</span></div><div>set hive.exec.compress.output=true;</div><div>set mapreduce.output.fileoutputformat.compress.codec=com.hadoop.compression.databox.DataboxCodec;</div><div>set mapreduce.output.fileoutputformat.compress.type=BLOCK;</div><div>create table dns_text_databox_tez stored as TEXTFILE as select * from test_dns_500g;</div><div><br/></div><div>select * from dns_text_databox_tez where length='716529006' and xdr_id='593f8aa00000005408175400405ca1d7' and imsi='460028477815285' and imei='8673520217878300' and msisdn='8615849138392' and sgw_ggsn_ip_add='100.232.255.48' and enb_sgsn_ip_add='100.205.133.28' and APN='tmcan.ncb002.hkk460.rpqa' and PROCEDURE_START_TIME='1497336478067228' and PROCEDURE_END_TIME='1497336481163059' and USER_IPV4='37.94.228.238' and APP_SERVER_IP_IPV4='22.138.91.253';</div></div><div><br/></div><div><br/></div><div><br/></div></span>
</div></body></html> 