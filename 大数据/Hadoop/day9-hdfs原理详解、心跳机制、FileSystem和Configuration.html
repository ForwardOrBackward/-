<html>
<head>
  <title>day9-hdfs原理详解、心跳机制、FileSystem和Configuration</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/603932 (zh-CN, DDL); Windows/10.0.0 (Win64); EDAMVersion=V2;"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 12pt;
    }
  </style>
</head>
<body>
<a name="1775"/>
<h1>day9-hdfs原理详解、心跳机制、FileSystem和Configuration</h1>
<div>
<table bgcolor="#D4DDE5" border="0">
<tr><td><b>创建时间：</b></td><td><i>2019/8/10 17:10</i></td></tr>
<tr><td><b>更新时间：</b></td><td><i>2021/3/17 10:59</i></td></tr>
</table>
</div>
<br/>

<div>
<span><div><span style="font-weight: bold;">1、FileSystem和Configuration类的使用：</span></div><div>（1）最简单的上传文件到hdfs的方法</div><div><img src="day9-hdfs原理详解、心跳机制、FileSystem和Configuration_files/Image.png" type="image/png" data-filename="Image.png"/></div><div><br/></div><div>（2）打成jar包到linux来调用的方法</div><div><img src="day9-hdfs原理详解、心跳机制、FileSystem和Configuration_files/Image [1].png" type="image/png" data-filename="Image.png"/></div><div><br/></div><div>    linux里的调用：</div><div><img src="day9-hdfs原理详解、心跳机制、FileSystem和Configuration_files/Image [2].png" type="image/png" data-filename="Image.png"/></div><div><br/></div><div>（3）上传文件的系统为本地Windows系统：</div><div><img src="day9-hdfs原理详解、心跳机制、FileSystem和Configuration_files/Image [3].png" type="image/png" data-filename="Image.png"/></div><div>（4）通过配置使上传的文件系统为hdfs系统：</div><div>        1）手动设置配置的方法：</div><div><img src="day9-hdfs原理详解、心跳机制、FileSystem和Configuration_files/Image [4].png" type="image/png" data-filename="Image.png"/></div><div><br/></div><div>        2）让系统自动加载配置的方法：</div><div>           加入自己在linux环境中修改过的core-site.xml 文件在<span style="color: rgb(166, 0, 196);">src</span>目录下，将conf.set注释掉，也可得到和上图一样的结果：</div><div><img src="day9-hdfs原理详解、心跳机制、FileSystem和Configuration_files/Image [5].png" type="image/png" data-filename="Image.png"/></div><div><br/></div><div>        其中core-site.xml里面的的内容是：</div><div><img src="day9-hdfs原理详解、心跳机制、FileSystem和Configuration_files/Image [6].png" type="image/png" data-filename="Image.png"/></div><div>        得出结论：</div><div><img src="day9-hdfs原理详解、心跳机制、FileSystem和Configuration_files/Image [7].png" type="image/png" data-filename="Image.png"/></div><div><img src="day9-hdfs原理详解、心跳机制、FileSystem和Configuration_files/Image [8].png" type="image/png" data-filename="Image.png"/></div><div><img src="day9-hdfs原理详解、心跳机制、FileSystem和Configuration_files/Image [9].png" type="image/png" data-filename="Image.png"/></div><div><br/></div><div>        3）手动加载配置文件的方式见下图：</div><div><img src="day9-hdfs原理详解、心跳机制、FileSystem和Configuration_files/Image [10].png" type="image/png" data-filename="Image.png"/></div><div><br/></div><div>（5）eclipse中读取配置信息的方法:</div><div>    如果eclipse中没有加载hadoop集群中我们修改过的core-site.xml  yarn-site.xml  mapred-site.xml  hdfs-site.xml 配置文件的话，那么如果是<span style="color: rgb(166, 0, 196);">通过eclipse的代码来上传文件</span>的话（<span style="color: rgb(166, 0, 196);">区别于 在搭建好hadoop集群的linux某节点中上传文件</span>），是会直接按照系统最开始的默认设置来上传文件，比如说fs.defaultFS会默认是本地文件系统，比如说上传的副本数本来修改成了2，结果上传后还是默认的3份。</div><div>     所以我们要把hadoop集群中的配置文件下载下来再复制到eclipse项目中来。</div><div><br/></div><div>       优先级如下：</div><div><img src="day9-hdfs原理详解、心跳机制、FileSystem和Configuration_files/Image [11].png" type="image/png" data-filename="Image.png"/></div><div><br/></div><div>        总结经验：</div><div><img src="day9-hdfs原理详解、心跳机制、FileSystem和Configuration_files/Image [12].png" type="image/png" data-filename="Image.png"/></div><div><br/></div><div><br/></div><div><span style="font-weight: bold;">2、hdfs底层心跳机制的工作模式</span></div><div><img src="day9-hdfs原理详解、心跳机制、FileSystem和Configuration_files/Image [13].png" type="image/png" data-filename="Image.png"/></div><div><br/></div><div><span style="font-weight: bold;">3、副本存放策略：</span></div><div><img src="day9-hdfs原理详解、心跳机制、FileSystem和Configuration_files/Image [14].png" type="image/png" data-filename="Image.png"/></div><div><br/></div><div><br/></div><div><span style="font-weight: bold;">4、HDFS读写数据流程:</span></div><div><br/></div><div><img src="day9-hdfs原理详解、心跳机制、FileSystem和Configuration_files/HDFS读写原理.png" type="image/png" data-filename="HDFS读写原理.png"/></div><div><br/></div><div><br/></div><div><span style="text-align: center; color: rgb(134, 0, 164); font-weight: bold;">——————————————————————</span><span style="text-align: center; color: rgb(134, 0, 164); font-weight: bold;">—</span><span style="text-align: center; color: rgb(134, 0, 164); font-weight: bold;">手写与上传资料分割线</span><span style="text-align: center; color: rgb(134, 0, 164); font-weight: bold;">—</span><span style="text-align: center; color: rgb(134, 0, 164); font-weight: bold;">————————————————————</span></div><div><br/></div><div><span style="font-size: medium; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><br/></span></div><div><a href="day9-hdfs原理详解、心跳机制、FileSystem和Configuration_files/hadoop-hdfs-part2-原理详解.pdf"><img src="day9-hdfs原理详解、心跳机制、FileSystem和Configuration_files/78d95acc007c62e570b4a938a389ca4f.png" alt="hadoop-hdfs-part2-原理详解.pdf"></a></div><div><br/></div><div><br/></div><div>[hadoop@hadoop02 ~]$ hdfs getconf -namenodes</div><div>hadoop02</div><div>[hadoop@hadoop02 ~]$ hdfs getconf -confKey dfs.heartbeat.interval</div><div>3</div><div>[hadoop@hadoop02 ~]$ hdfs getconf -confKey dfs.replication</div><div>2</div><div>[hadoop@hadoop02 ~]$ hdfs getconf -confKey dfs.blocksize</div><div>134217728</div><div><br/></div><div><br/></div><div><br/></div><div>副本存放策略：</div><div><br/></div><div>     一个数据块在默认情况下有3个副本。 这三个副本应该怎么分布在集群中？</div><div><br/></div><div>     为什么有这么个问题？</div><div><br/></div><div>     1、3个副本，绝对不会有任意两个副本会分布在同一个节点</div><div><br/></div><div>     2、这三个副本应该在那三个节点？</div><div><br/></div><div>          完全随机？  不行</div><div><br/></div><div>          就直接把这个三副本块就放置在某个机架中的三个服务器里面。   不行</div><div><br/></div><div><br/></div><div>     最合理的方式：</div><div><br/></div><div>          很满  很忙</div><div><br/></div><div>          所有这个副本快选择节点的策略都是  选择 不满 不忙的机器的机器进行存储</div><div><br/></div><div><br/></div><div>负载不均衡</div><div> </div><div>---- 解决问题：  ------&gt;   使集群当中的所有节点的负载压力基本均衡</div><div><br/></div><div><br/></div><div><br/></div><div>start-balance.sh</div><div><br/></div><div>    延迟加载的机制    jvm的垃圾回收机制</div><div><br/></div><div>    gc()</div><div><br/></div></span>
</div></body></html> 