<html>
<head>
  <title>hadoop压缩框架</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/603932 (zh-CN, DDL); Windows/10.0.0 (Win64); EDAMVersion=V2;"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 12pt;
    }
  </style>
</head>
<body>
<a name="8029"/>
<h1>hadoop压缩框架</h1>
<div>
<table bgcolor="#D4DDE5" border="0">
<tr><td><b>创建时间：</b></td><td><i>2021/4/13 14:22</i></td></tr>
<tr><td><b>更新时间：</b></td><td><i>2021/8/1 13:22</i></td></tr>
</table>
</div>
<br/>

<div>
<span><div><br/></div><div style="font-size: 16px; min-width: 100%; position: relative;"><div style="background-color: rgb(255, 255, 255); text-size-adjust: none; font-size: 14px;"><div style="background-color:rgb(255, 255, 255);"><div style="text-overflow:ellipsis;overflow:hidden;word-break:break-all;"><div style="background-color:rgb(255, 255, 255);"><div style="text-overflow:ellipsis;overflow:hidden;word-break:break-all;"><div><h1 style="margin: 0px; padding: 0px 0px 0px 5px; clear: both; border-bottom: 1px solid rgb(153, 153, 153); font-size: 155%; float: left; width: 100%;"><a href="https://www.cnblogs.com/wuyudong/p/4378357.html" style="font-size: 155%; margin: 0px; padding: 0px; vertical-align: middle; color: rgb(165, 198, 59); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 500; line-height: 1.5em; text-decoration: none;">hadoop压缩框架</a></h1></div><div style="margin:0px;padding:0px;clear:both;"></div><div style="margin: 10px 0px 0px; padding: 5px 2px 5px 5px; font-size: 105%;"><div style="margin: 0px 0px 20px; padding: 0px; word-break: break-word; font-size: 15px;"><div style="padding: 0px; text-indent: 0px; margin: 10px auto;"><span style="margin: 0px; padding: 0px; font-size: 15px; color: rgb(0, 0, 0); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400; line-height: 1.5;">　　一般来说，计算机处理的数据都存在一些冗余度，同时数据中间，尤其是相邻数据间存在着相关性，所以可以</span><span style="margin: 0px; padding: 0px; background-color: rgb(0, 255, 0); font-size: 15px; color: rgb(0, 0, 0); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400; line-height: 1.5;">通过一些有别于原始编码的特殊编码方式来保存数据，使数据占用的存储空间比较小，这个过程一般叫压缩。和压缩对应的概念是解压缩，就是将被压缩的数据从特殊编码方式还原为原始数据的过程。</span></div><div style="padding: 0px; text-indent: 0px; margin: 10px auto;"><span style="font-size: 15px; color: rgb(0, 0, 0); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400; line-height: 1.5;">压缩广泛应用于海量数据处理中，对数据文件进行压缩，可以有效减少存储文件所需的空间，并加快数据在网络上或者到磁盘上的传输速度。</span><span style="margin: 0px; padding: 0px; background-color: rgb(0, 255, 0); font-size: 15px; color: rgb(0, 0, 0); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400; line-height: 1.5;">在Hadoop中，压缩应用于文件存储、Map阶段到Reduce阶段的数据交换（需要打开相关的选项）等情景。</span></div><div style="padding: 0px; text-indent: 0px; margin: 10px auto;"><span style="font-size: 11pt; font-family: &quot;HanHei SC&quot;;"><img src="hadoop压缩框架_files/src=http___upload-images.jianshu.io_upload_images_15567473-2fc85402a063fe9d.png&refer=http___upload-images.jianshu.jpg" type="image/jpeg" data-filename="src=http___upload-images.jianshu.io_upload_images_15567473-2fc85402a063fe9d.png&refer=http___upload-images.jianshu.jpg"/></span></div><div style="padding: 0px; text-indent: 0px; margin: 10px auto;"><span style="font-size: 15px; color: rgb(0, 0, 0); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400; line-height: 1.5;">数据压缩的方式非常多，不同特点的数据有不同的数据压缩方式：如对声音和图像等特殊数据的压缩，就可以采用有损的压缩方法，允许压缩过程中损失一定的信息，换取比较大的压缩比；而对音乐数据的压缩，由于数据有自己比较特殊的编码方式，因此也可以采用一些针对这些特殊编码的专用数据压缩算法。</span></div><h2 style="padding: 5px 0px 5px 8px; background: none 0px 0px repeat scroll rgb(165, 198, 59); letter-spacing: 1px; margin: 10px 0px; font-size: 21px;"><span style="font-size: 21px; color: rgb(255, 255, 255); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: bold; line-height: 1.5;">Hadoop压缩简介</span></h2><div style="padding: 0px; text-indent: 0px; margin: 10px auto;"><span style="font-size: 15px; color: rgb(0, 0, 0); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400; line-height: 1.5;">Hadoop作为一个较通用的海量数据处理平台，在使用压缩方式方面，主要考虑压缩速度和压缩文件的可分割性。</span></div><div style="padding: 0px; text-indent: 0px; margin: 10px auto;"><span style="font-size: 15px; color: rgb(0, 0, 0); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400; line-height: 1.5;">所有的压缩算法都会考虑时间和空间的权衡，更快的压缩和解压缩速度通常会耗费更多的空间（压缩比较低）。例如，通过gzip命令压缩数据时，用户可以设置不同的选项来选择速度优先或空间优先，选项–1表示优先考虑速度，选项–9表示空间最优，可以获得最大的压缩比。</span></div><div style="padding: 0px; text-indent: 0px; margin: 10px auto;"><span style="font-size: 15px; color: rgb(0, 0, 0); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400; line-height: 1.5;">需要注意的是，有些压缩算法的压缩和解压缩速度会有比较大的差别：gzip和zip是通用的压缩工具，在时间/空间处理上相对平衡，gzip2压缩比gzip和zip更有效，但速度较慢，而且bzip2的解压缩速度快于它的压缩速度。</span></div><div style="padding: 0px; text-indent: 0px; margin: 10px auto;"><span style="margin: 0px; padding: 0px; background-color: rgb(0, 255, 0); font-size: 15px; color: rgb(0, 0, 0); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400; line-height: 1.5;">当使用MapReduce处理压缩文件时，需要考虑压缩文件的可分割性。</span><span style="font-size: 15px; color: rgb(0, 0, 0); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400; line-height: 1.5;">考虑我们需要对保持在HDFS上的一个大小为1GB的文本文件进行处理，当前HDFS的数据块大小为64MB的情况下，该文件被存储为16块，对应的MapReduce作业将会将该文件分为16个输入分片，提供给16个独立的Map任务进行处理。但如果该文件是一个gzip格式的压缩文件（大小不变），这时，MapReduce作业不能够将该文件分为16个分片，因为不可能从gzip数据流中的某个点开始，进行数据解压。但是，如果该文件是一个bzip2格式的压缩文件，那么，MapReduce作业可以通过bzip2格式压缩文件中的块，将输入划分为若干输入分片，并从块开始处开始解压缩数据。bzip2格式压缩文件中，块与块间提供了一个48位的同步标记，因此，</span><span style="margin: 0px; padding: 0px; background-color: rgb(0, 255, 0); font-size: 15px; color: rgb(0, 0, 0); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400; line-height: 1.5;">bzip2支持数据分割。</span></div><div style="padding: 0px; text-indent: 0px; margin: 10px auto;">可分割的意思就是: 如果一个文件大小为10g, 直接压缩后, 压缩包的大小为4g, 但这个压缩包是一个整体, 这个4g文件不能拆成几个小文件块(如4个1g 的文件块), 因为压缩描述信息一般会保存在压缩包的文件头, 如果将这个4g文件拆开, 那么没有压缩描述信息的文件块将无法解压缩, 不知道用的是哪种压缩算法。但如果把压缩描述信息放到拆开的每一个文件块中,那么这些文件块就变得都可以解压了, 而<span style="font-size: 11pt;">只将每个文件块的大小增大了一点。</span>这就是可分割。</div><div style="padding: 0px; text-indent: 0px; margin: 10px auto;"><span style="font-size: 15px; color: rgb(0, 0, 0); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400; line-height: 1.5;"><br/></span></div><div style="padding: 0px; text-indent: 0px; margin: 10px auto;"><span style="font-size: 15px; color: rgb(0, 0, 0); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400; line-height: 1.5;">Hadoop支持的压缩格式：</span></div><div style="margin: 0px; padding: 0px; overflow-x: auto;"><div><br/></div><table style="font-size: inherit; word-break: break-word; overflow-x: scroll; max-height: 800px; border-collapse: collapse; min-width: 100%;"><colgroup><col style="width: 130px;"></col><col style="width: 130px;"></col><col style="width: 130px;"></col><col style="width: 130px;"></col><col style="width: 130px;"></col><col style="width: 130px;"></col></colgroup><tbody style="margin:0px;padding:0px;"><tr style="padding: 0px;"><td style="border-collapse: collapse; border: 1px solid rgb(192, 192, 192); width: 130px; padding: 8px;"><span style="font-size: 15px; color: rgb(0, 0, 0); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400; line-height: 1.5;">压缩格式</span></td><td style="border-collapse: collapse; border: 1px solid rgb(192, 192, 192); width: 130px; padding: 8px;"><span style="font-size: 15px; color: rgb(0, 0, 0); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400; line-height: 1.5;">Unix工具</span></td><td style="border-collapse: collapse; border: 1px solid rgb(192, 192, 192); width: 130px; padding: 8px;"><span style="font-size: 15px; color: rgb(0, 0, 0); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400; line-height: 1.5;">算法</span></td><td style="border-collapse: collapse; border: 1px solid rgb(192, 192, 192); width: 130px; padding: 8px;"><span style="font-size: 15px; color: rgb(0, 0, 0); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400; line-height: 1.5;">文件扩展名</span></td><td style="border-collapse: collapse; border: 1px solid rgb(192, 192, 192); width: 130px; padding: 8px;"><span style="font-size: 15px; color: rgb(0, 0, 0); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400; line-height: 1.5;">支持多文件</span></td><td style="border-collapse: collapse; border: 1px solid rgb(192, 192, 192); width: 130px; padding: 8px;"><span style="font-size: 15px; color: rgb(0, 0, 0); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400; line-height: 1.5;">可分割</span></td></tr><tr style="padding: 0px;"><td style="border-collapse: collapse; border: 1px solid rgb(192, 192, 192); width: 130px; padding: 8px;"><span style="font-size: 15px; color: rgb(0, 0, 0); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400; line-height: 1.5;">DEFLATE</span></td><td style="border-collapse: collapse; border: 1px solid rgb(192, 192, 192); width: 130px; padding: 8px;"><span style="font-size: 15px; color: rgb(0, 0, 0); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400; line-height: 1.5;">无</span></td><td style="border-collapse: collapse; border: 1px solid rgb(192, 192, 192); width: 130px; padding: 8px;"><span style="font-size: 15px; color: rgb(0, 0, 0); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400; line-height: 1.5;">DEFLATE</span></td><td style="border-collapse: collapse; border: 1px solid rgb(192, 192, 192); width: 130px; padding: 8px;"><span style="font-size: 15px; color: rgb(0, 0, 0); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400; line-height: 1.5;">.deflate</span></td><td style="border-collapse: collapse; border: 1px solid rgb(192, 192, 192); width: 130px; padding: 8px;"><span style="font-size: 15px; color: rgb(0, 0, 0); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400; line-height: 1.5;">否</span></td><td style="border-collapse: collapse; border: 1px solid rgb(192, 192, 192); width: 130px; padding: 8px;"><span style="font-size: 15px; color: rgb(0, 0, 0); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400; line-height: 1.5;">否</span></td></tr><tr style="padding: 0px;"><td style="border-collapse: collapse; border: 1px solid rgb(192, 192, 192); width: 130px; padding: 8px;"><span style="font-size: 15px; color: rgb(0, 0, 0); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400; line-height: 1.5;">gzip</span></td><td style="border-collapse: collapse; border: 1px solid rgb(192, 192, 192); width: 130px; padding: 8px;"><span style="font-size: 15px; color: rgb(0, 0, 0); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400; line-height: 1.5;">gzip</span></td><td style="border-collapse: collapse; border: 1px solid rgb(192, 192, 192); width: 130px; padding: 8px;"><span style="font-size: 15px; color: rgb(0, 0, 0); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400; line-height: 1.5;">DEFLATE</span></td><td style="border-collapse: collapse; border: 1px solid rgb(192, 192, 192); width: 130px; padding: 8px;"><span style="font-size: 15px; color: rgb(0, 0, 0); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400; line-height: 1.5;">.gz</span></td><td style="border-collapse: collapse; border: 1px solid rgb(192, 192, 192); width: 130px; padding: 8px;"><span style="font-size: 15px; color: rgb(0, 0, 0); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400; line-height: 1.5;">否</span></td><td style="border-collapse: collapse; border: 1px solid rgb(192, 192, 192); width: 130px; padding: 8px;"><span style="font-size: 15px; color: rgb(0, 0, 0); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400; line-height: 1.5;">否</span></td></tr><tr style="padding: 0px;"><td style="border-collapse: collapse; border: 1px solid rgb(192, 192, 192); width: 130px; padding: 8px;"><span style="font-size: 15px; color: rgb(0, 0, 0); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400; line-height: 1.5;">zip</span></td><td style="border-collapse: collapse; border: 1px solid rgb(192, 192, 192); width: 130px; padding: 8px;"><span style="font-size: 15px; color: rgb(0, 0, 0); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400; line-height: 1.5;">zip</span></td><td style="border-collapse: collapse; border: 1px solid rgb(192, 192, 192); width: 130px; padding: 8px;"><span style="font-size: 15px; color: rgb(0, 0, 0); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400; line-height: 1.5;">DEFLATE</span></td><td style="border-collapse: collapse; border: 1px solid rgb(192, 192, 192); width: 130px; padding: 8px;"><span style="font-size: 15px; color: rgb(0, 0, 0); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400; line-height: 1.5;">.zip</span></td><td style="border-collapse: collapse; border: 1px solid rgb(192, 192, 192); width: 130px; padding: 8px;"><span style="font-size: 15px; color: rgb(0, 0, 0); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400; line-height: 1.5;">是</span></td><td style="border-collapse: collapse; border: 1px solid rgb(192, 192, 192); width: 130px; padding: 8px;"><span style="font-size: 15px; color: rgb(0, 0, 0); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400; line-height: 1.5;">是</span></td></tr><tr style="padding: 0px;"><td style="border-collapse: collapse; border: 1px solid rgb(192, 192, 192); width: 130px; padding: 8px;"><span style="font-size: 15px; color: rgb(0, 0, 0); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400; line-height: 1.5;">bzip</span></td><td style="border-collapse: collapse; border: 1px solid rgb(192, 192, 192); width: 130px; padding: 8px;"><span style="font-size: 15px; color: rgb(0, 0, 0); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400; line-height: 1.5;">bzip2</span></td><td style="border-collapse: collapse; border: 1px solid rgb(192, 192, 192); width: 130px; padding: 8px;"><span style="font-size: 15px; color: rgb(0, 0, 0); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400; line-height: 1.5;">bzip2</span></td><td style="border-collapse: collapse; border: 1px solid rgb(192, 192, 192); width: 130px; padding: 8px;"><span style="font-size: 15px; color: rgb(0, 0, 0); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400; line-height: 1.5;">.bz2</span></td><td style="border-collapse: collapse; border: 1px solid rgb(192, 192, 192); width: 130px; padding: 8px;"><span style="font-size: 15px; color: rgb(0, 0, 0); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400; line-height: 1.5;">否</span></td><td style="border-collapse: collapse; border: 1px solid rgb(192, 192, 192); width: 130px; padding: 8px;"><span style="font-size: 15px; color: rgb(0, 0, 0); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400; line-height: 1.5;">是</span></td></tr><tr style="padding: 0px;"><td style="border-collapse: collapse; border: 1px solid rgb(192, 192, 192); width: 130px; padding: 8px;"><span style="font-size: 15px; color: rgb(0, 0, 0); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400; line-height: 1.5;">LZO</span></td><td style="border-collapse: collapse; border: 1px solid rgb(192, 192, 192); width: 130px; padding: 8px;"><span style="font-size: 15px; color: rgb(0, 0, 0); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400; line-height: 1.5;">lzop</span></td><td style="border-collapse: collapse; border: 1px solid rgb(192, 192, 192); width: 130px; padding: 8px;"><span style="font-size: 15px; color: rgb(0, 0, 0); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400; line-height: 1.5;">LZO</span></td><td style="border-collapse: collapse; border: 1px solid rgb(192, 192, 192); width: 130px; padding: 8px;"><span style="font-size: 15px; color: rgb(0, 0, 0); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400; line-height: 1.5;">.lzo</span></td><td style="border-collapse: collapse; border: 1px solid rgb(192, 192, 192); width: 130px; padding: 8px;"><span style="font-size: 15px; color: rgb(0, 0, 0); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400; line-height: 1.5;">否</span></td><td style="border-collapse: collapse; border: 1px solid rgb(192, 192, 192); width: 130px; padding: 8px;"><span style="font-size: 15px; color: rgb(0, 0, 0); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400; line-height: 1.5;">否</span></td></tr></tbody></table><div><br/></div></div><div style="padding: 0px; text-indent: 0px; margin: 10px auto;"><span style="font-size: 15px; color: rgb(0, 0, 0); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400; line-height: 1.5;">为了支持多种压缩解压缩算法，Hadoop引入了编码/解码器。与Hadoop序列化框架类似，</span><span style="margin: 0px; padding: 0px; background-color: rgb(0, 255, 0); font-size: 15px; color: rgb(0, 0, 0); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400; line-height: 1.5;">编码/解码器也是使用抽象工厂的设计模式</span><span style="font-size: 15px; color: rgb(0, 0, 0); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400; line-height: 1.5;">。目前，Hadoop支持的编码/解码器如下</span></div><div style="padding: 0px; text-indent: 0px; margin: 10px auto;"><span style="font-size: 15px; color: rgb(0, 0, 0); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400; line-height: 1.5;">压缩算法及其编码/解码器：</span></div><div style="margin: 0px; padding: 0px; overflow-x: auto;"><div><br/></div><table style="font-size: inherit; word-break: break-word; overflow-x: scroll; max-height: 800px; border-collapse: collapse; min-width: 100%;"><colgroup><col style="width: 130px;"></col><col style="width: 345px;"></col></colgroup><tbody style="margin:0px;padding:0px;"><tr style="padding: 0px;"><td style="border-collapse: collapse; border: 1px solid rgb(192, 192, 192); width: 130px; padding: 8px;"><span style="font-size: 15px; color: rgb(0, 0, 0); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400; line-height: 1.5;">压缩格式</span></td><td style="border-collapse: collapse; border: 1px solid rgb(192, 192, 192); width: 345px; padding: 8px;"><span style="font-size: 15px; color: rgb(0, 0, 0); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400; line-height: 1.5;">对应的编码/解码器</span></td></tr><tr style="padding: 0px;"><td style="border-collapse: collapse; border: 1px solid rgb(192, 192, 192); width: 130px; padding: 8px;"><span style="font-size: 15px; color: rgb(0, 0, 0); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400; line-height: 1.5;">DEFLATE</span></td><td style="border-collapse: collapse; border: 1px solid rgb(192, 192, 192); width: 345px; padding: 8px;"><span style="font-size: 15px; color: rgb(0, 0, 0); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400; line-height: 1.5;">org.apache.hadoop.io.compress.DefaultCodec</span></td></tr><tr style="padding: 0px;"><td style="border-collapse: collapse; border: 1px solid rgb(192, 192, 192); width: 130px; padding: 8px;"><span style="font-size: 15px; color: rgb(0, 0, 0); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400; line-height: 1.5;">gzip</span></td><td style="border-collapse: collapse; border: 1px solid rgb(192, 192, 192); width: 345px; padding: 8px;"><span style="font-size: 15px; color: rgb(0, 0, 0); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400; line-height: 1.5;">org.apache.hadoop.io.compress.GzipCodec</span></td></tr><tr style="padding: 0px;"><td style="border-collapse: collapse; border: 1px solid rgb(192, 192, 192); width: 130px; padding: 8px;"><span style="font-size: 15px; color: rgb(0, 0, 0); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400; line-height: 1.5;">bzip</span></td><td style="border-collapse: collapse; border: 1px solid rgb(192, 192, 192); width: 345px; padding: 8px;"><span style="font-size: 15px; color: rgb(0, 0, 0); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400; line-height: 1.5;">org.apache.hadoop.io.compress.BZip2Codec</span></td></tr><tr style="padding: 0px;"><td style="border-collapse: collapse; border: 1px solid rgb(192, 192, 192); width: 130px; padding: 8px;"><span style="font-size: 15px; color: rgb(0, 0, 0); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400; line-height: 1.5;">Snappy</span></td><td style="border-collapse: collapse; border: 1px solid rgb(192, 192, 192); width: 345px; padding: 8px;"><span style="font-size: 15px; color: rgb(0, 0, 0); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400; line-height: 1.5;">org.apache.hadoop.io.compress.SnappyCodec</span></td></tr></tbody></table><div><br/></div></div><div style="padding: 0px; text-indent: 0px; margin: 10px auto;"><span style="font-size: 15px; color: rgb(0, 0, 0); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400; line-height: 1.5;">同一个压缩方法对应的压缩、解压缩相关工具，都可以通过相应的编码/解码器获得。</span></div><h2 style="padding: 5px 0px 5px 8px; background: none 0px 0px repeat scroll rgb(165, 198, 59); letter-spacing: 1px; margin: 10px 0px; font-size: 21px;"><span style="font-size: 21px; color: rgb(255, 255, 255); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: bold; line-height: 1.5;">Hadoop压缩API应用实例</span></h2><div style="padding: 0px; text-indent: 0px; margin: 10px auto;"><span style="font-size: 15px; color: rgb(0, 0, 0); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400; line-height: 1.5;">下面将介绍使用编码/解码器的典型实例（代码在org.hadoopinternal.compress包中）。其中，compress()方法接受一个字符串参数，用于指定编码/解码器，并用对应的压缩算法对文本文件README.txt进行压缩。字符串参数使用Java的反射机制创建对应的编码/解码器对象，通过CompressionCodec对象，进一步使用它的createOutputStream()方法构造一个CompressionOutputStream流，未压缩的数据通过IOUtils.copyBytes()方法，从输入文件流中复制写入CompressionOutputStream流，最终以压缩格式写入底层的输出流中。</span></div><div style="padding: 0px; text-indent: 0px; margin: 10px auto;"><span style="font-size: 15px; color: rgb(0, 0, 0); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400; line-height: 1.5;">在本实例中，底层使用的是文件输出流FileOutputStream，它关联文件的文件名，是在原有文件名的基础上添加压缩算法相应的扩展名生成。该扩展名可以通过CompressionCodec对象的getDefaultExtension()方法获得。相关代码如下：</span></div><div style="border-width: 1px 1px 1px 5px; border-color: rgb(204, 204, 204) rgb(204, 204, 204) rgb(204, 204, 204) rgb(108, 226, 108); border-image: initial; overflow: auto; padding: 5px; border-style: dashed dashed dashed solid; background-color: rgb(255, 255, 255); margin: 10px 0px; font-size: 12px;"><div style="overflow: auto; margin: 0px; padding: 0px; overflow-wrap: break-word; font-size: 12px;"><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">public</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">static</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">void</span> <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1;">compress(String method)</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">throws</span><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">…… {</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">File fileIn</span> <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1;">=</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">new</span> <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1;">File(&quot;README.txt&quot;</span><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">);</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 128, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">//</span><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 128, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">输入流</span></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1;">InputStream in =</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">new</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">FileInputStream(fileIn);</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px;"><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(0, 255, 0); color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">Class</span></span><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(0, 255, 0); color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">&lt;?&gt; codecClass =</span> <span style="margin: 0px; padding: 0px; font-size: 12px;"><span style="margin: 0px; padding: 0px; font-size: 12px; background-color: rgb(0, 255, 0); color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">Class.forName(method);</span></span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">Configuration conf</span> <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1;">=</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">new</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">Configuration();</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 128, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">//</span><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 128, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">通过名称找对应的编码/解码器</span></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1;">CompressionCodec codec =</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">(CompressionCodec)</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">ReflectionUtils.newInstance(codecClass, conf);</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">File fileOut</span> <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1;">=</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">new</span> <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1;">File(&quot;README.txt&quot;+</span><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">codec.getDefaultExtension());</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">fileOut.delete();</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 128, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">//</span><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 128, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">文件输出流</span></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1;">OutputStream out =</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">new</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">FileOutputStream(fileOut);</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 128, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">//</span><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 128, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">通过编码/解码器创建对应的输出流</span></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1;">CompressionOutputStream cout =</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">codec.createOutputStream(out);</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 128, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">//</span><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 128, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">压缩</span></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1;">IOUtils.copyBytes(in, cout, 4096,</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">false</span><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">);</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">in.close();</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">cout.close();</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">}</span></div></div></div><div style="padding: 0px; text-indent: 0px; margin: 10px auto;"><span style="font-size: 15px; color: rgb(0, 0, 0); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400; line-height: 1.5;">需要解压缩文件时，通常通过其扩展名来推断它对应的编码/解码器，进而用相应的解码流对数据进行解码，如扩展名为gz的文件可以使用GzipCodec阅读。</span></div><div style="padding: 0px; text-indent: 0px; margin: 10px auto;"><span style="font-size: 15px; color: rgb(0, 0, 0); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400; line-height: 1.5;">CompressionCodecFactory提供了getCodec()方法，用于将文件扩展名映射到对应的编码/解码器，如下面的例子。有了CompressionCodec对象，就可以使用和压缩类似的过程，通过对象的createInputStream()方法获得CompressionInputStream对象，解码数据。相关代码如下：</span></div><div style="border-width: 1px 1px 1px 5px; border-color: rgb(204, 204, 204) rgb(204, 204, 204) rgb(204, 204, 204) rgb(108, 226, 108); border-image: initial; overflow: auto; padding: 5px; border-style: dashed dashed dashed solid; background-color: rgb(255, 255, 255); margin: 10px 0px; font-size: 12px;"><div style="overflow: auto; margin: 0px; padding: 0px; overflow-wrap: break-word; font-size: 12px;"><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">public</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">static</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">void</span> <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1;">decompress(File file)</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">throws</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">IOException {</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">Configuration conf</span> <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1;">=</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">new</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">Configuration();</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">CompressionCodecFactory factory</span> <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1;">=</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">new</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">CompressionCodecFactory(conf);</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 128, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">//</span><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 128, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">通过文件扩展名获得相应的编码/解码器</span></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1;">CompressionCodec codec = factory.getCodec(</span><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">new</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">Path(file.getName()));</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">if</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1;">( codec ==</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">null</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">) {</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">System.out.println(</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1;">&quot;Cannot find codec for file &quot;+</span><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">file);</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">return</span><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">;</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">}</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">File fileOut</span> <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1;">=</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">new</span> <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1;">File(file.getName()+&quot;.txt&quot;</span><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">);</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 128, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">//</span><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 128, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">通过编码/解码器创建对应的输入流</span></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1;">InputStream in = codec.createInputStream(</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">new</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">FileInputStream(file) );</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">……</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">}</span></div></div></div><h2 style="padding: 5px 0px 5px 8px; background: none 0px 0px repeat scroll rgb(165, 198, 59); letter-spacing: 1px; margin: 10px 0px; font-size: 21px;"><span style="font-size: 21px; color: rgb(255, 255, 255); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: bold; line-height: 1.5;">Hadoop压缩框架</span></h2><div style="padding: 0px; text-indent: 0px; margin: 10px auto;"><span style="font-size: 15px; color: rgb(0, 0, 0); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400; line-height: 1.5;">Hadoop通过以编码/解码器为基础的抽象工厂方法，提供了一个可扩展的框架，支持多种压缩方法。下面就来研究Hadoop压缩框架的实现。</span></div><div style="padding: 0px; text-indent: 0px; margin: 10px auto;"><span style="font-size: 15px; margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: bold; line-height: 1.5;">1. 编码/解码器</span></div><div style="padding: 0px; text-indent: 0px; margin: 10px auto;"><span style="font-size: 15px; color: rgb(0, 0, 0); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400; line-height: 1.5;">前面已经提过，CompressionCodec接口实现了编码/解码器，使用的是抽象工厂的设计模式。CompressionCodec提供了一系列方法，用于创建特定压缩算法的相关设施，其类图如图所示：</span></div><div style="padding: 0px; text-indent: 0px; margin: 10px auto;"><span style="font-size: 15px; color: rgb(0, 0, 0); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400; line-height: 1.5;"><img src="hadoop压缩框架_files/301738231392861.jpg" type="image/jpeg" data-filename="301738231392861.jpg" height="485" style="margin:0px;padding:0px;border:0px;cursor:zoom-in;height:auto;transition:transform 0.3s cubic-bezier(0.2, 0, 0.2, 1) 0s;max-width:100%;" width="804"/></span></div><div style="padding: 0px; text-indent: 0px; margin: 10px auto;"><span style="font-size: 15px; color: rgb(0, 0, 0); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400; line-height: 1.5;">CompressionCodec中的方法很对称，一个压缩功能总对应着一个解压缩功能。其中，与压缩有关的方法包括：</span></div><div style="padding: 0px; text-indent: 0px; margin: 10px auto;"><span style="font-size: 15px; color: rgb(0, 0, 0); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400; line-height: 1.5;">createOutputStream()用于通过底层输出流创建对应压缩算法的压缩流，重载的createOutputStream()方法可使用压缩器创建压缩流；</span></div><div style="padding: 0px; text-indent: 0px; margin: 10px auto;"><span style="font-size: 15px; color: rgb(0, 0, 0); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400; line-height: 1.5;">createCompressor()方法用于创建压缩算法对应的压缩器。后续会继续介绍压缩流CompressionOutputStream和压缩器Compressor。解压缩也有对应的方法和类。</span></div><div style="padding: 0px; text-indent: 0px; margin: 10px auto;"><span style="font-size: 15px; color: rgb(0, 0, 0); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400; line-height: 1.5;">CompressionCodec中还提供了获取对应文件扩展名的方法getDefaultExtension()，如对于org.apache.hadoop.io.compress.BZip2Codec，该方法返回字符串“.bz2”，注意字符串的第一个字符。相关代码如下：</span></div><div style="border-width: 1px 1px 1px 5px; border-color: rgb(204, 204, 204) rgb(204, 204, 204) rgb(204, 204, 204) rgb(108, 226, 108); border-image: initial; overflow: auto; padding: 5px; border-style: dashed dashed dashed solid; background-color: rgb(255, 255, 255); margin: 10px 0px; font-size: 12px;"><div style="overflow: auto; margin: 0px; padding: 0px; overflow-wrap: break-word; font-size: 12px;"><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">public</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">interface</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">CompressionCodec {</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 128, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">//</span><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 128, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">在底层输出流out的基础上创建对应压缩算法的压缩流CompressionOutputStream对象</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">CompressionOutputStream createOutputStream(OutputStream out)……</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 128, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">//</span><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 128, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">使用压缩器compressor，在底层输出流out的基础上创建对应的压缩流</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">CompressionOutputStream createOutputStream(OutputStream out,</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">Compressor compressor) ……</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">……</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 128, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">//</span><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 128, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">创建压缩算法对应的压缩器</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">Compressor createCompressor();</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 128, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">//</span><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 128, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">在底层输入流in的基础上创建对应压缩算法的解压缩流CompressionInputStream对象</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">CompressionInputStream createInputStream(InputStream in) ……</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">……</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 128, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">//</span><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 128, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">获得压缩算法对应的文件扩展名</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">String getDefaultExtension();</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">}</span></div></div></div><div style="padding: 0px; text-indent: 0px; margin: 10px auto;"><span style="font-size: 15px;"><span style="font-size: 15px; color: rgb(255, 0, 0); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400; line-height: 1.5;">CompressionCodecFactory</span></span><span style="font-size: 15px; color: rgb(0, 0, 0); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400; line-height: 1.5;">是Hadoop压缩框架中的另一个类，它应用了</span><span style="font-size: 15px;"><span style="font-size: 15px; color: rgb(255, 0, 0); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400; line-height: 1.5;">工厂方法</span></span><span style="font-size: 15px; color: rgb(0, 0, 0); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400; line-height: 1.5;">，使用者可以通过它提供的方法获得CompressionCodec的</span><span style="font-size: 15px; color: rgb(0, 0, 0); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; line-height: 1.5;">不同实现类的对象</span><span style="font-size: 15px; color: rgb(0, 0, 0); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400; line-height: 1.5;">(如</span><span style="font-size: 15px; color: rgb(0, 0, 0); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; line-height: 1.5;">CompressionCodec的实现类SnappyCodec的对象</span><span style="font-size: 15px; color: rgb(0, 0, 0); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400; line-height: 1.5;">)。而</span><span style="font-size: 15px;"><span style="font-size: 15px; color: rgb(255, 0, 0); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; line-height: 1.5;">CompressionCodec</span></span><span style="font-size: 15px; color: rgb(0, 0, 0); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; line-height: 1.5;">应用的是</span><span style="font-size: 15px;"><span style="font-size: 15px; color: rgb(255, 0, 0); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; line-height: 1.5;">抽象工厂方法</span><span style="font-size: 15px; font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; line-height: 1.5;">。,使用它可以不仅可以获得Compressor</span></span><span style="font-size: 15px; color: rgb(0, 0, 0); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; line-height: 1.5;">的</span><span style="font-size: 15px; color: rgb(0, 0, 0); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; line-height: 1.5;">不同</span><span style="font-size: 15px; color: rgb(0, 0, 0); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; line-height: 1.5;">实现类</span><span style="font-size: 15px; color: rgb(0, 0, 0); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; line-height: 1.5;">的对象</span><span style="font-size: 15px; color: rgb(0, 0, 0); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; line-height: 1.5;">(如Compressor</span><span style="font-size: 15px; color: rgb(0, 0, 0); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; line-height: 1.5;">的实现类</span><span style="font-size: 15px; color: rgb(0, 0, 0); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; line-height: 1.5;">SnappyCompressor</span><span style="font-size: 15px; color: rgb(0, 0, 0); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; line-height: 1.5;">的对象</span><span style="font-size: 15px; color: rgb(0, 0, 0); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; line-height: 1.5;">),也可以获得Decompressor的不同</span><span style="font-size: 15px; color: rgb(0, 0, 0); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; line-height: 1.5;">实现类</span><span style="font-size: 15px; color: rgb(0, 0, 0); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; line-height: 1.5;">的对象, 以及可以获得CompressionOutputStream或CompressionInputStream的不同实现类的对象。这也是工厂方法和抽象工厂方法的区别</span></div><div style="padding: 0px; text-indent: 0px; margin: 10px auto;"><span style="font-size: 15px; color: rgb(0, 0, 0); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400; line-height: 1.5;">注意：</span><span style="margin: 0px; padding: 0px; font-size: 15px; color: rgb(0, 0, 255); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400; line-height: 1.5;">抽象工厂方法和工厂方法这两个设计模式有很大的区别，抽象工厂方法用于创建</span><span style="margin: 0px; padding: 0px; font-size: 15px;"><span style="font-size: 15px; color: rgb(255, 0, 0); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400; line-height: 1.5;">多种</span></span><span style="margin: 0px; padding: 0px; font-size: 15px; color: rgb(0, 0, 255); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400; line-height: 1.5;">品类的多种产品的对象，如CompressionCodec可以获得和某一个压缩方法相关的压缩器对象, 还可以获得解压缩器对象(，这就是两种不同的品类, 同时</span><span style="font-size: 15px; color: rgb(0, 0, 255); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; line-height: 1.5;">CompressionCodec</span><span style="margin: 0px; padding: 0px; font-size: 15px; color: rgb(0, 0, 255); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400; line-height: 1.5;">还可以获得压缩流和解压缩流的对象,这又是另外两种品类。而工厂方法（严格来说，CompressionCodecFactory是参数化工厂方法），用于创建</span><span style="margin: 0px; padding: 0px; font-size: 15px;"><span style="font-size: 15px; color: rgb(255, 0, 0); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400; line-height: 1.5;">一种</span></span><span style="margin: 0px; padding: 0px; font-size: 15px; color: rgb(0, 0, 255); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400; line-height: 1.5;">品类的多种产品的对象，如通过CompressionCodecFactory的getCodec()方法，可以创建GzipCodec对象或BZip2Codec对象。</span></div><div style="padding: 0px; text-indent: 0px; margin: 10px auto;"><span style="font-size: 15px; color: rgb(0, 0, 0); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400; line-height: 1.5;">在前面的实例中已经使用过getCodec()方法，为某一个压缩文件寻找对应的CompressionCodec。为了分析该方法，需要了解CompressionCodec类中保存文件扩展名和CompressionCodec映射关系的成员变量codecs。</span></div><div style="padding: 0px; text-indent: 0px; margin: 10px auto;"><span style="font-size: 15px; color: rgb(0, 0, 0); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400; line-height: 1.5;">codecs是一个有序映射表，即它本身是一个Map，同时它对Map的键排序，下面是codecs中保存的一个可能的映射关系：</span></div><div style="border-width: 1px 1px 1px 5px; border-color: rgb(204, 204, 204) rgb(204, 204, 204) rgb(204, 204, 204) rgb(108, 226, 108); border-image: initial; overflow: auto; padding: 5px; border-style: dashed dashed dashed solid; background-color: rgb(255, 255, 255); margin: 10px 0px; font-size: 12px;"><div style="overflow: auto; margin: 0px; padding: 0px; overflow-wrap: break-word; font-size: 12px;"><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">{</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">2zb.: org.apache.hadoop.io.compress.BZip2Codec,</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">etalfed.: org.apache.hadoop.io.compress.DeflateCodec,</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">yppans.: org.apache.hadoop.io.compress.SnappyCodec,</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">zg.: org.apache.hadoop.io.compress.GzipCodec</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">}</span></div></div></div><div style="padding: 0px; text-indent: 0px; margin: 10px auto;"><span style="font-size: 15px; color: rgb(0, 0, 0); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400; line-height: 1.5;">可以看到，Map中的键是排序的。</span></div><div style="padding: 0px; text-indent: 0px; margin: 10px auto;"><span style="font-size: 15px; color: rgb(0, 0, 0); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400; line-height: 1.5;">getCodec()方法的输入是Path对象，保存着文件路径，如实例中的“README.txt.bz2”。</span></div><div style="padding: 0px; text-indent: 0px; margin: 10px auto;"><span style="font-size: 15px; color: rgb(0, 0, 0); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400; line-height: 1.5;">首先通过获取Path对象对应的文件名并逆转该字符串得到“2zb.txt.EMDAER”，然后通过有序映射SortedMap的headMap()方法，查找最接近上述逆转字符串的有序映射的部分视图，如输入“2zb.txt.EMDAER”的查找结果subMap，只包含“2zb.”对应的那个键–值对，如果输入是“zg.txt.EMDAER”，则subMap会包含成员变量codecs中保存的所有键–值对。然后，简单地获取subMap最后一个元素的键，如果该键是逆转文件名的前缀，那么就找到了文件对应的编码/解码器，否则返回空。实现代码如下：</span></div><div style="border-width: 1px 1px 1px 5px; border-color: rgb(204, 204, 204) rgb(204, 204, 204) rgb(204, 204, 204) rgb(108, 226, 108); border-image: initial; overflow: auto; padding: 5px; border-style: dashed dashed dashed solid; background-color: rgb(255, 255, 255); margin: 10px 0px; font-size: 12px;"><div style="overflow: auto; margin: 0px; padding: 0px; overflow-wrap: break-word; font-size: 12px;"><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">public</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">class</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">CompressionCodecFactory {</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">……</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 128, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">//</span><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 128, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">该有序映射保存了逆转文件后缀（包括后缀前的“.”）到CompressionCodec的映射</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 128, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">//</span><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 128, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">通过逆转文件后缀，我们可以找到最长匹配后缀</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">private</span> <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1;">SortedMap&lt;String, CompressionCodec&gt; codecs =</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">null</span><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">;</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">……</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">public</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">CompressionCodec getCodec(Path file) {</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">CompressionCodec result</span> <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1;">=</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">null</span><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">;</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">if</span> <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1;">(codecs !=</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">null</span><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">) {</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">String filefilename</span> <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1;">=</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">file.getName();</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 128, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">//</span><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 128, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">逆转字符串</span></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1;">String reversedFilename =</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">new</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">StringBuffer(filename).reverse().toString();</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">SortedMap</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1;">&lt;String, CompressionCodec&gt; subMap =</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">codecs.headMap(reversedFilename);</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">if</span> <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1;">(!</span><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">subMap.isEmpty()) {</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">String potentialSuffix</span> <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1;">=</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">subMap.lastKey();</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">if</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">(reversedFilename.startsWith(potentialSuffix)) {</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">result</span> <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1;">=</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">codecs.get(potentialSuffix);</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">}</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">}</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">}</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">return</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">result;</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">}</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">}</span></div></div></div><div style="padding: 0px; text-indent: 0px; margin: 10px auto;"><span style="font-size: 15px; color: rgb(0, 0, 0); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400; line-height: 1.5;">CompressionCodecFactory.getCodec()方法的代码看似复杂，但通过灵活使用有序映射SortedMap，实现其实还是非常简单的。</span></div><div style="padding: 0px; text-indent: 0px; margin: 10px auto;"><span style="font-size: 15px; margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: bold; line-height: 1.5;">2. 压缩器和解压器</span></div><div style="padding: 0px; text-indent: 0px; margin: 10px auto;"><span style="font-size: 15px; color: rgb(0, 0, 0); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400; line-height: 1.5;">压缩器（Compressor）和解压器（Decompressor）是Hadoop压缩框架中的一对重要概念。</span></div><div style="padding: 0px; text-indent: 0px; margin: 10px auto;"><span style="font-size: 15px; color: rgb(0, 0, 0); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400; line-height: 1.5;">Compressor可以插入压缩输出流的实现中，提供具体的压缩功能；相反，Decompressor提供具体的解压功能并插入CompressionInputStream中。Compressor和Decompressor的这种设计，最初是在Java的zlib压缩程序库中引入的，对应的实现分别是java.util.zip.Deflater和java.util.zip.Inflater。下面以Compressor为例介绍这对组件。</span></div><div style="padding: 0px; text-indent: 0px; margin: 10px auto;"><span style="font-size: 15px; color: rgb(0, 0, 0); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400; line-height: 1.5;">Compressor的用法相对复杂，Compressor通过setInput()方法接收数据到内部缓冲区，自然可以多次调用setInput()方法，但内部缓冲区总是会被写满。如何判断压缩器内部缓冲区是否已满呢？可以通过needsInput()的返回值，如果是false，表明缓冲区已经满，这时必须通过compress()方法获取压缩后的数据，释放缓冲区空间。</span></div><div style="padding: 0px; text-indent: 0px; margin: 10px auto;"><span style="font-size: 15px; color: rgb(0, 0, 0); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400; line-height: 1.5;">为了提高压缩效率，并不是每次用户调用setInput()方法，压缩器就会立即工作，所以，为了通知压缩器所有数据已经写入，必须使用finish()方法。finish()调用结束后，压缩器缓冲区中保持的已经压缩的数据，可以继续通过compress()方法获得。至于要判断压缩器中是否还有未读取的压缩数据，则需要利用finished()方法来判断。</span></div><div style="padding: 0px; text-indent: 0px; margin: 10px auto;"><span style="font-size: 15px; color: rgb(0, 0, 0); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400; line-height: 1.5;">注意：finished()和finish()的作用不同，finish()结束数据输入的过程，而finished()返回false，表明压缩器中还有未读取的压缩数据，可以继续通过compress()方法读取。</span></div><div style="padding: 0px; text-indent: 0px; margin: 10px auto;"><span style="font-size: 15px; color: rgb(0, 0, 0); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400; line-height: 1.5;">Compressor接口源代码如下：</span></div><div style="border-width: 1px 1px 1px 5px; border-color: rgb(204, 204, 204) rgb(204, 204, 204) rgb(204, 204, 204) rgb(108, 226, 108); border-image: initial; overflow: auto; padding: 5px; border-style: dashed dashed dashed solid; background-color: rgb(255, 255, 255); margin: 10px 0px; font-size: 12px;"><div style="overflow: auto; margin: 0px; padding: 0px; overflow-wrap: break-word; font-size: 12px;"><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">public</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">interface</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">Compressor {</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 128, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">/**</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 128, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">* 输入要压缩的数据.</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 128, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">* 根据#needsInput() 返回的值，判断是否执行</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 128, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">* 如果返回为true，表示需要更多的数据.</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 128, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">*</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 128, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">*</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(128, 128, 128); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">@param</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 128, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">b 输入数据</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 128, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">*</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(128, 128, 128); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">@param</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 128, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">off 偏移的起始位置</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 128, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">*</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(128, 128, 128); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">@param</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 128, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">len 长度</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 128, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">*/</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">public</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">void</span> <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1;">setInput(</span><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">byte</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1;">[] b,</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">int</span> <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1;">off,</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">int</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">len);</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 128, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">/**</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 128, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">* 当输入数据缓存为空的时候返回 true，并且</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 128, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">* #setInput() 应该被调用用来提供输入数据.</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 128, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">*/</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">public</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">boolean</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">needsInput();</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 128, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">/**</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 128, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">* 设置当前路径为压缩.</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 128, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">*</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 128, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">*</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(128, 128, 128); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">@param</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 128, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">b Dictionary data bytes</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 128, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">*</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(128, 128, 128); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">@param</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 128, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">off Start offset</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 128, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">*</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(128, 128, 128); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">@param</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 128, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">len Length</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 128, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">*/</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">public</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">void</span> <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1;">setDictionary(</span><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">byte</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1;">[] b,</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">int</span> <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1;">off,</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">int</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">len);</span></div><div><br/></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 128, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">/**</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 128, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">* 返回输入的还未被压缩的字节数.</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 128, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">*/</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">public</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">long</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">getBytesRead();</span></div><div><br/></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 128, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">/**</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 128, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">* 返回输出的已经被压缩的字节数.</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 128, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">*/</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">public</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">long</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">getBytesWritten();</span></div><div><br/></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 128, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">/**</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 128, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">* 当调用的时候，表示当前输入缓存的内容的压缩操作应该结束</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 128, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">*/</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">public</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">void</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">finish();</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 128, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">/**</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 128, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">* 当压缩器中的最末端的输出数据到达则返回true.</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 128, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">*/</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">public</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">boolean</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">finished();</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 128, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">/**</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 128, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">* 向缓存中填充压缩的数据. 返回实际的压缩的字节数. 返回0表明 needsInput()被调用</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 128, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">* 来判断是否需要更多的输入数据.</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 128, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">*</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 128, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">*</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(128, 128, 128); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">@param</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 128, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">b Buffer for the compressed data</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 128, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">*</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(128, 128, 128); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">@param</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 128, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">off Start offset of the data</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 128, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">*</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(128, 128, 128); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">@param</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 128, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">len Size of the buffer</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 128, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">*</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(128, 128, 128); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">@return</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 128, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">The actual number of bytes of compressed data.</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 128, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">*/</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">public</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">int</span> <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1;">compress(</span><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">byte</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1;">[] b,</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">int</span> <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1;">off,</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">int</span> <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1;">len)</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">throws</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">IOException;</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 128, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">/**</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 128, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">* 重置 compressor， 预备一些新的输入数据.</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 128, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">*/</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">public</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">void</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">reset();</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 128, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">/**</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 128, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">* 关闭 compressor并丢弃为处理的输入.</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 128, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">*/</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">public</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">void</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">end();</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">}</span></div></div></div><div style="padding: 0px; text-indent: 0px; margin: 10px auto;"><span style="font-size: 15px; color: rgb(0, 0, 0); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400; line-height: 1.5;">使用Compressor的一个典型实例如下：</span></div><div style="border-width: 1px 1px 1px 5px; border-color: rgb(204, 204, 204) rgb(204, 204, 204) rgb(204, 204, 204) rgb(108, 226, 108); border-image: initial; overflow: auto; padding: 5px; border-style: dashed dashed dashed solid; background-color: rgb(255, 255, 255); margin: 10px 0px; font-size: 12px;"><div style="overflow: auto; margin: 0px; padding: 0px; overflow-wrap: break-word; font-size: 12px;"><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">public</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">static</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">void</span> <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1;">compressor()</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">throws</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">ClassNotFoundException, IOException</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">{</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 128, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">//</span><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 128, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">读入被压缩的内容</span></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1;">File fileIn =</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">new</span> <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1;">File(&quot;README.txt&quot;</span><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">);</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">InputStream in</span> <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1;">=</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">new</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">FileInputStream(fileIn);</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">int</span> <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1;">datalength=</span><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">in.available();</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">byte</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1;">[] inbuf =</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">new</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">byte</span><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">[datalength];</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">in.read(inbuf,</span> <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1;">0</span><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">, datalength);</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">in.close();</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 128, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">//</span><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 128, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">长度受限制的输出缓冲区，用于说明finished()方法</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">byte</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1;">[] outbuf =</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">new</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">byte</span><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">[compressorOutputBufferSize];</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">Compressor compressor</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1;">=</span><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">new</span> <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1;">BuiltInZlibDeflater();</span><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 128, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">//</span><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 128, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">构造压缩器</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">int</span> <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1;">step=100;</span><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 128, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">//</span><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 128, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">一些计数器</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">int</span> <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1;">inputPos=0</span><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">;</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">int</span> <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1;">putcount=0</span><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">;</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">int</span> <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1;">getcount=0</span><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">;</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">int</span> <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1;">compressedlen=0</span><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">;</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">while</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1;">(inputPos &lt;</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">datalength) {</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 128, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">//</span><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 128, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">进行多次setInput()</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">int</span> <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1;">len=(datalength-inputPos&gt;=step)? step:datalength-</span><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">inputPos;</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">compressor.setInput(inbuf, inputPos, len );</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">putcount</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1;">++</span><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">;</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">while</span> <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1;">(!</span><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">compressor.needsInput()) {</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">compressedlen</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1;">=compressor.compress(outbuf, 0</span><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">, ……);</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">if</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1;">(compressedlen&gt;0</span><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">) {</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">getcount</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1;">++;</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 128, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">//</span><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 128, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">能读到数据</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">}</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">}</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 128, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">//</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 128, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">end of while (!compressor.needsInput())</span></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1;">inputPos+=</span><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">step;</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">}</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">compressor.finish();</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">while</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1;">(!compressor.finished()) {</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 128, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">//</span><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 128, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">压缩器中有数据</span></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1;">getcount++</span><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">;</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">compressor.compress(outbuf,</span> <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1;">0</span><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">, compressorOutputBufferSize);</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">}</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">System.out.println(</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1;">&quot;Compress &quot;+compressor.getBytesRead()</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 128, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">//</span><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 128, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">输出信息</span></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1;">+&quot; bytes into &quot;+</span><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">compressor.getBytesWritten());</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">System.out.println(</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1;">&quot;put &quot;+putcount+&quot; times and get &quot;+getcount+&quot; times&quot;</span><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">);</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">compressor.end();</span><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 128, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">//</span><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 128, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">停止</span></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1;">}</span></div></div></div><div style="padding: 0px; text-indent: 0px; margin: 10px auto;"><span style="font-size: 15px; color: rgb(0, 0, 0); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400; line-height: 1.5;">以上代码实现了setInput()、needsInput()、finish()、compress()和finished()的配合过程。将输入inbuf分成几个部分，通过setInput()方法送入压缩器，而在finish()调用结束后，通过finished()循序判断压缩器是否还有未读取的数据，并使用compress()方法获取数据。</span></div><div style="padding: 0px; text-indent: 0px; margin: 10px auto;"><span style="font-size: 15px; color: rgb(0, 0, 0); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400; line-height: 1.5;">在压缩的过程中，Compressor可以通过getBytesRead()和getBytesWritten()方法获得Compressor输入未压缩字节的总数和输出压缩字节的总数，如实例中最后一行的输出语句。Compressor和Decompressor的类图如图所示。</span></div><div style="padding: 0px; text-indent: 0px; margin: 10px auto;"><span style="font-size: 15px; color: rgb(0, 0, 0); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400; line-height: 1.5;"><img src="hadoop压缩框架_files/301944305923310.jpg" type="image/jpeg" data-filename="301944305923310.jpg" height="235" style="margin:0px;padding:0px;border:0px;cursor:zoom-in;height:auto;transition:transform 0.3s cubic-bezier(0.2, 0, 0.2, 1) 0s;max-width:100%;" width="801"/></span></div><div style="padding: 0px; text-indent: 0px; margin: 10px auto;"><span style="font-size: 15px; color: rgb(0, 0, 0); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400; line-height: 1.5;">Compressor.end()方法用于关闭解压缩器并放弃所有未处理的输入；reset()方法用于重置压缩器，以处理新的输入数据集合；reinit()方法更进一步允许使用Hadoop的配置系统，重置并重新配置压缩器。</span></div><div style="padding: 0px; text-indent: 0px; margin: 10px auto;"><span style="font-size: 15px; margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: bold; line-height: 1.5;">3. 压缩流和解压缩流</span></div><div style="padding: 0px; text-indent: 0px; margin: 10px auto;"><span style="font-size: 15px; color: rgb(0, 0, 0); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400; line-height: 1.5;">Java最初版本的输入/输出系统是基于流的，流抽象了任何有能力产出数据的数据源，或者是有能力接收数据的接收端。一般来说，通过设计模式装饰，可以为流添加一些额外的功能，如前面提及的序列化流ObjectInputStream和ObjectOutputStream。</span></div><div style="padding: 0px; text-indent: 0px; margin: 10px auto;"><span style="font-size: 15px; color: rgb(0, 0, 0); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400; line-height: 1.5;">压缩流（CompressionOutputStream）和解压缩流（CompressionInputStream）是Hadoop压缩框架中的另一对重要概念，它提供了基于流的压缩解压缩能力。如图3-7所示是从java.io.InputStream和java.io.OutputStream开始的类图。</span></div><div style="padding: 0px; text-indent: 0px; margin: 10px auto;"><span style="font-size: 15px; color: rgb(0, 0, 0); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400; line-height: 1.5;">这里只分析和压缩相关的代码，即CompressionOutputStream及其子类。</span></div><div style="padding: 0px; text-indent: 0px; margin: 10px auto;"><span style="font-size: 15px; color: rgb(0, 0, 0); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400; line-height: 1.5;">OutputStream是一个抽象类，提供了进行流输出的基本方法，它包含三个write成员函数，分别用于往流中写入一个字节、一个字节数组或一个字节数组的一部分（需要提供起始偏移量和长度）。</span></div><div style="padding: 0px; text-indent: 0px; margin: 10px auto;"><span style="font-size: 15px; color: rgb(0, 0, 0); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400; line-height: 1.5;">注意：流实现中一般需要支持的close()和flush()方法，是java.io包中的相应接口的成员函数，不是OutputStream的成员函数。</span></div><div style="padding: 0px; text-indent: 0px; margin: 10px auto;"><span style="font-size: 15px; color: rgb(0, 0, 0); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400; line-height: 1.5;">CompressionOutputStream继承自OutputStream，也是个抽象类。如前面提到的ObjectOutputStream、CompressionOutputStream为其他流添加了附加额外的压缩功能，其他流保存在类的成员变量out中，并在构造的时候被赋值。</span></div><div style="padding: 0px; text-indent: 0px; margin: 10px auto;"><span style="font-size: 15px; color: rgb(0, 0, 0); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400; line-height: 1.5;"><img src="hadoop压缩框架_files/301946572644801.jpg" type="image/jpeg" data-filename="301946572644801.jpg" height="545" style="margin:0px;padding:0px;border:0px;cursor:zoom-in;height:auto;transition:transform 0.3s cubic-bezier(0.2, 0, 0.2, 1) 0s;max-width:100%;" width="812"/></span></div><div style="padding: 0px; text-indent: 0px; margin: 10px auto;"><span style="font-size: 15px; color: rgb(0, 0, 0); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400; line-height: 1.5;">CompressionOutputStream实现了OutputStream的close()方法和flush()方法，但用于输出数据的write()方法、用于结束压缩过程并将输入写到底层流的finish()方法和重置压缩状态的resetState()方法还是抽象方法，需要CompressionOutputStream的子类实现。相关代码如下：</span></div><div style="border-width: 1px 1px 1px 5px; border-color: rgb(204, 204, 204) rgb(204, 204, 204) rgb(204, 204, 204) rgb(108, 226, 108); border-image: initial; overflow: auto; padding: 5px; border-style: dashed dashed dashed solid; background-color: rgb(255, 255, 255); margin: 10px 0px; font-size: 12px;"><div style="overflow: auto; margin: 0px; padding: 0px; overflow-wrap: break-word; font-size: 12px;"><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">public</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">abstract</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">class</span> <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1;">CompressionOutputStream</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">extends</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">OutputStream {</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 128, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">//</span><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 128, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">输出压缩结果的流</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">protected</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">final</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">OutputStream out;</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 128, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">//</span><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 128, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">构造函数</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">protected</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">CompressionOutputStream(OutputStream out) {</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">this</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1;">.out =</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">out;</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">}</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">public</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">void</span> <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1;">close()</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">throws</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">IOException {</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">finish();</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">out.close();</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">}</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">public</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">void</span> <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1;">flush()</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">throws</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">IOException {</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">out.flush();</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">}</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">public</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">abstract</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">void</span> <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1;">write(</span><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">byte</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1;">[] b,</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">int</span> <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1;">off,</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">int</span> <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1;">len)</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">throws</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">IOException;</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">public</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">abstract</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">void</span> <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1;">finish()</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">throws</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">IOException;</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">public</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">abstract</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">void</span> <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1;">resetState()</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">throws</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">IOException;</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">}</span></div></div></div><div style="padding: 0px; text-indent: 0px; margin: 10px auto;"><span style="font-size: 15px; color: rgb(0, 0, 0); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400; line-height: 1.5;">CompressionOutputStream规定了压缩流的对外接口，如果已经有了一个压缩器的实现，能否提供一个通用的、使用压缩器的压缩流实现呢？答案是肯定的，CompressorStream使用压缩器实现了一个通用的压缩流，其主要代码如下：</span></div><div style="border-width: 1px 1px 1px 5px; border-color: rgb(204, 204, 204) rgb(204, 204, 204) rgb(204, 204, 204) rgb(108, 226, 108); border-image: initial; overflow: auto; padding: 5px; border-style: dashed dashed dashed solid; background-color: rgb(255, 255, 255); margin: 10px 0px; font-size: 12px;"><div style="overflow: auto; margin: 0px; padding: 0px; overflow-wrap: break-word; font-size: 12px;"><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">public</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">class</span> <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1;">CompressorStream</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">extends</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">CompressionOutputStream {</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">protected</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">Compressor compressor;</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">protected</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">byte</span><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">[] buffer;</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">protected</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">boolean</span> <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1;">closed =</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">false</span><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">;</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 128, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">//</span><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 128, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">构造函数</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">public</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">CompressorStream(OutputStream out,</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">Compressor compressor,</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">int</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">bufferSize) {</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">super</span><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">(out);</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">……</span><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 128, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">//</span><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 128, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">参数检查，略</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">this</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1;">.compressor =</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">compressor;</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">buffer</span> <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1;">=</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">new</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">byte</span><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">[bufferSize];</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">}</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">……</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">public</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">void</span> <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1;">write(</span><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">byte</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1;">[] b,</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">int</span> <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1;">off,</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">int</span> <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1;">len)</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">throws</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">IOException {</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 128, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">//</span><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 128, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">参数检查，略</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">……</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">compressor.setInput(b, off, len);</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">while</span> <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1;">(!</span><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">compressor.needsInput()) {</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">compress();</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">}</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">}</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">protected</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">void</span> <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1;">compress()</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">throws</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">IOException {</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">int</span> <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1;">len = compressor.compress(buffer, 0</span><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">, buffer.length);</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">if</span> <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1;">(len &gt; 0</span><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">) {</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">out.write(buffer,</span> <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1;">0</span><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">, len);</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">}</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">}</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 128, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">//</span><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 128, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">结束输入</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">public</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">void</span> <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1;">finish()</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">throws</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">IOException {</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">if</span> <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1;">(!</span><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">compressor.finished()) {</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">compressor.finish();</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">while</span> <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1;">(!</span><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">compressor.finished()) {</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">compress();</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">}</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">}</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">}</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">……</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 128, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">//</span><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 128, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">关闭流</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">public</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">void</span> <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1;">close()</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">throws</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">IOException {</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">if</span> <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1;">(!</span><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">closed) {</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">finish();</span><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 128, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">//</span><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 128, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">结束压缩</span></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1;">out.close();</span><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 128, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">//</span><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 128, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">关闭底层流</span></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1;">closed =</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">true</span><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">;</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">}</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">}</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">……</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">}</span></div></div></div><div style="padding: 0px; text-indent: 0px; margin: 10px auto;"><span style="font-size: 15px; color: rgb(0, 0, 0); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400; line-height: 1.5;">CompressorStream提供了几个不同的构造函数，用于初始化相关的成员变量。上述代码片段中保留了参数最多的构造函数，其中，CompressorStream需要的底层输出流out和压缩时使用的压缩器，都作为参数传入构造函数。另一个参数是CompressorStream工作时使用的缓冲区buffer的大小，构造时会利用这个参数分配该缓冲区。</span></div><div style="padding: 0px; text-indent: 0px; margin: 10px auto;"><span style="font-size: 15px; color: rgb(0, 0, 0); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400; line-height: 1.5;">CompressorStream.write()方法用于将待压缩的数据写入压缩器中。待压缩的数据在进行一番检查后，最终调用压缩器的setInput()方法进入压缩器。setInput()方法调用结束后，通过Compressor.needsInput()判断是否需要调用compress()方法，获取压缩后的输出数据。上一节已经讨论了这个问题，如果内部缓冲区已满，则需要通过compress()方法提取数据，提取后的数据直接通过底层流的write()方法输出。</span></div><div style="padding: 0px; text-indent: 0px; margin: 10px auto;"><span style="font-size: 15px; color: rgb(0, 0, 0); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400; line-height: 1.5;">当finish()被调用（往往是CompressorStream被关闭），这时CompressorStream流调用压缩器的finish()方法通知输入已经结束，然后进入另一个循环，该循环不断读取压缩器中未读取的数据，然后输出到底层流out中。</span></div><div style="padding: 0px; text-indent: 0px; margin: 10px auto;"><span style="font-size: 15px; color: rgb(0, 0, 0); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400; line-height: 1.5;">CompressorStream中的其他方法，如resetState()和close()都比较简单，不再一一介绍了。</span></div><div style="padding: 0px; text-indent: 0px; margin: 10px auto;"><span style="font-size: 15px; color: rgb(0, 0, 0); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400; line-height: 1.5;">CompressorStream利用压缩器Compressor实现了一个通用的压缩流，在Hadoop中引入一个新的压缩算法，如果没有特殊的考虑，一般只需要实现相关的压缩器和解压器，然后通过CompressorStream和DecompressorStream，就实现相关压缩算法的输入/输出流了。</span></div><div style="padding: 0px; text-indent: 0px; margin: 10px auto;"><span style="font-size: 15px; color: rgb(0, 0, 0); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400; line-height: 1.5;">CompressorStream的实现并不复杂，只需要注意压缩器几个方法间的配合，下图给出了这些方法的一个典型调用顺序：</span></div><div style="padding: 0px; text-indent: 0px; margin: 10px auto;"><span style="font-size: 15px; color: rgb(0, 0, 0); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400; line-height: 1.5;"><img src="hadoop压缩框架_files/301954586855157.jpg" type="image/jpeg" data-filename="301954586855157.jpg" height="372" style="margin:0px;padding:0px;border:0px;height:auto;max-width:100%;" width="540"/></span></div><div style="padding: 0px; text-indent: 0px; margin: 10px auto;"><span style="font-size: 15px; margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: bold; line-height: 1.5;">4. Java本地方法</span></div><div style="padding: 0px; text-indent: 0px; margin: 10px auto;"><span style="margin: 0px; padding: 0px; background-color: rgb(0, 255, 0); font-size: 15px; color: rgb(0, 0, 0); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400; line-height: 1.5;">数据压缩往往是计算密集型的操作，考虑到性能，建议使用本地库（Native Library）来压缩和解压。</span><span style="font-size: 15px; color: rgb(0, 0, 0); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400; line-height: 1.5;">在某个测试中，与Java实现的内置gzip压缩相比，使用本地gzip压缩库可以将解压时间减少50%，而压缩时间大概减少10%。</span></div><div style="padding: 0px; text-indent: 0px; margin: 10px auto;"><span style="font-size: 15px; color: rgb(0, 0, 0); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400; line-height: 1.5;">Hadoop的DEFLATE、gzip和Snappy都支持算法的本地实现，其中Apache发行版中还包含了DEFLATE和gzip的32位和64位Linux本地压缩库（Cloudera发行版还包括Snappy压缩方法）。默认情况下，Hadoop会在它运行的平台上查找本地库。</span></div><div style="padding: 0px; text-indent: 0px; margin: 10px auto;"><span style="font-size: 15px; color: rgb(0, 0, 0); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400; line-height: 1.5;">假设有一个C 函数，它实现了某些功能，同时因为某种原因（如效率），使得用户不希望用Java语言重新实现该功能，那么Java本地方法（Native Method）就是一个不错的选择。Java提供了一些钩子函数，使得调用本地方法成为可能，同时，JDK也提供了一些工具，协助用户减轻编程负担。</span></div><div style="padding: 0px; text-indent: 0px; margin: 10px auto;"><span style="margin: 0px; padding: 0px; background-color: rgb(0, 255, 0); font-size: 15px; color: rgb(0, 0, 0); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400; line-height: 1.5;">Java语言中的关键字native用于表示某个方法为本地方法，显然，本地方法是类的成员方法。</span><span style="font-size: 15px; color: rgb(0, 0, 0); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400; line-height: 1.5;">下面是一个本地方法的例子，代码片段来自Cloudera的Snappy压缩实现，在org.apache.hadoop.io.compress.snappy包中。其中，静态方法initIDs()和方法compressBytesDirect()用关键字native修饰，表明这是一个Java本地方法。相关代码如下：</span></div><div style="border-width: 1px 1px 1px 5px; border-color: rgb(204, 204, 204) rgb(204, 204, 204) rgb(204, 204, 204) rgb(108, 226, 108); border-image: initial; overflow: auto; padding: 5px; border-style: dashed dashed dashed solid; background-color: rgb(255, 255, 255); margin: 10px 0px; font-size: 12px;"><div style="overflow: auto; margin: 0px; padding: 0px; overflow-wrap: break-word; font-size: 12px;"><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">public</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">class</span> <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1;">SnappyCompressor</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">implements</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">Compressor {</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">……</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">private</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">native</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">static</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">void</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">initIDs();</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">private</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">native</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">int</span> <span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">compressBytesDirect();</span></div><div><span style="margin: 0px; padding: 0px; font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-weight: 400; line-height: 1.5;">}</span></div></div></div><div style="padding: 0px; text-indent: 0px; margin: 10px auto;"><span style="font-size: 15px; color: rgb(0, 0, 0); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400; line-height: 1.5;"> </span></div></div><div style="margin: 0px; border: 1px solid rgb(229, 229, 229); background: url(&quot;https://www.cnblogs.com/images/cnblogs_com/Terrylee/147338/o_info.png&quot;) 1% 50% no-repeat scroll rgb(255, 254, 254); padding: 10px 10px 10px 60px;"><div style="margin:0px;padding:0px;"><div style="margin:0px;padding:0px;"><span style="font-size: 105%; color: rgb(0, 0, 0); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400; line-height: 1.5em;">作者：</span><a href="http://www.cnblogs.com/wuyudong/" style="margin: 0px; padding: 0px; border-bottom: 1px dashed rgb(81, 115, 224); font-size: 105%; color: rgb(81, 115, 224); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400; line-height: 1.5em; text-decoration: none;" target="_blank">wuyudong</a></div><div style="margin:0px;padding:0px;"><span style="font-size: 105%; color: rgb(0, 0, 0); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400; line-height: 1.5em;">出处：</span><a href="http://www.cnblogs.com/wuyudong/" style="margin: 0px; padding: 0px; border-bottom: 1px dashed rgb(81, 115, 224); font-size: 105%; color: rgb(81, 115, 224); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400; line-height: 1.5em; text-decoration: none;" target="_blank">http://www.cnblogs.com/wuyudong/</a></div><div style="margin:0px;padding:0px;"><span style="font-size: 105%; color: rgb(0, 0, 0); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400; line-height: 1.5em;">本文版权归作者和博客园共有，欢迎转载，但未经作者同意必须保留此段声明，且在文章页面明显位置给出原文连接，否则保留追究法律责任的权利.</span></div></div><div style="margin:0px;padding:0px;"><span style="font-size: 105%; color: rgb(0, 0, 0); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400; line-height: 1.5em;">如果觉得本文对您有帮助，可以对作者进行小额</span><a href="http://www.cnblogs.com/wuyudong/articles/donate.html" style="margin: 0px; padding: 0px; border-bottom: 1px dashed rgb(81, 115, 224); font-size: 105%; color: rgb(81, 115, 224); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400; line-height: 1.5em; text-decoration: none;" target="_blank">【赞助】</a></div></div><div style="margin:0px;padding:0px;clear:both;"></div><div style="margin:0px;padding:0px;margin-top:20px;"><div style="margin: 0px; padding: 0px;"><span style="font-size: 105%; color: rgb(102, 102, 102); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400; line-height: 1.5em;">标签:</span> <a href="https://www.cnblogs.com/wuyudong/tag/hadoop/" style="margin: 0px 0px 0px 5px; padding: 0px; border-bottom: 1px dashed rgb(81, 115, 224); font-size: 105%; color: rgb(102, 102, 102); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400; line-height: 1.5em; text-decoration: none;">hadoop</a></div><div style="margin:0px;padding:0px;"><div style="margin:0px;margin-bottom:10px;margin-top:10px;border:1px dashed rgb(192, 192, 192);font-size:12px;text-align:center;padding:10px 0px;width:320px;"><a href="http://loadhtml/#" style="margin: 0px 10px 0px 0px; background: url(&quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAAkCAYAAABIdFAMAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAHhJREFUeNo8zjsOxCAMBFB/KEAUFFR0Cbng3nQPw68ArZdAlOZppPFIBhH5EAB8b+Tlt9MYQ6i1BuqFaq1CKSVcxZ2Acs6406KUgpt5/LCKuVgz5BDCSb13ZO99ZOdcZGvt4mJjzMVKqcha68iIePB86GAiOv8CDADlIUQBs7MD3wAAAABJRU5ErkJggg%3D%3D&quot;) repeat-x rgb(45, 174, 191); display: inline-block; cursor: pointer; border-radius: 10px; box-shadow: rgba(0, 0, 0, 0.5) 0px 1px 3px; text-shadow: rgba(0, 0, 0, 0.25) 0px -1px 1px; vertical-align: middle; padding: 3px 8px; border: none; font-size: 12px; color: rgb(255, 255, 255); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: bold; line-height: 1.5em; text-decoration: none;">好文要顶</a> <a href="http://loadhtml/#" style="margin: 0px 10px 0px 0px; background: url(&quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAAkCAYAAABIdFAMAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAHhJREFUeNo8zjsOxCAMBFB/KEAUFFR0Cbng3nQPw68ArZdAlOZppPFIBhH5EAB8b+Tlt9MYQ6i1BuqFaq1CKSVcxZ2Acs6406KUgpt5/LCKuVgz5BDCSb13ZO99ZOdcZGvt4mJjzMVKqcha68iIePB86GAiOv8CDADlIUQBs7MD3wAAAABJRU5ErkJggg%3D%3D&quot;) repeat-x rgb(227, 49, 0); display: inline-block; cursor: pointer; border-radius: 10px; box-shadow: rgba(0, 0, 0, 0.5) 0px 1px 3px; text-shadow: rgba(0, 0, 0, 0.25) 0px -1px 1px; vertical-align: middle; padding: 3px 8px; border: none; font-size: 12px; color: rgb(255, 255, 255); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: bold; line-height: 1.5em; text-decoration: none;">关注我</a> <a href="http://loadhtml/#" style="margin: 0px 10px 0px 0px; background: url(&quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAAkCAYAAABIdFAMAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAHhJREFUeNo8zjsOxCAMBFB/KEAUFFR0Cbng3nQPw68ArZdAlOZppPFIBhH5EAB8b+Tlt9MYQ6i1BuqFaq1CKSVcxZ2Acs6406KUgpt5/LCKuVgz5BDCSb13ZO99ZOdcZGvt4mJjzMVKqcha68iIePB86GAiOv8CDADlIUQBs7MD3wAAAABJRU5ErkJggg%3D%3D&quot;) repeat-x rgb(255, 181, 21); display: inline-block; cursor: pointer; border-radius: 10px; box-shadow: rgba(0, 0, 0, 0.5) 0px 1px 3px; text-shadow: rgba(0, 0, 0, 0.25) 0px -1px 1px; vertical-align: middle; padding: 3px 8px; border: none; font-size: 12px; color: rgb(255, 255, 255); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: bold; line-height: 1.5em; text-decoration: none;">收藏该文</a> <a href="http://loadhtml/#" style="margin: 0px 10px 0px 0px; display: inline-block; cursor: pointer; border-radius: 10px; vertical-align: middle; background: none; box-shadow: none; text-shadow: none; padding: 3px 2px; border: none; font-size: 12px; color: rgb(255, 255, 255); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: bold; line-height: 1.5em; text-decoration: none;" title="分享至新浪微博"><img src="hadoop压缩框架_files/icon_weibo_24.png" type="image/png" data-filename="icon_weibo_24.png" height="24" style="margin:0px;padding:0px;max-width:100%;vertical-align:middle;margin-left:5px;box-shadow:none;border:none;" width="24"/></a> <a href="http://loadhtml/#" style="margin: 0px 10px 0px 0px; display: inline-block; cursor: pointer; border-radius: 10px; vertical-align: middle; background: none; box-shadow: none; text-shadow: none; padding: 3px 2px; border: none; font-size: 12px; color: rgb(255, 255, 255); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: bold; line-height: 1.5em; text-decoration: none;" title="分享至微信"><img src="hadoop压缩框架_files/wechat.png" type="image/png" data-filename="wechat.png" height="24" style="margin:0px;padding:0px;max-width:100%;width:24px;height:24px;box-shadow:none;margin-left:5px;vertical-align:middle;border:medium none;" width="24"/></a></div><div style="margin: 0px 0px 10px; padding: 0px; float: left; width: 280px; font-size: 12px;"><div style="margin: 0px; padding: 0px; float: left;"><a href="https://home.cnblogs.com/u/wuyudong/" style="margin: 0px; padding: 0px; border-bottom: 1px dashed rgb(81, 115, 224); font-size: 12px; color: rgb(81, 115, 224); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400; line-height: 18px; text-decoration: none;" target="_blank"><img src="hadoop压缩框架_files/20160607232951.png" type="image/jpeg" data-filename="20160607232951.png" height="48" style="margin:0px;padding:0px;vertical-align:top;float:left;margin-right:5px;padding-top:5px;padding-left:2px;border:0px;max-width:100%;" width="48"/></a><div style="margin: 0px; padding: 0px; float: left;"><div><a href="https://home.cnblogs.com/u/wuyudong/" style="margin: 0px; padding: 0px; border-bottom: 1px dashed rgb(81, 115, 224); font-size: 12px; color: rgb(81, 115, 224); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400; line-height: 18px; text-decoration: none;">wuyudong</a></div><div><a href="https://home.cnblogs.com/u/wuyudong/followees/" style="margin: 0px; padding: 0px; border-bottom: 1px dashed rgb(81, 115, 224); font-size: 12px; color: rgb(81, 115, 224); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400; line-height: 18px; text-decoration: none;">关注 - 2</a></div><div><a href="https://home.cnblogs.com/u/wuyudong/followers/" style="margin: 0px; padding: 0px; border-bottom: 1px dashed rgb(81, 115, 224); font-size: 12px; color: rgb(81, 115, 224); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400; line-height: 18px; text-decoration: none;">粉丝 - 493</a></div></div></div><div style="margin:0px;padding:0px;clear:both;"></div><div style="margin:0px;padding:0px;"></div><div style="margin:0px;padding:0px;"><a href="http://loadhtml/#" style="margin: 0px; padding: 0px; border-bottom: 1px dashed rgb(81, 115, 224); font-size: 12px; color: rgb(81, 115, 224); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400; line-height: 1.5em; text-decoration: none;">+加关注</a></div></div></div><div style="margin:0px;padding:0px;clear:both;"></div><div style="margin: 0px; padding: 0px; font-size: 12px;"><div><a href="https://www.cnblogs.com/wuyudong/p/hadoop-writable.html" style="margin: 0px; padding: 0px; border-bottom: 1px dashed rgb(81, 115, 224); font-size: 12px; color: rgb(81, 115, 224); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400; line-height: 1.8; text-decoration: none;">«</a> <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400; line-height: 1.8;">上一篇：</span> <a href="https://www.cnblogs.com/wuyudong/p/hadoop-writable.html" style="margin: 0px; padding: 0px; border-bottom: 1px dashed rgb(81, 115, 224); font-size: 12px; color: rgb(81, 115, 224); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400; line-height: 1.8; text-decoration: none;" title="发布于 2015-03-30 15:35">hadoop中典型Writable类详解</a></div><div><a href="https://www.cnblogs.com/wuyudong/p/java-study-note16.html" style="margin: 0px; padding: 0px; border-bottom: 1px dashed rgb(81, 115, 224); font-size: 12px; color: rgb(81, 115, 224); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400; line-height: 1.8; text-decoration: none;">»</a> <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400; line-height: 1.8;">下一篇：</span> <a href="https://www.cnblogs.com/wuyudong/p/java-study-note16.html" style="margin: 0px; padding: 0px; border-bottom: 1px dashed rgb(81, 115, 224); font-size: 12px; color: rgb(81, 115, 224); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400; line-height: 1.8; text-decoration: none;" title="发布于 2015-03-31 19:18">java学习笔记16--I/O流和文件</a></div></div></div></div><div style="margin: 5px 0px 7px; padding: 0px 5px 0px 0px; clear: both; float: right; text-align: right; width: 100%;"><span style="font-size: 14px; color: rgb(102, 102, 102); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400;">posted @</span> <span style="margin: 0px; padding: 0px; font-size: 14px; color: rgb(102, 102, 102); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400;">2015-03-30 20:16</span><span style="font-size: 14px; color: rgb(102, 102, 102); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400;"> </span> <a href="https://www.cnblogs.com/wuyudong/" style="margin: 0px; padding: 0px; font-size: 14px; color: rgb(165, 198, 59); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400; text-decoration: none;">wuyudong</a><span style="font-size: 14px; color: rgb(102, 102, 102); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400;">  阅读(</span><span style="margin: 0px; padding: 0px; font-size: 14px; color: rgb(102, 102, 102); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400;">1105</span><span style="font-size: 14px; color: rgb(102, 102, 102); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400;">)  评论(</span><span style="margin: 0px; padding: 0px; font-size: 14px; color: rgb(102, 102, 102); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400;">0</span><span style="font-size: 14px; color: rgb(102, 102, 102); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400;">) </span> <a href="https://i.cnblogs.com/EditPosts.aspx?postid=4378357" rel="nofollow" style="margin: 0px; padding: 0px; font-size: 14px; color: rgb(165, 198, 59); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400; text-decoration: none;">编辑</a><span style="font-size: 14px; color: rgb(102, 102, 102); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400;"> </span> <a href="http://loadhtml/#" style="margin: 0px; padding: 0px; font-size: 14px; color: rgb(165, 198, 59); font-family: &quot;HanHei SC&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiSC-Light, Arial, sans-serif; font-weight: 400; text-decoration: none;">收藏</a></div></div></div></div></div></div></div><div><br/></div></span>
</div></body></html> 