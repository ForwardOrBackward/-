<html>
<head>
  <title>Hive SQL转化为MapReduce执行计划深度解析</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/603932 (zh-CN, DDL); Windows/10.0.0 (Win64); EDAMVersion=V2;"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 12pt;
    }
  </style>
</head>
<body>
<a name="8015"/>
<h1>Hive SQL转化为MapReduce执行计划深度解析</h1>
<div>
<table bgcolor="#D4DDE5" border="0">
<tr><td><b>创建时间：</b></td><td><i>2021/4/14 13:52</i></td></tr>
<tr><td><b>更新时间：</b></td><td><i>2021/4/14 13:54</i></td></tr>
</table>
</div>
<br/>

<div>
<span><div><br/></div><div style="font-size: 16px; min-width: 100%; position: relative;"><div style="outline:0px;box-sizing:inherit;"><div style="min-width: 1200px; background: url(&quot;https://csdnimg.cn/release/blogv2/dist/pc/themesSkin/skin-yellow/images/bg.png?v20200831&quot;) repeat rgb(245, 246, 247); outline: 0px; box-sizing: inherit; font-size: 14px;"><div style="outline: 0px; box-sizing: inherit; -webkit-box-pack: center; justify-content: center;"><div style="outline: 0px; box-sizing: border-box;"><div style="outline: 0px; box-sizing: inherit; background: rgb(255, 255, 255);"><div style="outline: 0px; box-sizing: inherit; margin: 0px; padding: 8px 0px 0px; border-bottom: 1px solid rgb(245, 246, 247); z-index: 9; background-color: rgb(255, 255, 255);"><div style="outline: 0px; box-sizing: inherit; margin: 0px; padding: 0px;"><div style="outline: 0px; box-sizing: inherit; margin: 0px 0px 8px; padding: 0px;"><h1 style="outline: 0px; box-sizing: inherit; padding: 0px; overflow-wrap: break-word; word-break: break-all; font-size: 28px; margin: 0px;"><span style="box-sizing:inherit;outline:0px;"><span style="font-size: 28px; color: rgb(34, 34, 38); font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; font-weight: 600; line-height: 1.57143;">Hive SQL转化为MapReduce执行计划深度解析</span></span></h1></div><div style="outline: 0px; box-sizing: inherit; margin: 0px; padding: 0px; position: relative; background: rgb(248, 248, 248); border-radius: 4px;"><div style="outline: 0px; box-sizing: inherit; margin: 0px; padding: 0px; width: 88%; display: flex;"><div><span style="font-size: 14px; color: rgb(153, 154, 170); font-family: &quot;SF Pro Display&quot;, Roboto, Noto, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 1.57143;"><img src="Hive SQL转化为MapReduce执行计划深度解析_files/original.png" type="image/png" data-filename="original.png" height="32" style="border:0px;box-sizing:inherit;outline:0px;width:36px;height:32px;margin-right:12px;line-height:32px;" width="36"/></span></div><div style="outline: 0px; box-sizing: inherit; margin: 0px; padding: 0px;"><a href="https://blog.csdn.net/i000zheng" rel="noopener" style="margin: 0px 20px 0px 0px; padding: 0px; box-sizing: inherit; outline: 0px; cursor: pointer; vertical-align: top; font-size: 14px; font-family: &quot;SF Pro Display&quot;, Roboto, Noto, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 32px; color: rgb(85, 86, 102); text-decoration: none;" target="_blank">i000zheng</a> <span style="margin: 0px 12px 0px 0px; padding: 0px; outline: 0px; box-sizing: inherit; vertical-align: top; position: relative; font-size: 14px; color: rgb(153, 154, 170); font-family: &quot;SF Pro Display&quot;, Roboto, Noto, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 32px;">2018-07-18 11:28:24</span> <span style="font-size: 14px; color: rgb(153, 154, 170); font-family: &quot;SF Pro Display&quot;, Roboto, Noto, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 1.57143;"><img src="Hive SQL转化为MapReduce执行计划深度解析_files/articleReadEyes.png" type="image/png" data-filename="articleReadEyes.png" height="24" style="border:0px;box-sizing:inherit;outline:0px;width:24px;height:24px;margin-top:4px;" width="24"/></span> <span style="margin: 0px 12px 0px 0px; padding: 0px; outline: 0px; box-sizing: inherit; vertical-align: top; font-size: 14px; color: rgb(153, 154, 170); font-family: &quot;SF Pro Display&quot;, Roboto, Noto, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 32px;">6796</span> <span style="font-size: 14px; font-family: &quot;SF Pro Display&quot;, Roboto, Noto, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 32px; color: rgb(153, 154, 170); text-decoration: none; margin: 0px 12px 0px 0px; padding: 0px; box-sizing: inherit; outline: 0px; cursor: pointer; vertical-align: top; display: inline-block;"><img src="Hive SQL转化为MapReduce执行计划深度解析_files/tobarCollect.png" type="image/png" data-filename="tobarCollect.png" height="20" style="border:0px;box-sizing:inherit;outline:0px;vertical-align:middle;width:20px;height:20px;margin-top:0px;display:inline-block;" width="20"/></span> <span style="margin: 0px; padding: 0px; outline: 0px; box-sizing: inherit; vertical-align: top; font-size: 14px; font-family: &quot;SF Pro Display&quot;, Roboto, Noto, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 32px; color: rgb(153, 154, 170); text-decoration: none;">收藏</span> <span style="margin: 0px; padding: 0px; outline: 0px; box-sizing: inherit; vertical-align: top; font-size: 14px; font-family: &quot;SF Pro Display&quot;, Roboto, Noto, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 32px; color: rgb(153, 154, 170); text-decoration: none;">19</span></div></div><div style="outline: 0px; box-sizing: inherit; margin: 0px; padding: 0px 0px 0px 48px; display: flex;"><div style="outline: 0px; box-sizing: inherit; margin: 0px 8px 4px 0px; padding: 0px; font-size: 14px;"><span style="margin: 0px; padding: 0px; outline: 0px; box-sizing: inherit; display: inline-block; font-size: 14px; color: rgb(153, 154, 170); font-family: &quot;SF Pro Display&quot;, Roboto, Noto, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 24px;">分类专栏：</span> <a href="https://blog.csdn.net/i000zheng/category_7656569.html" rel="noopener" style="margin: 0px 8px 0px 0px; outline: 0px; cursor: pointer; font-size: 12px; background-color: rgb(255, 255, 255); border: 1px solid rgb(234, 234, 239); height: 24px; border-radius: 2px; display: inline-block; padding: 3px 6px; box-sizing: border-box; font-family: &quot;SF Pro Display&quot;, Roboto, Noto, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 17px; color: rgb(80, 148, 213); text-decoration: none;" target="_blank">Hive</a> <span style="margin: 0px; padding: 0px; outline: 0px; box-sizing: inherit; display: inline-block; font-size: 14px; color: rgb(153, 154, 170); font-family: &quot;SF Pro Display&quot;, Roboto, Noto, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 24px;">文章标签：</span> <a href="https://www.csdn.net/tags/OtTacgysODU5MC1ibG9n.html" rel="noopener" style="margin: 0px 8px 0px 0px; outline: 0px; cursor: pointer; font-size: 12px; background-color: rgb(255, 255, 255); border: 1px solid rgb(234, 234, 239); height: 24px; border-radius: 2px; display: inline-block; padding: 3px 6px; box-sizing: border-box; font-family: &quot;SF Pro Display&quot;, Roboto, Noto, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 17px; color: rgb(80, 148, 213); text-decoration: none;" target="_blank">Hive</a> <a href="https://www.csdn.net/tags/MtTaEg0sMDg0OTctYmxvZwO0O0OO0O0O.html" rel="noopener" style="margin: 0px 8px 0px 0px; outline: 0px; cursor: pointer; font-size: 12px; background-color: rgb(255, 255, 255); border: 1px solid rgb(234, 234, 239); height: 24px; border-radius: 2px; display: inline-block; padding: 3px 6px; box-sizing: border-box; font-family: &quot;SF Pro Display&quot;, Roboto, Noto, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 17px; color: rgb(80, 148, 213); text-decoration: none;" target="_blank">SQL</a> <a href="https://www.csdn.net/tags/MtTaEg0sMjI3ODEtYmxvZwO0O0OO0O0O.html" rel="noopener" style="margin: 0px 8px 0px 0px; outline: 0px; cursor: pointer; font-size: 12px; background-color: rgb(255, 255, 255); border: 1px solid rgb(234, 234, 239); height: 24px; border-radius: 2px; display: inline-block; padding: 3px 6px; box-sizing: border-box; font-family: &quot;SF Pro Display&quot;, Roboto, Noto, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 17px; color: rgb(80, 148, 213); text-decoration: none;" target="_blank">MapReduce</a></div></div><div style="outline: 0px; box-sizing: inherit; margin: 0px; padding: 0px; position: absolute; top: 0px; right: 8px;"><span style="font-size: 12px; font-family: &quot;SF Pro Display&quot;, Roboto, Noto, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 32px; color: rgb(143, 176, 201); text-decoration: none; margin: 0px; box-sizing: inherit; outline: 0px; cursor: pointer; position: relative; padding: 0px 4px;">版权</span></div></div></div></div><div style="box-sizing: inherit; outline: 0px; position: relative; padding-top: 16px;"><div style="outline: 0px; box-sizing: inherit; margin: 0px; padding: 0px; overflow-wrap: break-word;"><div style="outline: 0px; box-sizing: inherit; margin: 0px; padding: 0px; overflow-wrap: break-word; position: relative; min-height: 70px; font-size: 16px;"><div style="outline: 0px; padding: 0px; overflow-wrap: break-word; margin: 0px 0px 16px; box-sizing: border-box; font-size: 16px;"><span style="font-size: 16px; color: rgb(77, 77, 77); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: 700; line-height: 26px; outline: 0px; overflow-wrap: break-word; box-sizing: border-box;">目录</span></div><div style="outline: 0px; padding: 0px; overflow-wrap: break-word; margin: 0px 0px 16px 40px; box-sizing: border-box; font-size: 16px;"><a href="https://blog.csdn.net/i000zheng/article/details/81082774#t0" style="margin: 0px; padding: 0px; outline: 0px; cursor: pointer; overflow-wrap: break-word; box-sizing: border-box; font-size: 16px; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: normal; line-height: 26px; color: rgb(78, 161, 219); text-decoration: none;" target="_self">1. MapReduce实现基本SQL操作的原理</a></div><div style="outline: 0px; padding: 0px; overflow-wrap: break-word; margin: 0px 0px 16px 80px; box-sizing: border-box; font-size: 16px;"><a href="https://blog.csdn.net/i000zheng/article/details/81082774#t1" style="margin: 0px; padding: 0px; outline: 0px; cursor: pointer; overflow-wrap: break-word; box-sizing: border-box; font-size: 16px; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: normal; line-height: 26px; color: rgb(78, 161, 219); text-decoration: none;" target="_self">1.1 Join的实现原理</a></div><div style="outline: 0px; padding: 0px; overflow-wrap: break-word; margin: 0px 0px 16px 80px; box-sizing: border-box; font-size: 16px;"><a href="https://blog.csdn.net/i000zheng/article/details/81082774#t2" style="margin: 0px; padding: 0px; outline: 0px; cursor: pointer; overflow-wrap: break-word; box-sizing: border-box; font-size: 16px; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: normal; line-height: 26px; color: rgb(78, 161, 219); text-decoration: none;" target="_self">1.2 Group By的实现原理</a></div><div style="outline: 0px; padding: 0px; overflow-wrap: break-word; margin: 0px 0px 16px 80px; box-sizing: border-box; font-size: 16px;"><a href="https://blog.csdn.net/i000zheng/article/details/81082774#t3" style="margin: 0px; padding: 0px; outline: 0px; cursor: pointer; overflow-wrap: break-word; box-sizing: border-box; font-size: 16px; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: normal; line-height: 26px; color: rgb(78, 161, 219); text-decoration: none;" target="_self">1.3 Distinct的实现原理</a></div><div style="outline: 0px; padding: 0px; overflow-wrap: break-word; margin: 0px 0px 16px 40px; box-sizing: border-box; font-size: 16px;"><a href="https://blog.csdn.net/i000zheng/article/details/81082774#t4" style="margin: 0px; padding: 0px; outline: 0px; cursor: pointer; overflow-wrap: break-word; box-sizing: border-box; font-size: 16px; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: normal; line-height: 26px; color: rgb(78, 161, 219); text-decoration: none;" target="_self">2. SQL转化为MapReduce的过程</a></div><div style="outline: 0px; padding: 0px; overflow-wrap: break-word; margin: 0px 0px 16px 80px; box-sizing: border-box; font-size: 16px;"><a href="https://blog.csdn.net/i000zheng/article/details/81082774#t5" style="margin: 0px; padding: 0px; outline: 0px; cursor: pointer; overflow-wrap: break-word; box-sizing: border-box; font-size: 16px; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: normal; line-height: 26px; color: rgb(78, 161, 219); text-decoration: none;" target="_self">2.1 Phase1 SQL词法，语法解析</a></div><div style="outline: 0px; padding: 0px; overflow-wrap: break-word; margin: 0px 0px 16px 80px; box-sizing: border-box; font-size: 16px;"><a href="https://blog.csdn.net/i000zheng/article/details/81082774#t6" style="margin: 0px; padding: 0px; outline: 0px; cursor: pointer; overflow-wrap: break-word; box-sizing: border-box; font-size: 16px; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: normal; line-height: 26px; color: rgb(78, 161, 219); text-decoration: none;" target="_self">2.2 Phase2 SQL基本组成单元QueryBlock </a></div><div style="outline: 0px; padding: 0px; overflow-wrap: break-word; margin: 0px 0px 16px 80px; box-sizing: border-box; font-size: 16px;"><a href="https://blog.csdn.net/i000zheng/article/details/81082774#t7" style="margin: 0px; padding: 0px; outline: 0px; cursor: pointer; overflow-wrap: break-word; box-sizing: border-box; font-size: 16px; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: normal; line-height: 26px; color: rgb(78, 161, 219); text-decoration: none;" target="_self">2.3 Phase3 逻辑操作符Operator和逻辑操作树Operator Tree</a></div><div style="outline: 0px; padding: 0px; overflow-wrap: break-word; margin: 0px 0px 16px 80px; box-sizing: border-box; font-size: 16px;"><a href="https://blog.csdn.net/i000zheng/article/details/81082774#t8" style="margin: 0px; padding: 0px; outline: 0px; cursor: pointer; overflow-wrap: break-word; box-sizing: border-box; font-size: 16px; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: normal; line-height: 26px; color: rgb(78, 161, 219); text-decoration: none;" target="_self">2.4 Phase4 逻辑层优化器</a></div><div style="outline: 0px; padding: 0px; overflow-wrap: break-word; margin: 0px 0px 16px 80px; box-sizing: border-box; font-size: 16px;"><a href="https://blog.csdn.net/i000zheng/article/details/81082774#t9" style="margin: 0px; padding: 0px; outline: 0px; cursor: pointer; overflow-wrap: break-word; box-sizing: border-box; font-size: 16px; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: normal; line-height: 26px; color: rgb(78, 161, 219); text-decoration: none;" target="_self">2.5 Phase5 OperatorTree生成MapReduce Job的过程</a></div><div style="outline: 0px; padding: 0px; overflow-wrap: break-word; margin: 0px 0px 16px 80px; box-sizing: border-box; font-size: 16px;"><a href="https://blog.csdn.net/i000zheng/article/details/81082774#t10" style="margin: 0px; padding: 0px; outline: 0px; cursor: pointer; overflow-wrap: break-word; box-sizing: border-box; font-size: 16px; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: normal; line-height: 26px; color: rgb(78, 161, 219); text-decoration: none;" target="_self">2.6 Phase6 物理层优化器</a></div><div style="outline: 0px; padding: 0px; overflow-wrap: break-word; margin: 0px 0px 16px 40px; box-sizing: border-box; font-size: 16px;"><a href="https://blog.csdn.net/i000zheng/article/details/81082774#t11" style="margin: 0px; padding: 0px; outline: 0px; cursor: pointer; overflow-wrap: break-word; box-sizing: border-box; font-size: 16px; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: normal; line-height: 26px; color: rgb(78, 161, 219); text-decoration: none;" target="_self">3. 待续</a></div><hr style="outline:0px;overflow-wrap:break-word;box-sizing:border-box;margin:24px 0px;border-top:none;border-right:none;border-left:none;border-image:initial;border-bottom:1px solid rgb(204, 204, 204);"/><hr style="outline:0px;overflow-wrap:break-word;box-sizing:border-box;margin:24px 0px;border-top:none;border-right:none;border-left:none;border-image:initial;border-bottom:1px solid rgb(204, 204, 204);"/><div style="outline: 0px; padding: 0px; overflow-wrap: break-word; margin: 0px 0px 16px; box-sizing: border-box; font-size: 16px;"><span style="font-size: 16px; color: rgb(77, 77, 77); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: 400; line-height: 26px;">文章主体源于美团网技术陈纯大作，值得拥有。</span><a href="http://tech.meituan.com/hive-sql-to-mapreduce.html" style="margin: 0px; padding: 0px; outline: 0px; cursor: pointer; overflow-wrap: break-word; box-sizing: border-box; font-size: 16px; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: normal; line-height: 26px; color: rgb(78, 161, 219); text-decoration: none;">原文</a><span style="font-size: 16px; color: rgb(77, 77, 77); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: 400; line-height: 26px;">在</span><a href="https://tech.meituan.com/" style="margin: 0px; padding: 0px; outline: 0px; cursor: pointer; overflow-wrap: break-word; box-sizing: border-box; font-size: 16px; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: normal; line-height: 26px; color: rgb(78, 161, 219); text-decoration: none;">美团技术团队</a><span style="font-size: 16px; color: rgb(77, 77, 77); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: 400; line-height: 26px;">中已被删除。梳理了其中一些关键内容。并添加了一些自己的理解。</span></div><div style="outline: 0px; padding: 0px; overflow-wrap: break-word; margin: 0px 0px 16px; box-sizing: border-box; font-size: 16px;"><span style="font-size: 16px; color: rgb(77, 77, 77); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: 400; line-height: 26px;">其中一部分图来自</span><a href="https://www.slideshare.net/recruitcojp?utm_campaign=profiletracking&amp;utm_medium=sssite&amp;utm_source=ssslideview" style="margin: 0px; padding: 0px; outline: 0px; cursor: pointer; overflow-wrap: break-word; box-sizing: border-box; font-size: 16px; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: normal; line-height: 26px; color: rgb(78, 161, 219); text-decoration: none;">Recruit Technologies</a><span style="font-size: 16px; color: rgb(77, 77, 77); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: 400; line-height: 26px;">的slice：</span><a href="https://www.slideshare.net/recruitcojp/internal-hive" style="margin: 0px; padding: 0px; outline: 0px; cursor: pointer; overflow-wrap: break-word; box-sizing: border-box; font-size: 16px; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: normal; line-height: 26px; color: rgb(78, 161, 219); text-decoration: none;">Internal Hive</a><span style="font-size: 16px; color: rgb(77, 77, 77); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: 400; line-height: 26px;">，一些看不懂的可以去参考一下原文（日文）。</span></div><h2 style="outline: 0px; padding: 0px; overflow-wrap: break-word; box-sizing: border-box; margin: 8px 0px 16px; font-size: 24px;"><span style="font-size: 24px; color: rgb(79, 79, 79); font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; font-weight: 700; line-height: 32px;">1. MapReduce实现基本SQL操作的原理</span></h2><div style="outline: 0px; padding: 0px; overflow-wrap: break-word; margin: 0px 0px 16px; box-sizing: border-box; font-size: 16px;"><span style="font-size: 16px; color: rgb(77, 77, 77); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: 400; line-height: 26px;">详细讲解SQL编译为MapReduce之前，我们先来看看MapReduce框架实现SQL基本操作的原理</span></div><h3 style="outline: 0px; padding: 0px; overflow-wrap: break-word; box-sizing: border-box; margin: 8px 0px 16px; font-size: 22px;"><span style="font-size: 22px; color: rgb(79, 79, 79); font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; font-weight: 700; line-height: 30px;">1.1 Join的实现原理</span></h3><div style="outline: 0px; position: relative; box-sizing: border-box; white-space: pre-wrap; overflow-x: auto; margin: 0px 0px 24px; padding: 8px; overflow-wrap: break-word; font-size: 14px;"><div style="outline: 0px; box-sizing: border-box; white-space: pre; tab-size: 4; background: rgb(250, 250, 250); overflow-wrap: normal; border-radius: 4px; overflow-x: auto; padding: 0.5em; font-size: 14px;"><span style="margin: 0px; padding: 0px; outline: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; color: rgb(166, 38, 164); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">select</span> <span style="font-size: 14px; color: rgb(56, 58, 66); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">u.name, o.orderid</span> <span style="margin: 0px; padding: 0px; outline: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; color: rgb(166, 38, 164); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">from</span> <span style="margin: 0px; padding: 0px; outline: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; color: rgb(166, 38, 164); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">order</span> <span style="font-size: 14px; color: rgb(56, 58, 66); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">o</span> <span style="margin: 0px; padding: 0px; outline: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; color: rgb(166, 38, 164); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">join</span> <span style="margin: 0px; padding: 0px; outline: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; color: rgb(166, 38, 164); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">user</span> <span style="font-size: 14px; color: rgb(56, 58, 66); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">u</span> <span style="margin: 0px; padding: 0px; outline: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; color: rgb(166, 38, 164); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">on</span> <span style="font-size: 14px; color: rgb(56, 58, 66); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">o.uid = u.uid;</span></div></div><div style="outline: 0px; padding: 0px; overflow-wrap: break-word; margin: 0px 0px 16px; box-sizing: border-box; font-size: 16px;"><span style="font-size: 16px; color: rgb(77, 77, 77); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: 400; line-height: 26px;">在map的输出value中为不同表的数据打上tag标记，在reduce阶段根据tag判断数据来源。MapReduce的过程如下（这里只是说明最基本的Join的实现，还有其他的实现方式）</span></div><div style="outline: 0px; padding: 0px; overflow-wrap: break-word; margin: 0px 0px 16px; box-sizing: border-box; font-size: 16px; text-align: center;"><span style="font-size: 16px; color: rgb(77, 77, 77); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: 400; line-height: 26px;"><a href="Hive SQL转化为MapReduce执行计划深度解析_files/mapjoin.png"><img src="Hive SQL转化为MapReduce执行计划深度解析_files/ad092e0acd3437eb6982f1bae7811d15.png" alt="mapjoin.png"></a></span></div><h3 style="outline: 0px; padding: 0px; overflow-wrap: break-word; box-sizing: border-box; margin: 8px 0px 16px; font-size: 22px;"><span style="font-size: 22px; color: rgb(79, 79, 79); font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; font-weight: 700; line-height: 30px;">1.2 Group By的实现原理</span></h3><div style="outline: 0px; position: relative; box-sizing: border-box; white-space: pre-wrap; overflow-x: auto; margin: 0px 0px 24px; padding: 8px; overflow-wrap: break-word; font-size: 14px;"><div style="outline: 0px; box-sizing: border-box; white-space: pre; tab-size: 4; background: rgb(250, 250, 250); overflow-wrap: normal; border-radius: 4px; overflow-x: auto; padding: 0.5em; font-size: 14px;"><span style="margin: 0px; padding: 0px; outline: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; color: rgb(166, 38, 164); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">select</span> <span style="margin: 0px; padding: 0px; outline: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; color: rgb(166, 38, 164); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">rank</span><span style="font-size: 14px; color: rgb(56, 58, 66); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">, isonline,</span> <span style="margin: 0px; padding: 0px; outline: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; color: rgb(166, 38, 164); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">count</span><span style="font-size: 14px; color: rgb(56, 58, 66); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">(*)</span> <span style="margin: 0px; padding: 0px; outline: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; color: rgb(166, 38, 164); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">from</span> <span style="font-size: 14px; color: rgb(56, 58, 66); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">city</span> <span style="margin: 0px; padding: 0px; outline: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; color: rgb(166, 38, 164); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">group</span> <span style="margin: 0px; padding: 0px; outline: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; color: rgb(166, 38, 164); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">by</span> <span style="margin: 0px; padding: 0px; outline: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; color: rgb(166, 38, 164); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">rank</span><span style="font-size: 14px; color: rgb(56, 58, 66); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">, isonline;</span></div></div><div style="outline: 0px; padding: 0px; overflow-wrap: break-word; margin: 0px 0px 16px; box-sizing: border-box; font-size: 16px;"><span style="font-size: 16px; color: rgb(77, 77, 77); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: 400; line-height: 26px;">将GroupBy的字段组合为map的输出key值，利用MapReduce的排序，在reduce阶段保存LastKey区分不同的key。MapReduce的过程如下（当然这里只是说明Reduce端的非Hash聚合过程）</span></div><div style="outline: 0px; padding: 0px; overflow-wrap: break-word; margin: 0px 0px 16px; box-sizing: border-box; font-size: 16px; text-align: center;"><span style="font-size: 16px; color: rgb(77, 77, 77); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: 400; line-height: 26px;"><a href="Hive SQL转化为MapReduce执行计划深度解析_files/mapjoin.png"><img src="Hive SQL转化为MapReduce执行计划深度解析_files/ad092e0acd3437eb6982f1bae7811d15.png" alt="mapjoin.png"></a></span></div><h3 style="outline: 0px; padding: 0px; overflow-wrap: break-word; box-sizing: border-box; margin: 8px 0px 16px; font-size: 22px;"><span style="font-size: 22px; color: rgb(79, 79, 79); font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; font-weight: 700; line-height: 30px;">1.3 Distinct的实现原理</span></h3><div style="outline: 0px; position: relative; box-sizing: border-box; white-space: pre-wrap; overflow-x: auto; margin: 0px 0px 24px; padding: 8px; overflow-wrap: break-word; font-size: 14px;"><div style="outline: 0px; box-sizing: border-box; white-space: pre; tab-size: 4; background: rgb(250, 250, 250); overflow-wrap: normal; border-radius: 4px; overflow-x: auto; padding: 0.5em; font-size: 14px;"><span style="margin: 0px; padding: 0px; outline: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; color: rgb(166, 38, 164); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">select</span> <span style="font-size: 14px; color: rgb(56, 58, 66); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">dealid,</span> <span style="margin: 0px; padding: 0px; outline: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; color: rgb(166, 38, 164); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">count</span><span style="font-size: 14px; color: rgb(56, 58, 66); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">(</span><span style="margin: 0px; padding: 0px; outline: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; color: rgb(166, 38, 164); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">distinct</span> <span style="font-size: 14px; color: rgb(56, 58, 66); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">uid)</span> <span style="margin: 0px; padding: 0px; outline: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; color: rgb(166, 38, 164); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">num</span> <span style="margin: 0px; padding: 0px; outline: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; color: rgb(166, 38, 164); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">from</span> <span style="margin: 0px; padding: 0px; outline: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; color: rgb(166, 38, 164); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">order</span> <span style="margin: 0px; padding: 0px; outline: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; color: rgb(166, 38, 164); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">group</span> <span style="margin: 0px; padding: 0px; outline: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; color: rgb(166, 38, 164); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">by</span> <span style="font-size: 14px; color: rgb(56, 58, 66); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">dealid;</span></div></div><div style="outline: 0px; padding: 0px; overflow-wrap: break-word; margin: 0px 0px 16px; box-sizing: border-box; font-size: 16px; text-align: center;"><span style="font-size: 16px; color: rgb(77, 77, 77); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: 400; line-height: 26px;"><a href="Hive SQL转化为MapReduce执行计划深度解析_files/mapjoin.png"><img src="Hive SQL转化为MapReduce执行计划深度解析_files/ad092e0acd3437eb6982f1bae7811d15.png" alt="mapjoin.png"></a></span></div><div style="outline: 0px; padding: 0px; overflow-wrap: break-word; margin: 0px 0px 16px; box-sizing: border-box; font-size: 16px;"><span style="font-size: 16px; color: rgb(77, 77, 77); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: 400; line-height: 26px;">如果有多个distinct字段呢，如下面的SQL</span></div><div style="outline: 0px; position: relative; box-sizing: border-box; white-space: pre-wrap; overflow-x: auto; margin: 0px 0px 24px; padding: 8px; overflow-wrap: break-word; font-size: 14px;"><div style="outline: 0px; box-sizing: border-box; white-space: pre; tab-size: 4; background: rgb(250, 250, 250); overflow-wrap: normal; border-radius: 4px; overflow-x: auto; padding: 0.5em; font-size: 14px;"><span style="margin: 0px; padding: 0px; outline: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; color: rgb(166, 38, 164); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">select</span> <span style="font-size: 14px; color: rgb(56, 58, 66); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">dealid,</span> <span style="margin: 0px; padding: 0px; outline: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; color: rgb(166, 38, 164); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">count</span><span style="font-size: 14px; color: rgb(56, 58, 66); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">(</span><span style="margin: 0px; padding: 0px; outline: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; color: rgb(166, 38, 164); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">distinct</span> <span style="font-size: 14px; color: rgb(56, 58, 66); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">uid),</span> <span style="margin: 0px; padding: 0px; outline: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; color: rgb(166, 38, 164); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">count</span><span style="font-size: 14px; color: rgb(56, 58, 66); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">(</span><span style="margin: 0px; padding: 0px; outline: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; color: rgb(166, 38, 164); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">distinct</span> <span style="margin: 0px; padding: 0px; outline: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; color: rgb(193, 132, 1); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">date</span><span style="font-size: 14px; color: rgb(56, 58, 66); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">)</span> <span style="margin: 0px; padding: 0px; outline: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; color: rgb(166, 38, 164); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">from</span> <span style="margin: 0px; padding: 0px; outline: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; color: rgb(166, 38, 164); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">order</span> <span style="margin: 0px; padding: 0px; outline: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; color: rgb(166, 38, 164); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">group</span> <span style="margin: 0px; padding: 0px; outline: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; color: rgb(166, 38, 164); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">by</span> <span style="font-size: 14px; color: rgb(56, 58, 66); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">dealid;</span></div></div><div style="outline: 0px; padding: 0px; overflow-wrap: break-word; margin: 0px 0px 16px; box-sizing: border-box; font-size: 16px;"><span style="font-size: 16px; color: rgb(77, 77, 77); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: 400; line-height: 26px;">实现方式有两种：</span></div><div style="outline: 0px; padding: 0px; overflow-wrap: break-word; margin: 0px 0px 16px; box-sizing: border-box; font-size: 16px;"><span style="font-size: 16px; color: rgb(77, 77, 77); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: 400; line-height: 26px;">（1）如果仍然按照上面一个distinct字段的方法，即下图这种实现方式，无法跟据uid和date分别排序，也就无法通过LastKey去重，仍然需要在reduce阶段在内存中通过Hash去重</span></div><div style="outline: 0px; padding: 0px; overflow-wrap: break-word; margin: 0px 0px 16px; box-sizing: border-box; font-size: 16px; text-align: center;"><span style="font-size: 16px; color: rgb(77, 77, 77); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: 400; line-height: 26px;"><a href="Hive SQL转化为MapReduce执行计划深度解析_files/mapjoin.png"><img src="Hive SQL转化为MapReduce执行计划深度解析_files/ad092e0acd3437eb6982f1bae7811d15.png" alt="mapjoin.png"></a></span></div><div style="outline: 0px; padding: 0px; overflow-wrap: break-word; margin: 0px 0px 16px; box-sizing: border-box; font-size: 16px;"><span style="font-size: 16px; color: rgb(77, 77, 77); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: 400; line-height: 26px;">（2）第二种实现方式，可以对所有的distinct字段编号，每行数据生成n行数据，那么相同字段就会分别排序，这时只需要在reduce阶段记录LastKey即可去重。</span></div><div style="outline: 0px; padding: 0px; overflow-wrap: break-word; margin: 0px 0px 16px; box-sizing: border-box; font-size: 16px;"><span style="font-size: 16px; color: rgb(77, 77, 77); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: 400; line-height: 26px;">这种实现方式很好的利用了MapReduce的排序，节省了reduce阶段去重的内存消耗，但是缺点是增加了shuffle的数据量。需要注意的是，在生成reduce value时，除第一个distinct字段所在行需要保留value值，其余distinct数据行value字段均可为空。</span></div><div style="outline: 0px; padding: 0px; overflow-wrap: break-word; margin: 0px 0px 16px; box-sizing: border-box; font-size: 16px; text-align: center;"><span style="font-size: 16px; color: rgb(77, 77, 77); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: 400; line-height: 26px;"><a href="Hive SQL转化为MapReduce执行计划深度解析_files/mapjoin.png"><img src="Hive SQL转化为MapReduce执行计划深度解析_files/ad092e0acd3437eb6982f1bae7811d15.png" alt="mapjoin.png"></a></span></div><h2 style="outline: 0px; padding: 0px; overflow-wrap: break-word; box-sizing: border-box; margin: 8px 0px 16px; font-size: 24px;"><span style="font-size: 24px; color: rgb(79, 79, 79); font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; font-weight: 700; line-height: 32px;">2. SQL转化为MapReduce的过程</span></h2><div style="outline: 0px; padding: 0px; overflow-wrap: break-word; margin: 0px 0px 16px; box-sizing: border-box; font-size: 16px;"><span style="font-size: 16px; color: rgb(77, 77, 77); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: 400; line-height: 26px;">    了解了MapReduce实现SQL基本操作之后，我们来看看Hive是如何将SQL转化为MapReduce任务的，整个编译过程分为六个阶段：</span></div><div style="outline: 0px; margin: 8px 0px 0px 40px; padding: 0px; list-style: decimal; overflow-wrap: break-word; box-sizing: border-box;"><span style="font-size: 16px; color: rgb(51, 51, 51); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: normal; line-height: 1.57143;">Antlr定义SQL的语法规则，完成SQL词法，语法解析，将SQL转化为</span><span style="font-size: 16px; color: rgb(51, 51, 51); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: 700; line-height: 1.57143; outline: 0px; overflow-wrap: break-word; box-sizing: border-box;">抽象语法树AST Tree</span></div><div style="outline: 0px; margin: 8px 0px 0px 40px; padding: 0px; list-style: decimal; overflow-wrap: break-word; box-sizing: border-box;"><span style="font-size: 16px; color: rgb(51, 51, 51); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: normal; line-height: 1.57143;">遍历AST Tree，抽象出查询的基本组成单元</span><span style="font-size: 16px; color: rgb(51, 51, 51); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: 700; line-height: 1.57143; outline: 0px; overflow-wrap: break-word; box-sizing: border-box;">QueryBlock</span></div><div style="outline: 0px; margin: 8px 0px 0px 40px; padding: 0px; list-style: decimal; overflow-wrap: break-word; box-sizing: border-box;"><span style="font-size: 16px; color: rgb(51, 51, 51); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: normal; line-height: 1.57143;">遍历QueryBlock，翻译为执行操作树OperatorTree,</span></div><div style="outline: 0px; margin: 8px 0px 0px 40px; padding: 0px; list-style: decimal; overflow-wrap: break-word; box-sizing: border-box;"><span style="font-size: 16px; color: rgb(51, 51, 51); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: normal; line-height: 1.57143;">逻辑层优化器进行OperatorTree变换，合并不必要的ReduceSinkOperator，减少shuffle数据量</span></div><div style="outline: 0px; margin: 8px 0px 0px 40px; padding: 0px; list-style: decimal; overflow-wrap: break-word; box-sizing: border-box;"><span style="font-size: 16px; color: rgb(51, 51, 51); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: normal; line-height: 1.57143;">遍历OperatorTree，翻译为MapReduce任务</span></div><div style="outline: 0px; margin: 8px 0px 0px 40px; padding: 0px; list-style: decimal; overflow-wrap: break-word; box-sizing: border-box;"><span style="font-size: 16px; color: rgb(51, 51, 51); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: normal; line-height: 1.57143;">物理层优化器进行MapReduce任务的变换，生成最终的执行计划</span></div><div style="outline: 0px; padding: 0px; overflow-wrap: break-word; margin: 0px 0px 16px; box-sizing: border-box; font-size: 16px;"><span style="font-size: 16px; color: rgb(77, 77, 77); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: 400; line-height: 26px;">在slice中，将着六个阶段表示为：</span></div><div style="outline: 0px; margin: 8px 0px 0px 40px; padding: 0px; list-style: decimal; overflow-wrap: break-word; box-sizing: border-box;"><span style="font-size: 16px; color: rgb(51, 51, 51); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: normal; line-height: 1.57143;">解析：将HIVEQL解析为AST。</span></div><div style="outline: 0px; margin: 8px 0px 0px 40px; padding: 0px; list-style: decimal; overflow-wrap: break-word; box-sizing: border-box;"><span style="font-size: 16px; color: rgb(51, 51, 51); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: normal; line-height: 1.57143;">语义解析：将AST翻译为QB。</span></div><div style="outline: 0px; margin: 8px 0px 0px 40px; padding: 0px; list-style: decimal; overflow-wrap: break-word; box-sizing: border-box;"><span style="font-size: 16px; color: rgb(51, 51, 51); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: normal; line-height: 1.57143;">生成逻辑计划：将QB转化为OperatorTree</span></div><div style="outline: 0px; margin: 8px 0px 0px 40px; padding: 0px; list-style: decimal; overflow-wrap: break-word; box-sizing: border-box;"><span style="font-size: 16px; color: rgb(51, 51, 51); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: normal; line-height: 1.57143;">优化逻辑计划</span></div><div style="outline: 0px; margin: 8px 0px 0px 40px; padding: 0px; list-style: decimal; overflow-wrap: break-word; box-sizing: border-box;"><span style="font-size: 16px; color: rgb(51, 51, 51); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: normal; line-height: 1.57143;">生成物理执行计划：将OperatorTree转化为TaskTree</span></div><div style="outline: 0px; margin: 8px 0px 0px 40px; padding: 0px; list-style: decimal; overflow-wrap: break-word; box-sizing: border-box;"><span style="font-size: 16px; color: rgb(51, 51, 51); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: normal; line-height: 1.57143;">优化物理计划</span></div><div style="outline: 0px; padding: 0px; overflow-wrap: break-word; margin: 0px 0px 16px; box-sizing: border-box; font-size: 16px;"><span style="font-size: 16px; color: rgb(77, 77, 77); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: 400; line-height: 26px;"><img src="Hive SQL转化为MapReduce执行计划深度解析_files/70" type="image/png" data-filename="70" height="293" style="border:0px;outline:0px;overflow-wrap:break-word;max-width:100%;height:auto;box-sizing:border-box;cursor:zoom-in;" width="400"/></span></div><div style="outline: 0px; padding: 0px; overflow-wrap: break-word; margin: 0px 0px 16px; box-sizing: border-box; font-size: 16px; text-align: center;"><span style="font-size: 16px; color: rgb(77, 77, 77); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: 400; line-height: 26px;"><img src="Hive SQL转化为MapReduce执行计划深度解析_files/70 [1]" type="image/png" data-filename="70" height="291" style="border:0px;outline:0px;overflow-wrap:break-word;max-width:100%;height:auto;box-sizing:border-box;cursor:zoom-in;" width="400"/></span></div><h3 style="outline: 0px; padding: 0px; overflow-wrap: break-word; box-sizing: border-box; margin: 8px 0px 16px; font-size: 22px;"><span style="font-size: 22px; color: rgb(79, 79, 79); font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; font-weight: 700; line-height: 30px;">2.1 Phase1 SQL词法，语法解析</span></h3><div style="outline: 0px; padding: 0px; overflow-wrap: break-word; margin: 0px 0px 16px; box-sizing: border-box; font-size: 16px;"><span style="font-size: 16px; color: rgb(77, 77, 77); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: 700; line-height: 26px; outline: 0px; overflow-wrap: break-word; box-sizing: border-box;">Antlr</span></div><div style="outline: 0px; padding: 0px; overflow-wrap: break-word; margin: 0px 0px 16px; box-sizing: border-box; font-size: 16px;"><div><span style="font-size: 16px; color: rgb(77, 77, 77); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: 400; line-height: 26px;">Hive使用Antlr实现SQL的词法和语法解析。Antlr是一种语言识别的工具，可以用来构造领域语言。</span></div><div><span style="font-size: 16px; color: rgb(77, 77, 77); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: 400; line-height: 26px;">这里不详细介绍Antlr，只需要了解使用Antlr构造特定的语言只需要编写一个语法文件，定义词法和语法替换规则即可，Antlr完成了词法分析、语法分析、语义分析、中间代码生成的过程。</span></div></div><div style="outline: 0px; padding: 0px; overflow-wrap: break-word; margin: 0px 0px 16px; box-sizing: border-box; font-size: 16px;"><span style="font-size: 16px; color: rgb(77, 77, 77); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: 700; line-height: 26px; outline: 0px; overflow-wrap: break-word; box-sizing: border-box;">抽象语法树AST Tree（看不懂概念没关系，重点看guo）</span></div><div style="outline: 0px; padding: 0px; overflow-wrap: break-word; margin: 0px 0px 16px; box-sizing: border-box; font-size: 16px;"><span style="font-size: 16px; color: rgb(77, 77, 77); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: 400; line-height: 26px;">经过词法和语法解析后，如果需要对表达式做进一步的处理，使用 Antlr 的抽象语法树语法Abstract Syntax Tree，在语法分析的同时将输入语句转换成抽象语法树，后续在遍历语法树时完成进一步的处理。</span></div><div style="outline: 0px; padding: 0px; overflow-wrap: break-word; margin: 0px 0px 16px; box-sizing: border-box; font-size: 16px;"><div><span style="font-size: 16px; color: rgb(77, 77, 77); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: 400; line-height: 26px;">下面的一段语法是Hive SQL中SelectStatement的语法规则，从中可以看出，SelectStatement包含select, from, where, groupby, having, orderby等子句。</span></div><div><span style="font-size: 16px; color: rgb(77, 77, 77); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: 400; line-height: 26px;">（在下面的语法规则中，箭头表示对于原语句的改写，改写后会加入一些特殊词标示特定语法，比如TOK_QUERY标示一个查询块）</span></div></div><div style="outline: 0px; position: relative; box-sizing: border-box; white-space: pre-wrap; overflow-x: auto; margin: 0px 0px 24px; padding: 8px; overflow-wrap: break-word; font-size: 14px;"><div style="outline: 0px; box-sizing: border-box; white-space: pre; tab-size: 4; background: rgb(250, 250, 250); overflow-wrap: normal; border-radius: 4px; overflow-x: auto; padding: 0.5em; font-size: 14px;"><div style="outline: 0px; margin: 0px; padding: 0px; list-style: none; overflow-wrap: break-word; box-sizing: border-box; height: 22px;"><div style="outline: 0px; margin: 0px; padding: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; float: left; height: 22px; width: 24px; border-right: 1px solid rgb(197, 197, 197);"><div style="outline: 0px; margin: 0px; padding: 0px 8px 0px 0px; text-align: right; box-sizing: border-box; font-size: 14px; overflow-wrap: normal;"><span style="text-align: right; font-size: 14px; color: rgb(56, 58, 66); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">1</span></div></div><div style="outline: 0px; margin: 0px 0px 0px 8px; padding: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; float: left; height: 22px;"><div style="outline: 0px; margin: 0px; padding: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px;"><span style="font-size: 14px; color: rgb(56, 58, 66); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">selectStatement</span></div></div></div><div style="outline: 0px; margin: 0px; padding: 0px; list-style: none; overflow-wrap: break-word; box-sizing: border-box; height: 22px;"><div style="outline: 0px; margin: 0px; padding: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; float: left; height: 22px; width: 24px; border-right: 1px solid rgb(197, 197, 197);"><div style="outline: 0px; margin: 0px; padding: 0px 8px 0px 0px; text-align: right; box-sizing: border-box; font-size: 14px; overflow-wrap: normal;"><span style="text-align: right; font-size: 14px; color: rgb(56, 58, 66); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">2</span></div></div><div style="outline: 0px; margin: 0px 0px 0px 8px; padding: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; float: left; height: 22px;"><div style="outline: 0px; margin: 0px; padding: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px;"><span style="font-size: 14px; color: rgb(56, 58, 66); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">:</span></div></div></div><div style="outline: 0px; margin: 0px; padding: 0px; list-style: none; overflow-wrap: break-word; box-sizing: border-box; height: 22px;"><div style="outline: 0px; margin: 0px; padding: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; float: left; height: 22px; width: 24px; border-right: 1px solid rgb(197, 197, 197);"><div style="outline: 0px; margin: 0px; padding: 0px 8px 0px 0px; text-align: right; box-sizing: border-box; font-size: 14px; overflow-wrap: normal;"><span style="text-align: right; font-size: 14px; color: rgb(56, 58, 66); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">3</span></div></div><div style="outline: 0px; margin: 0px 0px 0px 8px; padding: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; float: left; height: 22px;"><div style="outline: 0px; margin: 0px; padding: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px;"><span style="font-size: 14px; color: rgb(56, 58, 66); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">selectClause</span></div></div></div><div style="outline: 0px; margin: 0px; padding: 0px; list-style: none; overflow-wrap: break-word; box-sizing: border-box; height: 22px;"><div style="outline: 0px; margin: 0px; padding: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; float: left; height: 22px; width: 24px; border-right: 1px solid rgb(197, 197, 197);"><div style="outline: 0px; margin: 0px; padding: 0px 8px 0px 0px; text-align: right; box-sizing: border-box; font-size: 14px; overflow-wrap: normal;"><span style="text-align: right; font-size: 14px; color: rgb(56, 58, 66); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">4</span></div></div><div style="outline: 0px; margin: 0px 0px 0px 8px; padding: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; float: left; height: 22px;"><div style="outline: 0px; margin: 0px; padding: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px;"><span style="font-size: 14px; color: rgb(56, 58, 66); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">fromClause</span></div></div></div><div style="outline: 0px; margin: 0px; padding: 0px; list-style: none; overflow-wrap: break-word; box-sizing: border-box; height: 22px;"><div style="outline: 0px; margin: 0px; padding: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; float: left; height: 22px; width: 24px; border-right: 1px solid rgb(197, 197, 197);"><div style="outline: 0px; margin: 0px; padding: 0px 8px 0px 0px; text-align: right; box-sizing: border-box; font-size: 14px; overflow-wrap: normal;"><span style="text-align: right; font-size: 14px; color: rgb(56, 58, 66); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">5</span></div></div><div style="outline: 0px; margin: 0px 0px 0px 8px; padding: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; float: left; height: 22px;"><div style="outline: 0px; margin: 0px; padding: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px;"><span style="font-size: 14px; color: rgb(56, 58, 66); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">whereClause?</span></div></div></div><div style="outline: 0px; margin: 0px; padding: 0px; list-style: none; overflow-wrap: break-word; box-sizing: border-box; height: 22px;"><div style="outline: 0px; margin: 0px; padding: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; float: left; height: 22px; width: 24px; border-right: 1px solid rgb(197, 197, 197);"><div style="outline: 0px; margin: 0px; padding: 0px 8px 0px 0px; text-align: right; box-sizing: border-box; font-size: 14px; overflow-wrap: normal;"><span style="text-align: right; font-size: 14px; color: rgb(56, 58, 66); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">6</span></div></div><div style="outline: 0px; margin: 0px 0px 0px 8px; padding: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; float: left; height: 22px;"><div style="outline: 0px; margin: 0px; padding: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px;"><span style="font-size: 14px; color: rgb(56, 58, 66); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">groupByClause?</span></div></div></div><div style="outline: 0px; margin: 0px; padding: 0px; list-style: none; overflow-wrap: break-word; box-sizing: border-box; height: 22px;"><div style="outline: 0px; margin: 0px; padding: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; float: left; height: 22px; width: 24px; border-right: 1px solid rgb(197, 197, 197);"><div style="outline: 0px; margin: 0px; padding: 0px 8px 0px 0px; text-align: right; box-sizing: border-box; font-size: 14px; overflow-wrap: normal;"><span style="text-align: right; font-size: 14px; color: rgb(56, 58, 66); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">7</span></div></div><div style="outline: 0px; margin: 0px 0px 0px 8px; padding: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; float: left; height: 22px;"><div style="outline: 0px; margin: 0px; padding: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px;"><span style="font-size: 14px; color: rgb(56, 58, 66); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">havingClause?</span></div></div></div><div style="outline: 0px; margin: 0px; padding: 0px; list-style: none; overflow-wrap: break-word; box-sizing: border-box; height: 22px;"><div style="outline: 0px; margin: 0px; padding: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; float: left; height: 22px; width: 24px; border-right: 1px solid rgb(197, 197, 197);"><div style="outline: 0px; margin: 0px; padding: 0px 8px 0px 0px; text-align: right; box-sizing: border-box; font-size: 14px; overflow-wrap: normal;"><span style="text-align: right; font-size: 14px; color: rgb(56, 58, 66); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">8</span></div></div><div style="outline: 0px; margin: 0px 0px 0px 8px; padding: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; float: left; height: 22px;"><div style="outline: 0px; margin: 0px; padding: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px;"><span style="font-size: 14px; color: rgb(56, 58, 66); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">orderByClause?</span></div></div></div><div style="outline: 0px; margin: 0px; padding: 0px; list-style: none; overflow-wrap: break-word; box-sizing: border-box; height: 22px;"><div style="outline: 0px; margin: 0px; padding: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; float: left; height: 22px; width: 24px; border-right: 1px solid rgb(197, 197, 197);"><div style="outline: 0px; margin: 0px; padding: 0px 8px 0px 0px; text-align: right; box-sizing: border-box; font-size: 14px; overflow-wrap: normal;"><span style="text-align: right; font-size: 14px; color: rgb(56, 58, 66); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">9</span></div></div><div style="outline: 0px; margin: 0px 0px 0px 8px; padding: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; float: left; height: 22px;"><div style="outline: 0px; margin: 0px; padding: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px;"><span style="font-size: 14px; color: rgb(56, 58, 66); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">clusterByClause?</span></div></div></div><div style="outline: 0px; margin: 0px; padding: 0px; list-style: none; overflow-wrap: break-word; box-sizing: border-box; height: 22px;"><div style="outline: 0px; margin: 0px; padding: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; float: left; height: 22px; width: 24px; border-right: 1px solid rgb(197, 197, 197);"><div style="outline: 0px; margin: 0px; padding: 0px 8px 0px 0px; text-align: right; box-sizing: border-box; font-size: 14px; overflow-wrap: normal;"><span style="text-align: right; font-size: 14px; color: rgb(56, 58, 66); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">10</span></div></div><div style="outline: 0px; margin: 0px 0px 0px 8px; padding: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; float: left; height: 22px;"><div style="outline: 0px; margin: 0px; padding: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px;"><span style="font-size: 14px; color: rgb(56, 58, 66); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">distributeByClause?</span></div></div></div><div style="outline: 0px; margin: 0px; padding: 0px; list-style: none; overflow-wrap: break-word; box-sizing: border-box; height: 22px;"><div style="outline: 0px; margin: 0px; padding: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; float: left; height: 22px; width: 24px; border-right: 1px solid rgb(197, 197, 197);"><div style="outline: 0px; margin: 0px; padding: 0px 8px 0px 0px; text-align: right; box-sizing: border-box; font-size: 14px; overflow-wrap: normal;"><span style="text-align: right; font-size: 14px; color: rgb(56, 58, 66); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">11</span></div></div><div style="outline: 0px; margin: 0px 0px 0px 8px; padding: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; float: left; height: 22px;"><div style="outline: 0px; margin: 0px; padding: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px;"><span style="font-size: 14px; color: rgb(56, 58, 66); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">sortByClause?</span></div></div></div><div style="outline: 0px; margin: 0px; padding: 0px; list-style: none; overflow-wrap: break-word; box-sizing: border-box; height: 22px;"><div style="outline: 0px; margin: 0px; padding: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; float: left; height: 22px; width: 24px; border-right: 1px solid rgb(197, 197, 197);"><div style="outline: 0px; margin: 0px; padding: 0px 8px 0px 0px; text-align: right; box-sizing: border-box; font-size: 14px; overflow-wrap: normal;"><span style="text-align: right; font-size: 14px; color: rgb(56, 58, 66); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">12</span></div></div><div style="outline: 0px; margin: 0px 0px 0px 8px; padding: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; float: left; height: 22px;"><div style="outline: 0px; margin: 0px; padding: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px;"><span style="font-size: 14px; color: rgb(56, 58, 66); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">limitClause? -&gt; ^(TOK_QUERY fromClause ^(TOK_INSERT ^(TOK_DESTINATION ^(TOK_DIR TOK_TMP_FILE))</span></div></div></div><div style="outline: 0px; margin: 0px; padding: 0px; list-style: none; overflow-wrap: break-word; box-sizing: border-box; height: 22px;"><div style="outline: 0px; margin: 0px; padding: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; float: left; height: 22px; width: 24px; border-right: 1px solid rgb(197, 197, 197);"><div style="outline: 0px; margin: 0px; padding: 0px 8px 0px 0px; text-align: right; box-sizing: border-box; font-size: 14px; overflow-wrap: normal;"><span style="text-align: right; font-size: 14px; color: rgb(56, 58, 66); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">13</span></div></div><div style="outline: 0px; margin: 0px 0px 0px 8px; padding: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; float: left; height: 22px;"><div style="outline: 0px; margin: 0px; padding: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px;"><span style="font-size: 14px; color: rgb(56, 58, 66); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">selectClause whereClause? groupByClause? havingClause? orderByClause? clusterByClause?</span></div></div></div><div style="outline: 0px; margin: 0px; padding: 0px; list-style: none; overflow-wrap: break-word; box-sizing: border-box; height: 22px;"><div style="outline: 0px; margin: 0px; padding: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; float: left; height: 22px; width: 24px; border-right: 1px solid rgb(197, 197, 197);"><div style="outline: 0px; margin: 0px; padding: 0px 8px 0px 0px; text-align: right; box-sizing: border-box; font-size: 14px; overflow-wrap: normal;"><span style="text-align: right; font-size: 14px; color: rgb(56, 58, 66); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">14</span></div></div><div style="outline: 0px; margin: 0px 0px 0px 8px; padding: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; float: left; height: 22px;"><div style="outline: 0px; margin: 0px; padding: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px;"><span style="font-size: 14px; color: rgb(56, 58, 66); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">distributeByClause? sortByClause? limitClause?))</span></div></div></div><div style="outline: 0px; margin: 0px; padding: 0px; list-style: none; overflow-wrap: break-word; box-sizing: border-box; height: 22px;"><div style="outline: 0px; margin: 0px; padding: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; float: left; height: 22px; width: 24px; border-right: 1px solid rgb(197, 197, 197);"><div style="outline: 0px; margin: 0px; padding: 0px 8px 0px 0px; text-align: right; box-sizing: border-box; font-size: 14px; overflow-wrap: normal;"><span style="text-align: right; font-size: 14px; color: rgb(56, 58, 66); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">15</span></div></div><div style="outline: 0px; margin: 0px 0px 0px 8px; padding: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; float: left; height: 22px;"><div style="outline: 0px; margin: 0px; padding: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px;"><span style="font-size: 14px; color: rgb(56, 58, 66); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">;</span></div></div></div></div></div><div style="outline: 0px; padding: 0px; overflow-wrap: break-word; margin: 0px 0px 16px; box-sizing: border-box; font-size: 16px;"><span style="font-size: 16px; color: rgb(77, 77, 77); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: 400; line-height: 26px;">为了详细说明SQL翻译为MapReduce的过程，这里以一条简单的SQL为例，SQL中包含一个子查询，最终将数据写入到一张表中。</span></div><div style="outline: 0px; position: relative; box-sizing: border-box; white-space: pre-wrap; overflow-x: auto; margin: 0px 0px 24px; padding: 8px; overflow-wrap: break-word; font-size: 14px;"><div style="outline: 0px; box-sizing: border-box; white-space: pre; tab-size: 4; background: rgb(250, 250, 250); overflow-wrap: normal; border-radius: 4px; overflow-x: auto; padding: 0.5em; font-size: 14px;"><div style="outline: 0px; margin: 0px; padding: 0px; list-style: none; overflow-wrap: break-word; box-sizing: border-box; height: 22px;"><div style="outline: 0px; margin: 0px; padding: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; float: left; height: 22px; width: 24px; border-right: 1px solid rgb(197, 197, 197);"><div style="outline: 0px; margin: 0px; padding: 0px 8px 0px 0px; text-align: right; box-sizing: border-box; font-size: 14px; overflow-wrap: normal;"><span style="text-align: right; font-size: 14px; color: rgb(56, 58, 66); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">1</span></div></div><div style="outline: 0px; margin: 0px 0px 0px 8px; padding: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; float: left; height: 22px;"><div style="outline: 0px; margin: 0px; padding: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px;"><span style="font-size: 14px; color: rgb(56, 58, 66); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">FROM</span></div></div></div><div style="outline: 0px; margin: 0px; padding: 0px; list-style: none; overflow-wrap: break-word; box-sizing: border-box; height: 22px;"><div style="outline: 0px; margin: 0px; padding: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; float: left; height: 22px; width: 24px; border-right: 1px solid rgb(197, 197, 197);"><div style="outline: 0px; margin: 0px; padding: 0px 8px 0px 0px; text-align: right; box-sizing: border-box; font-size: 14px; overflow-wrap: normal;"><span style="text-align: right; font-size: 14px; color: rgb(56, 58, 66); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">2</span></div></div><div style="outline: 0px; margin: 0px 0px 0px 8px; padding: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; float: left; height: 22px;"><div style="outline: 0px; margin: 0px; padding: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px;"><span style="font-size: 14px; color: rgb(56, 58, 66); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">(</span></div></div></div><div style="outline: 0px; margin: 0px; padding: 0px; list-style: none; overflow-wrap: break-word; box-sizing: border-box; height: 22px;"><div style="outline: 0px; margin: 0px; padding: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; float: left; height: 22px; width: 24px; border-right: 1px solid rgb(197, 197, 197);"><div style="outline: 0px; margin: 0px; padding: 0px 8px 0px 0px; text-align: right; box-sizing: border-box; font-size: 14px; overflow-wrap: normal;"><span style="text-align: right; font-size: 14px; color: rgb(56, 58, 66); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">3</span></div></div><div style="outline: 0px; margin: 0px 0px 0px 8px; padding: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; float: left; height: 22px;"><div style="outline: 0px; margin: 0px; padding: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px;"><span style="margin: 0px; padding: 0px; outline: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; color: rgb(166, 38, 164); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">SELECT</span></div></div></div><div style="outline: 0px; margin: 0px; padding: 0px; list-style: none; overflow-wrap: break-word; box-sizing: border-box; height: 22px;"><div style="outline: 0px; margin: 0px; padding: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; float: left; height: 22px; width: 24px; border-right: 1px solid rgb(197, 197, 197);"><div style="outline: 0px; margin: 0px; padding: 0px 8px 0px 0px; text-align: right; box-sizing: border-box; font-size: 14px; overflow-wrap: normal;"><span style="text-align: right; font-size: 14px; color: rgb(56, 58, 66); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">4</span></div></div><div style="outline: 0px; margin: 0px 0px 0px 8px; padding: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; float: left; height: 22px;"><div style="outline: 0px; margin: 0px; padding: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px;"><span style="font-size: 14px; color: rgb(56, 58, 66); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">p.datekey datekey,</span></div></div></div><div style="outline: 0px; margin: 0px; padding: 0px; list-style: none; overflow-wrap: break-word; box-sizing: border-box; height: 22px;"><div style="outline: 0px; margin: 0px; padding: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; float: left; height: 22px; width: 24px; border-right: 1px solid rgb(197, 197, 197);"><div style="outline: 0px; margin: 0px; padding: 0px 8px 0px 0px; text-align: right; box-sizing: border-box; font-size: 14px; overflow-wrap: normal;"><span style="text-align: right; font-size: 14px; color: rgb(56, 58, 66); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">5</span></div></div><div style="outline: 0px; margin: 0px 0px 0px 8px; padding: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; float: left; height: 22px;"><div style="outline: 0px; margin: 0px; padding: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px;"><span style="font-size: 14px; color: rgb(56, 58, 66); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">p.userid userid,</span></div></div></div><div style="outline: 0px; margin: 0px; padding: 0px; list-style: none; overflow-wrap: break-word; box-sizing: border-box; height: 22px;"><div style="outline: 0px; margin: 0px; padding: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; float: left; height: 22px; width: 24px; border-right: 1px solid rgb(197, 197, 197);"><div style="outline: 0px; margin: 0px; padding: 0px 8px 0px 0px; text-align: right; box-sizing: border-box; font-size: 14px; overflow-wrap: normal;"><span style="text-align: right; font-size: 14px; color: rgb(56, 58, 66); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">6</span></div></div><div style="outline: 0px; margin: 0px 0px 0px 8px; padding: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; float: left; height: 22px;"><div style="outline: 0px; margin: 0px; padding: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px;"><span style="font-size: 14px; color: rgb(56, 58, 66); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">c.clienttype</span></div></div></div><div style="outline: 0px; margin: 0px; padding: 0px; list-style: none; overflow-wrap: break-word; box-sizing: border-box; height: 22px;"><div style="outline: 0px; margin: 0px; padding: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; float: left; height: 22px; width: 24px; border-right: 1px solid rgb(197, 197, 197);"><div style="outline: 0px; margin: 0px; padding: 0px 8px 0px 0px; text-align: right; box-sizing: border-box; font-size: 14px; overflow-wrap: normal;"><span style="text-align: right; font-size: 14px; color: rgb(56, 58, 66); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">7</span></div></div><div style="outline: 0px; margin: 0px 0px 0px 8px; padding: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; float: left; height: 22px;"><div style="outline: 0px; margin: 0px; padding: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px;"><span style="margin: 0px; padding: 0px; outline: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; color: rgb(166, 38, 164); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">FROM</span></div></div></div><div style="outline: 0px; margin: 0px; padding: 0px; list-style: none; overflow-wrap: break-word; box-sizing: border-box; height: 22px;"><div style="outline: 0px; margin: 0px; padding: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; float: left; height: 22px; width: 24px; border-right: 1px solid rgb(197, 197, 197);"><div style="outline: 0px; margin: 0px; padding: 0px 8px 0px 0px; text-align: right; box-sizing: border-box; font-size: 14px; overflow-wrap: normal;"><span style="text-align: right; font-size: 14px; color: rgb(56, 58, 66); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">8</span></div></div><div style="outline: 0px; margin: 0px 0px 0px 8px; padding: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; float: left; height: 22px;"><div style="outline: 0px; margin: 0px; padding: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px;"><span style="font-size: 14px; color: rgb(56, 58, 66); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">detail.usersequence_client c</span></div></div></div><div style="outline: 0px; margin: 0px; padding: 0px; list-style: none; overflow-wrap: break-word; box-sizing: border-box; height: 22px;"><div style="outline: 0px; margin: 0px; padding: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; float: left; height: 22px; width: 24px; border-right: 1px solid rgb(197, 197, 197);"><div style="outline: 0px; margin: 0px; padding: 0px 8px 0px 0px; text-align: right; box-sizing: border-box; font-size: 14px; overflow-wrap: normal;"><span style="text-align: right; font-size: 14px; color: rgb(56, 58, 66); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">9</span></div></div><div style="outline: 0px; margin: 0px 0px 0px 8px; padding: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; float: left; height: 22px;"><div style="outline: 0px; margin: 0px; padding: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px;"><span style="margin: 0px; padding: 0px; outline: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; color: rgb(166, 38, 164); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">JOIN</span> <span style="font-size: 14px; color: rgb(56, 58, 66); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">fact.orderpayment p</span> <span style="margin: 0px; padding: 0px; outline: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; color: rgb(166, 38, 164); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">ON</span> <span style="font-size: 14px; color: rgb(56, 58, 66); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">p.orderid = c.orderid</span></div></div></div><div style="outline: 0px; margin: 0px; padding: 0px; list-style: none; overflow-wrap: break-word; box-sizing: border-box; height: 22px;"><div style="outline: 0px; margin: 0px; padding: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; float: left; height: 22px; width: 24px; border-right: 1px solid rgb(197, 197, 197);"><div style="outline: 0px; margin: 0px; padding: 0px 8px 0px 0px; text-align: right; box-sizing: border-box; font-size: 14px; overflow-wrap: normal;"><span style="text-align: right; font-size: 14px; color: rgb(56, 58, 66); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">10</span></div></div><div style="outline: 0px; margin: 0px 0px 0px 8px; padding: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; float: left; height: 22px;"><div style="outline: 0px; margin: 0px; padding: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px;"><span style="margin: 0px; padding: 0px; outline: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; color: rgb(166, 38, 164); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">JOIN</span> <span style="font-size: 14px; color: rgb(56, 58, 66); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">default.user du</span> <span style="margin: 0px; padding: 0px; outline: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; color: rgb(166, 38, 164); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">ON</span> <span style="font-size: 14px; color: rgb(56, 58, 66); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">du.userid = p.userid</span></div></div></div><div style="outline: 0px; margin: 0px; padding: 0px; list-style: none; overflow-wrap: break-word; box-sizing: border-box; height: 22px;"><div style="outline: 0px; margin: 0px; padding: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; float: left; height: 22px; width: 24px; border-right: 1px solid rgb(197, 197, 197);"><div style="outline: 0px; margin: 0px; padding: 0px 8px 0px 0px; text-align: right; box-sizing: border-box; font-size: 14px; overflow-wrap: normal;"><span style="text-align: right; font-size: 14px; color: rgb(56, 58, 66); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">11</span></div></div><div style="outline: 0px; margin: 0px 0px 0px 8px; padding: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; float: left; height: 22px;"><div style="outline: 0px; margin: 0px; padding: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px;"><span style="margin: 0px; padding: 0px; outline: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; color: rgb(166, 38, 164); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">WHERE</span> <span style="font-size: 14px; color: rgb(56, 58, 66); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">p.datekey =</span> <span style="margin: 0px; padding: 0px; outline: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; color: rgb(152, 104, 1); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">20131118</span></div></div></div><div style="outline: 0px; margin: 0px; padding: 0px; list-style: none; overflow-wrap: break-word; box-sizing: border-box; height: 22px;"><div style="outline: 0px; margin: 0px; padding: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; float: left; height: 22px; width: 24px; border-right: 1px solid rgb(197, 197, 197);"><div style="outline: 0px; margin: 0px; padding: 0px 8px 0px 0px; text-align: right; box-sizing: border-box; font-size: 14px; overflow-wrap: normal;"><span style="text-align: right; font-size: 14px; color: rgb(56, 58, 66); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">12</span></div></div><div style="outline: 0px; margin: 0px 0px 0px 8px; padding: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; float: left; height: 22px;"><div style="outline: 0px; margin: 0px; padding: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px;"><span style="font-size: 14px; color: rgb(56, 58, 66); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">) base</span></div></div></div><div style="outline: 0px; margin: 0px; padding: 0px; list-style: none; overflow-wrap: break-word; box-sizing: border-box; height: 22px;"><div style="outline: 0px; margin: 0px; padding: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; float: left; height: 22px; width: 24px; border-right: 1px solid rgb(197, 197, 197);"><div style="outline: 0px; margin: 0px; padding: 0px 8px 0px 0px; text-align: right; box-sizing: border-box; font-size: 14px; overflow-wrap: normal;"><span style="text-align: right; font-size: 14px; color: rgb(56, 58, 66); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">13</span></div></div><div style="outline: 0px; margin: 0px 0px 0px 8px; padding: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; float: left; height: 22px;"><div style="outline: 0px; margin: 0px; padding: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px;"><span style="margin: 0px; padding: 0px; outline: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; color: rgb(166, 38, 164); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">INSERT</span> <span style="font-size: 14px; color: rgb(56, 58, 66); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">OVERWRITE</span> <span style="margin: 0px; padding: 0px; outline: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; color: rgb(166, 38, 164); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">TABLE</span> <span style="margin: 0px; padding: 0px; outline: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; color: rgb(80, 161, 79); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">`test`</span><span style="font-size: 14px; color: rgb(56, 58, 66); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">.</span><span style="margin: 0px; padding: 0px; outline: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; color: rgb(80, 161, 79); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">`customer_kpi`</span></div></div></div><div style="outline: 0px; margin: 0px; padding: 0px; list-style: none; overflow-wrap: break-word; box-sizing: border-box; height: 22px;"><div style="outline: 0px; margin: 0px; padding: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; float: left; height: 22px; width: 24px; border-right: 1px solid rgb(197, 197, 197);"><div style="outline: 0px; margin: 0px; padding: 0px 8px 0px 0px; text-align: right; box-sizing: border-box; font-size: 14px; overflow-wrap: normal;"><span style="text-align: right; font-size: 14px; color: rgb(56, 58, 66); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">14</span></div></div><div style="outline: 0px; margin: 0px 0px 0px 8px; padding: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; float: left; height: 22px;"><div style="outline: 0px; margin: 0px; padding: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px;"><span style="margin: 0px; padding: 0px; outline: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; color: rgb(166, 38, 164); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">SELECT</span></div></div></div><div style="outline: 0px; margin: 0px; padding: 0px; list-style: none; overflow-wrap: break-word; box-sizing: border-box; height: 22px;"><div style="outline: 0px; margin: 0px; padding: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; float: left; height: 22px; width: 24px; border-right: 1px solid rgb(197, 197, 197);"><div style="outline: 0px; margin: 0px; padding: 0px 8px 0px 0px; text-align: right; box-sizing: border-box; font-size: 14px; overflow-wrap: normal;"><span style="text-align: right; font-size: 14px; color: rgb(56, 58, 66); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">15</span></div></div><div style="outline: 0px; margin: 0px 0px 0px 8px; padding: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; float: left; height: 22px;"><div style="outline: 0px; margin: 0px; padding: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px;"><span style="font-size: 14px; color: rgb(56, 58, 66); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">base.datekey,</span></div></div></div><div style="outline: 0px; margin: 0px; padding: 0px; list-style: none; overflow-wrap: break-word; box-sizing: border-box; height: 22px;"><div style="outline: 0px; margin: 0px; padding: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; float: left; height: 22px; width: 24px; border-right: 1px solid rgb(197, 197, 197);"><div style="outline: 0px; margin: 0px; padding: 0px 8px 0px 0px; text-align: right; box-sizing: border-box; font-size: 14px; overflow-wrap: normal;"><span style="text-align: right; font-size: 14px; color: rgb(56, 58, 66); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">16</span></div></div><div style="outline: 0px; margin: 0px 0px 0px 8px; padding: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; float: left; height: 22px;"><div style="outline: 0px; margin: 0px; padding: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px;"><span style="font-size: 14px; color: rgb(56, 58, 66); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">base.clienttype,</span></div></div></div><div style="outline: 0px; margin: 0px; padding: 0px; list-style: none; overflow-wrap: break-word; box-sizing: border-box; height: 22px;"><div style="outline: 0px; margin: 0px; padding: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; float: left; height: 22px; width: 24px; border-right: 1px solid rgb(197, 197, 197);"><div style="outline: 0px; margin: 0px; padding: 0px 8px 0px 0px; text-align: right; box-sizing: border-box; font-size: 14px; overflow-wrap: normal;"><span style="text-align: right; font-size: 14px; color: rgb(56, 58, 66); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">17</span></div></div><div style="outline: 0px; margin: 0px 0px 0px 8px; padding: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; float: left; height: 22px;"><div style="outline: 0px; margin: 0px; padding: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px;"><span style="margin: 0px; padding: 0px; outline: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; color: rgb(166, 38, 164); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">count</span><span style="font-size: 14px; color: rgb(56, 58, 66); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">(</span><span style="margin: 0px; padding: 0px; outline: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; color: rgb(166, 38, 164); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">distinct</span> <span style="font-size: 14px; color: rgb(56, 58, 66); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">base.userid) buyer_count</span></div></div></div><div style="outline: 0px; margin: 0px; padding: 0px; list-style: none; overflow-wrap: break-word; box-sizing: border-box; height: 22px;"><div style="outline: 0px; margin: 0px; padding: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; float: left; height: 22px; width: 24px; border-right: 1px solid rgb(197, 197, 197);"><div style="outline: 0px; margin: 0px; padding: 0px 8px 0px 0px; text-align: right; box-sizing: border-box; font-size: 14px; overflow-wrap: normal;"><span style="text-align: right; font-size: 14px; color: rgb(56, 58, 66); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">18</span></div></div><div style="outline: 0px; margin: 0px 0px 0px 8px; padding: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; float: left; height: 22px;"><div style="outline: 0px; margin: 0px; padding: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px;"><span style="margin: 0px; padding: 0px; outline: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; color: rgb(166, 38, 164); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">GROUP</span> <span style="margin: 0px; padding: 0px; outline: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; color: rgb(166, 38, 164); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">BY</span> <span style="font-size: 14px; color: rgb(56, 58, 66); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">base.datekey, base.clienttype</span></div></div></div></div></div><div style="outline: 0px; padding: 0px; overflow-wrap: break-word; margin: 0px 0px 16px; box-sizing: border-box; font-size: 16px;"><span style="font-size: 16px; color: rgb(77, 77, 77); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: 700; line-height: 26px; outline: 0px; overflow-wrap: break-word; box-sizing: border-box;">SQL生成AST Tree（重点）</span></div><div style="outline: 0px; padding: 0px; overflow-wrap: break-word; margin: 0px 0px 16px; box-sizing: border-box; font-size: 16px;"><span style="font-size: 16px; color: rgb(77, 77, 77); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: 400; line-height: 26px;">Antlr对Hive SQL解析的代码如下，HiveLexerX，HiveParser分别是Antlr对语法文件Hive.g编译后自动生成的词法解析和语法解析类，在这两个类中进行复杂的解析。</span></div><div style="outline: 0px; position: relative; box-sizing: border-box; white-space: pre-wrap; overflow-x: auto; margin: 0px 0px 24px; padding: 8px; overflow-wrap: break-word; font-size: 14px;"><div style="outline: 0px; box-sizing: border-box; white-space: pre; tab-size: 4; background: rgb(250, 250, 250); overflow-wrap: normal; border-radius: 4px; overflow-x: auto; padding: 0.5em; font-size: 14px;"><div style="outline: 0px; margin: 0px; padding: 0px; list-style: none; overflow-wrap: break-word; box-sizing: border-box; height: 22px;"><div style="outline: 0px; margin: 0px; padding: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; float: left; height: 22px; width: 24px; border-right: 1px solid rgb(197, 197, 197);"><div style="outline: 0px; margin: 0px; padding: 0px 8px 0px 0px; text-align: right; box-sizing: border-box; font-size: 14px; overflow-wrap: normal;"><span style="text-align: right; font-size: 14px; color: rgb(56, 58, 66); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">1</span></div></div><div style="outline: 0px; margin: 0px 0px 0px 8px; padding: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; float: left; height: 22px;"><div style="outline: 0px; margin: 0px; padding: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px;"><span style="margin: 0px; padding: 0px; outline: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; color: rgb(160, 161, 167); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px; font-style: italic;">// command 为hiveQL</span></div></div></div><div style="outline: 0px; margin: 0px; padding: 0px; list-style: none; overflow-wrap: break-word; box-sizing: border-box; height: 22px;"><div style="outline: 0px; margin: 0px; padding: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; float: left; height: 22px; width: 24px; border-right: 1px solid rgb(197, 197, 197);"><div style="outline: 0px; margin: 0px; padding: 0px 8px 0px 0px; text-align: right; box-sizing: border-box; font-size: 14px; overflow-wrap: normal;"><span style="text-align: right; font-size: 14px; color: rgb(56, 58, 66); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">2</span></div></div><div style="outline: 0px; margin: 0px 0px 0px 8px; padding: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; float: left; height: 22px;"><div style="outline: 0px; margin: 0px; padding: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px;"><span style="font-size: 14px; color: rgb(56, 58, 66); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">HiveLexerX lexer =</span> <span style="margin: 0px; padding: 0px; outline: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; color: rgb(166, 38, 164); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">new</span> <span style="font-size: 14px; color: rgb(56, 58, 66); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">HiveLexerX(</span><span style="margin: 0px; padding: 0px; outline: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; color: rgb(166, 38, 164); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">new</span> <span style="font-size: 14px; color: rgb(56, 58, 66); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">ANTLRNoCaseStringStream(command));</span> <span style="margin: 0px; padding: 0px; outline: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; color: rgb(160, 161, 167); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px; font-style: italic;">//词法解析，忽略关键词的大小写</span></div></div></div><div style="outline: 0px; margin: 0px; padding: 0px; list-style: none; overflow-wrap: break-word; box-sizing: border-box; height: 22px;"><div style="outline: 0px; margin: 0px; padding: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; float: left; height: 22px; width: 24px; border-right: 1px solid rgb(197, 197, 197);"><div style="outline: 0px; margin: 0px; padding: 0px 8px 0px 0px; text-align: right; box-sizing: border-box; font-size: 14px; overflow-wrap: normal;"><span style="text-align: right; font-size: 14px; color: rgb(56, 58, 66); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">3</span></div></div><div style="outline: 0px; margin: 0px 0px 0px 8px; padding: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; float: left; height: 22px;"><div style="outline: 0px; margin: 0px; padding: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px;"><span style="font-size: 14px; color: rgb(56, 58, 66); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">TokenRewriteStream tokens =</span> <span style="margin: 0px; padding: 0px; outline: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; color: rgb(166, 38, 164); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">new</span> <span style="font-size: 14px; color: rgb(56, 58, 66); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">TokenRewriteStream(lexer);</span></div></div></div><div style="outline: 0px; margin: 0px; padding: 0px; list-style: none; overflow-wrap: break-word; box-sizing: border-box; height: 22px;"><div style="outline: 0px; margin: 0px; padding: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; float: left; height: 22px; width: 24px; border-right: 1px solid rgb(197, 197, 197);"><div style="outline: 0px; margin: 0px; padding: 0px 8px 0px 0px; text-align: right; box-sizing: border-box; font-size: 14px; overflow-wrap: normal;"><span style="text-align: right; font-size: 14px; color: rgb(56, 58, 66); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">4</span></div></div><div style="outline: 0px; margin: 0px 0px 0px 8px; padding: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; float: left; height: 22px;"><div style="outline: 0px; margin: 0px; padding: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px;"><span style="margin: 0px; padding: 0px; outline: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; color: rgb(166, 38, 164); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">if</span> <span style="font-size: 14px; color: rgb(56, 58, 66); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">(ctx !=</span> <span style="margin: 0px; padding: 0px; outline: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; color: rgb(166, 38, 164); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">null</span><span style="font-size: 14px; color: rgb(56, 58, 66); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">) {</span></div></div></div><div style="outline: 0px; margin: 0px; padding: 0px; list-style: none; overflow-wrap: break-word; box-sizing: border-box; height: 22px;"><div style="outline: 0px; margin: 0px; padding: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; float: left; height: 22px; width: 24px; border-right: 1px solid rgb(197, 197, 197);"><div style="outline: 0px; margin: 0px; padding: 0px 8px 0px 0px; text-align: right; box-sizing: border-box; font-size: 14px; overflow-wrap: normal;"><span style="text-align: right; font-size: 14px; color: rgb(56, 58, 66); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">5</span></div></div><div style="outline: 0px; margin: 0px 0px 0px 8px; padding: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; float: left; height: 22px;"><div style="outline: 0px; margin: 0px; padding: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px;"><span style="font-size: 14px; color: rgb(56, 58, 66); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">ctx.setTokenRewriteStream(tokens);</span></div></div></div><div style="outline: 0px; margin: 0px; padding: 0px; list-style: none; overflow-wrap: break-word; box-sizing: border-box; height: 22px;"><div style="outline: 0px; margin: 0px; padding: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; float: left; height: 22px; width: 24px; border-right: 1px solid rgb(197, 197, 197);"><div style="outline: 0px; margin: 0px; padding: 0px 8px 0px 0px; text-align: right; box-sizing: border-box; font-size: 14px; overflow-wrap: normal;"><span style="text-align: right; font-size: 14px; color: rgb(56, 58, 66); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">6</span></div></div><div style="outline: 0px; margin: 0px 0px 0px 8px; padding: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; float: left; height: 22px;"><div style="outline: 0px; margin: 0px; padding: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px;"><span style="font-size: 14px; color: rgb(56, 58, 66); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">}</span></div></div></div><div style="outline: 0px; margin: 0px; padding: 0px; list-style: none; overflow-wrap: break-word; box-sizing: border-box; height: 22px;"><div style="outline: 0px; margin: 0px; padding: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; float: left; height: 22px; width: 24px; border-right: 1px solid rgb(197, 197, 197);"><div style="outline: 0px; margin: 0px; padding: 0px 8px 0px 0px; text-align: right; box-sizing: border-box; font-size: 14px; overflow-wrap: normal;"><span style="text-align: right; font-size: 14px; color: rgb(56, 58, 66); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">7</span></div></div><div style="outline: 0px; margin: 0px 0px 0px 8px; padding: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; float: left; height: 22px;"><div style="outline: 0px; margin: 0px; padding: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px;"><span style="font-size: 14px; color: rgb(56, 58, 66); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">HiveParser parser =</span> <span style="margin: 0px; padding: 0px; outline: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; color: rgb(166, 38, 164); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">new</span> <span style="font-size: 14px; color: rgb(56, 58, 66); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">HiveParser(tokens);</span> <span style="margin: 0px; padding: 0px; outline: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; color: rgb(160, 161, 167); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px; font-style: italic;">//语法解析</span></div></div></div><div style="outline: 0px; margin: 0px; padding: 0px; list-style: none; overflow-wrap: break-word; box-sizing: border-box; height: 22px;"><div style="outline: 0px; margin: 0px; padding: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; float: left; height: 22px; width: 24px; border-right: 1px solid rgb(197, 197, 197);"><div style="outline: 0px; margin: 0px; padding: 0px 8px 0px 0px; text-align: right; box-sizing: border-box; font-size: 14px; overflow-wrap: normal;"><span style="text-align: right; font-size: 14px; color: rgb(56, 58, 66); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">8</span></div></div><div style="outline: 0px; margin: 0px 0px 0px 8px; padding: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; float: left; height: 22px;"><div style="outline: 0px; margin: 0px; padding: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px;"><span style="font-size: 14px; color: rgb(56, 58, 66); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">parser.setTreeAdaptor(adaptor);</span></div></div></div><div style="outline: 0px; margin: 0px; padding: 0px; list-style: none; overflow-wrap: break-word; box-sizing: border-box; height: 22px;"><div style="outline: 0px; margin: 0px; padding: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; float: left; height: 22px; width: 24px; border-right: 1px solid rgb(197, 197, 197);"><div style="outline: 0px; margin: 0px; padding: 0px 8px 0px 0px; text-align: right; box-sizing: border-box; font-size: 14px; overflow-wrap: normal;"><span style="text-align: right; font-size: 14px; color: rgb(56, 58, 66); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">9</span></div></div><div style="outline: 0px; margin: 0px 0px 0px 8px; padding: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; float: left; height: 22px;"><div style="outline: 0px; margin: 0px; padding: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px;"><span style="font-size: 14px; color: rgb(56, 58, 66); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">HiveParser.statement_return r =</span> <span style="margin: 0px; padding: 0px; outline: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; color: rgb(166, 38, 164); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">null</span><span style="font-size: 14px; color: rgb(56, 58, 66); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">;</span></div></div></div><div style="outline: 0px; margin: 0px; padding: 0px; list-style: none; overflow-wrap: break-word; box-sizing: border-box; height: 22px;"><div style="outline: 0px; margin: 0px; padding: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; float: left; height: 22px; width: 24px; border-right: 1px solid rgb(197, 197, 197);"><div style="outline: 0px; margin: 0px; padding: 0px 8px 0px 0px; text-align: right; box-sizing: border-box; font-size: 14px; overflow-wrap: normal;"><span style="text-align: right; font-size: 14px; color: rgb(56, 58, 66); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">10</span></div></div><div style="outline: 0px; margin: 0px 0px 0px 8px; padding: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; float: left; height: 22px;"><div style="outline: 0px; margin: 0px; padding: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px;"><span style="margin: 0px; padding: 0px; outline: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; color: rgb(166, 38, 164); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">try</span> <span style="font-size: 14px; color: rgb(56, 58, 66); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">{</span></div></div></div><div style="outline: 0px; margin: 0px; padding: 0px; list-style: none; overflow-wrap: break-word; box-sizing: border-box; height: 22px;"><div style="outline: 0px; margin: 0px; padding: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; float: left; height: 22px; width: 24px; border-right: 1px solid rgb(197, 197, 197);"><div style="outline: 0px; margin: 0px; padding: 0px 8px 0px 0px; text-align: right; box-sizing: border-box; font-size: 14px; overflow-wrap: normal;"><span style="text-align: right; font-size: 14px; color: rgb(56, 58, 66); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">11</span></div></div><div style="outline: 0px; margin: 0px 0px 0px 8px; padding: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; float: left; height: 22px;"><div style="outline: 0px; margin: 0px; padding: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px;"><span style="font-size: 14px; color: rgb(56, 58, 66); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">r = parser.statement();</span> <span style="margin: 0px; padding: 0px; outline: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; color: rgb(160, 161, 167); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px; font-style: italic;">//转化为AST Tree</span></div></div></div><div style="outline: 0px; margin: 0px; padding: 0px; list-style: none; overflow-wrap: break-word; box-sizing: border-box; height: 22px;"><div style="outline: 0px; margin: 0px; padding: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; float: left; height: 22px; width: 24px; border-right: 1px solid rgb(197, 197, 197);"><div style="outline: 0px; margin: 0px; padding: 0px 8px 0px 0px; text-align: right; box-sizing: border-box; font-size: 14px; overflow-wrap: normal;"><span style="text-align: right; font-size: 14px; color: rgb(56, 58, 66); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">12</span></div></div><div style="outline: 0px; margin: 0px 0px 0px 8px; padding: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; float: left; height: 22px;"><div style="outline: 0px; margin: 0px; padding: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px;"><span style="font-size: 14px; color: rgb(56, 58, 66); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">}</span> <span style="margin: 0px; padding: 0px; outline: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; color: rgb(166, 38, 164); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">catch</span> <span style="font-size: 14px; color: rgb(56, 58, 66); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">(RecognitionException e) {</span></div></div></div><div style="outline: 0px; margin: 0px; padding: 0px; list-style: none; overflow-wrap: break-word; box-sizing: border-box; height: 22px;"><div style="outline: 0px; margin: 0px; padding: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; float: left; height: 22px; width: 24px; border-right: 1px solid rgb(197, 197, 197);"><div style="outline: 0px; margin: 0px; padding: 0px 8px 0px 0px; text-align: right; box-sizing: border-box; font-size: 14px; overflow-wrap: normal;"><span style="text-align: right; font-size: 14px; color: rgb(56, 58, 66); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">13</span></div></div><div style="outline: 0px; margin: 0px 0px 0px 8px; padding: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; float: left; height: 22px;"><div style="outline: 0px; margin: 0px; padding: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px;"><span style="font-size: 14px; color: rgb(56, 58, 66); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">e.printStackTrace();</span></div></div></div><div style="outline: 0px; margin: 0px; padding: 0px; list-style: none; overflow-wrap: break-word; box-sizing: border-box; height: 22px;"><div style="outline: 0px; margin: 0px; padding: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; float: left; height: 22px; width: 24px; border-right: 1px solid rgb(197, 197, 197);"><div style="outline: 0px; margin: 0px; padding: 0px 8px 0px 0px; text-align: right; box-sizing: border-box; font-size: 14px; overflow-wrap: normal;"><span style="text-align: right; font-size: 14px; color: rgb(56, 58, 66); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">14</span></div></div><div style="outline: 0px; margin: 0px 0px 0px 8px; padding: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; float: left; height: 22px;"><div style="outline: 0px; margin: 0px; padding: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px;"><span style="margin: 0px; padding: 0px; outline: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; color: rgb(166, 38, 164); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">throw</span> <span style="margin: 0px; padding: 0px; outline: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; color: rgb(166, 38, 164); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">new</span> <span style="font-size: 14px; color: rgb(56, 58, 66); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">ParseException(parser.errors);</span></div></div></div><div style="outline: 0px; margin: 0px; padding: 0px; list-style: none; overflow-wrap: break-word; box-sizing: border-box; height: 22px;"><div style="outline: 0px; margin: 0px; padding: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; float: left; height: 22px; width: 24px; border-right: 1px solid rgb(197, 197, 197);"><div style="outline: 0px; margin: 0px; padding: 0px 8px 0px 0px; text-align: right; box-sizing: border-box; font-size: 14px; overflow-wrap: normal;"><span style="text-align: right; font-size: 14px; color: rgb(56, 58, 66); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">15</span></div></div><div style="outline: 0px; margin: 0px 0px 0px 8px; padding: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; float: left; height: 22px;"><div style="outline: 0px; margin: 0px; padding: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px;"><span style="font-size: 14px; color: rgb(56, 58, 66); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-weight: normal; line-height: 22px;">}</span></div></div></div></div></div><div style="outline: 0px; padding: 0px; overflow-wrap: break-word; margin: 0px 0px 16px; box-sizing: border-box; font-size: 16px;"><div><span style="font-size: 16px; color: rgb(77, 77, 77); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: 400; line-height: 26px;">最终生成的AST Tree如下图右侧（使用Antlr Works生成，Antlr Works是Antlr提供的编写语法文件的编辑器），图中只是展开了骨架的几个节点，没有完全展开。</span></div><div><span style="font-size: 16px; color: rgb(77, 77, 77); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: 400; line-height: 26px;">子查询1/2，分别对应右侧第1/2两个部分。</span></div></div><div style="outline: 0px; padding: 0px; overflow-wrap: break-word; margin: 0px 0px 16px; box-sizing: border-box; font-size: 16px; text-align: center;"><span style="font-size: 16px; color: rgb(77, 77, 77); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: 400; line-height: 26px;"><a href="Hive SQL转化为MapReduce执行计划深度解析_files/mapjoin.png"><img src="Hive SQL转化为MapReduce执行计划深度解析_files/ad092e0acd3437eb6982f1bae7811d15.png" alt="mapjoin.png"></a></span></div><div style="outline: 0px; padding: 0px; overflow-wrap: break-word; margin: 0px 0px 16px; box-sizing: border-box; font-size: 16px;"><span style="font-size: 16px; color: rgb(77, 77, 77); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: 400; line-height: 26px;">这里注意一下内层子查询也会生成一个TOK_DESTINATION节点。请看上面SelectStatement的语法规则，这个节点是在语法改写中特意增加了的一个节点。原因是Hive中所有查询的数据均会保存在HDFS临时的文件中，无论是中间的子查询还是查询最终的结果，Insert语句最终会将数据写入表所在的HDFS目录下。</span></div><div style="outline: 0px; padding: 0px; overflow-wrap: break-word; margin: 0px 0px 16px; box-sizing: border-box; font-size: 16px;"><span style="font-size: 16px; color: rgb(77, 77, 77); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: 400; line-height: 26px;">详细来看，将内存子查询的from子句展开后，得到如下AST Tree，每个表生成一个TOK_TABREF节点，Join条件生成一个“=”节点。其他SQL部分类似，不一一详述。</span></div><div style="outline: 0px; padding: 0px; overflow-wrap: break-word; margin: 0px 0px 16px; box-sizing: border-box; font-size: 16px;"><span style="font-size: 16px; color: rgb(77, 77, 77); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: 400; line-height: 26px;">看一个slice里面的例子：</span></div><div style="outline: 0px; padding: 0px; overflow-wrap: break-word; margin: 0px 0px 16px; box-sizing: border-box; font-size: 16px;"><span style="font-size: 16px; color: rgb(77, 77, 77); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: 400; line-height: 26px;"><img src="Hive SQL转化为MapReduce执行计划深度解析_files/70 [2]" type="image/png" data-filename="70" height="307" style="border:0px;outline:0px;overflow-wrap:break-word;max-width:100%;height:auto;box-sizing:border-box;cursor:zoom-in;" width="400"/></span></div><div style="outline: 0px; padding: 0px; overflow-wrap: break-word; margin: 0px 0px 16px; box-sizing: border-box; font-size: 16px; text-align: center;"><span style="font-size: 16px; color: rgb(77, 77, 77); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: 400; line-height: 26px;"><img src="Hive SQL转化为MapReduce执行计划深度解析_files/70 [3]" type="image/png" data-filename="70" height="307" style="border:0px;outline:0px;overflow-wrap:break-word;max-width:100%;height:auto;box-sizing:border-box;cursor:zoom-in;" width="414"/></span></div><h3 style="outline: 0px; padding: 0px; overflow-wrap: break-word; box-sizing: border-box; margin: 8px 0px 16px; font-size: 22px;"><span style="font-size: 22px; color: rgb(79, 79, 79); font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; font-weight: 700; line-height: 30px;">2.2 Phase2 SQL基本组成单元QueryBlock </span></h3><div style="outline: 0px; padding: 0px; overflow-wrap: break-word; margin: 0px 0px 16px; box-sizing: border-box; font-size: 16px;"><span style="font-size: 16px; color: rgb(77, 77, 77); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: 400; line-height: 26px;"> AST Tree仍然非常复杂，不够结构化，不方便直接翻译为MapReduce程序，AST Tree转化为QueryBlock就是将SQL进一部抽象和结构化</span></div><div style="outline: 0px; padding: 0px; overflow-wrap: break-word; margin: 0px 0px 16px; box-sizing: border-box; font-size: 16px;"><span style="font-size: 16px; color: rgb(77, 77, 77); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: 700; line-height: 26px; outline: 0px; overflow-wrap: break-word; box-sizing: border-box;">QueryBlock（非重点）</span></div><div style="outline: 0px; padding: 0px; overflow-wrap: break-word; margin: 0px 0px 16px; box-sizing: border-box; font-size: 16px;"><span style="font-size: 16px; color: rgb(77, 77, 77); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: 400; line-height: 26px;">QueryBlock是一条SQL最基本的组成单元，包括三个部分：输入源，计算过程，输出。简单来讲一个QueryBlock就是一个子查询。</span></div><div style="outline: 0px; padding: 0px; overflow-wrap: break-word; margin: 0px 0px 16px; box-sizing: border-box; font-size: 16px;"><span style="font-size: 16px; color: rgb(77, 77, 77); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: 400; line-height: 26px;">下图为Hive中QueryBlock相关对象的类图，解释图中几个重要的属性</span></div><div style="outline: 0px; padding: 0px; list-style: disc; overflow-wrap: break-word; box-sizing: border-box; margin: 8px 0px 0px 32px;"><span style="font-size: 16px; color: rgb(51, 51, 51); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: normal; line-height: 1.57143;">QB.aliasToSubq（表示QB类的aliasToSubq属性）保存子查询的QB对象，aliasToSubq的key值是子查询的别名</span></div><div style="outline: 0px; padding: 0px; list-style: disc; overflow-wrap: break-word; box-sizing: border-box; margin: 8px 0px 0px 32px;"><span style="font-size: 16px; color: rgb(51, 51, 51); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: normal; line-height: 1.57143;">QB.qbp即QBParseInfo保存一个基本SQL单元中的各个操作部分的AST Tree结构，QBParseInfo.nameToDest这个HashMap保存查询单元的输出，key的形式是inclause-i（由于Hive支持Multi Insert语句，所以可能有多个输出），value是对应的ASTNode节点，即TOK_DESTINATION节点。类QBParseInfo其余HashMap属性分别保存输出和各个操作的ASTNode节点的对应关系。</span></div><div style="outline: 0px; padding: 0px; list-style: disc; overflow-wrap: break-word; box-sizing: border-box; margin: 8px 0px 0px 32px;"><span style="font-size: 16px; color: rgb(51, 51, 51); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: normal; line-height: 1.57143;">QBParseInfo.JoinExpr保存TOK_JOIN节点。QB.QBJoinTree是对Join语法树的结构化。</span></div><div style="outline: 0px; padding: 0px; list-style: disc; overflow-wrap: break-word; box-sizing: border-box; margin: 8px 0px 0px 32px;"><span style="font-size: 16px; color: rgb(51, 51, 51); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: normal; line-height: 1.57143;">QB.qbm保存每个输入表的元信息，比如表在HDFS上的路径，保存表数据的文件格式等。</span></div><div style="outline: 0px; padding: 0px; list-style: disc; overflow-wrap: break-word; box-sizing: border-box; margin: 8px 0px 0px 32px;"><span style="font-size: 16px; color: rgb(51, 51, 51); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: normal; line-height: 1.57143;">QBExpr这个对象是为了表示Union操作。</span></div><div style="outline: 0px; padding: 0px; overflow-wrap: break-word; margin: 0px 0px 16px; box-sizing: border-box; font-size: 16px; text-align: center;"><span style="font-size: 16px; color: rgb(77, 77, 77); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: 400; line-height: 26px;"><a href="Hive SQL转化为MapReduce执行计划深度解析_files/mapjoin.png"><img src="Hive SQL转化为MapReduce执行计划深度解析_files/ad092e0acd3437eb6982f1bae7811d15.png" alt="mapjoin.png"></a></span></div><div style="outline: 0px; padding: 0px; overflow-wrap: break-word; margin: 0px 0px 16px; box-sizing: border-box; font-size: 16px;"><span style="font-size: 16px; color: rgb(77, 77, 77); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: 700; line-height: 26px; outline: 0px; overflow-wrap: break-word; box-sizing: border-box;">AST Tree生成QueryBlock（重点）</span></div><div style="outline: 0px; padding: 0px; overflow-wrap: break-word; margin: 0px 0px 16px; box-sizing: border-box; font-size: 16px;"><span style="font-size: 16px; color: rgb(77, 77, 77); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: 400; line-height: 26px;">AST Tree生成QueryBlock的过程是一个递归的过程，先序遍历AST Tree，遇到不同的Token节点，保存到相应的属性中，主要包含以下几个过程：</span></div><div style="outline: 0px; padding: 0px; list-style: disc; overflow-wrap: break-word; box-sizing: border-box; margin: 8px 0px 0px 32px;"><span style="font-size: 16px; color: rgb(51, 51, 51); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: normal; line-height: 1.57143;">TOK_QUERY =&gt; 创建QB对象，循环递归子节点</span></div><div style="outline: 0px; padding: 0px; list-style: disc; overflow-wrap: break-word; box-sizing: border-box; margin: 8px 0px 0px 32px;"><span style="font-size: 16px; color: rgb(51, 51, 51); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: normal; line-height: 1.57143;">TOK_FROM =&gt; 将表名语法部分保存到QB对象的</span><span style="font-size: 16px; color: rgb(51, 51, 51); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: normal; line-height: 1.57143; outline: 0px; overflow-wrap: break-word; box-sizing: border-box; border-radius: 4px;">aliasToTabs</span><span style="font-size: 16px; color: rgb(51, 51, 51); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: normal; line-height: 1.57143;">等属性中</span></div><div style="outline: 0px; padding: 0px; list-style: disc; overflow-wrap: break-word; box-sizing: border-box; margin: 8px 0px 0px 32px;"><span style="font-size: 16px; color: rgb(51, 51, 51); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: normal; line-height: 1.57143;">TOK_INSERT =&gt; 循环递归子节点</span></div><div style="outline: 0px; padding: 0px; list-style: disc; overflow-wrap: break-word; box-sizing: border-box; margin: 8px 0px 0px 32px;"><span style="font-size: 16px; color: rgb(51, 51, 51); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: normal; line-height: 1.57143;">TOK_DESTINATION =&gt; 将输出目标的语法部分保存在QBParseInfo对象的nameToDest属性中</span></div><div style="outline: 0px; padding: 0px; list-style: disc; overflow-wrap: break-word; box-sizing: border-box; margin: 8px 0px 0px 32px;"><span style="font-size: 16px; color: rgb(51, 51, 51); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: normal; line-height: 1.57143;">TOK_SELECT =&gt; 分别将查询表达式的语法部分保存在</span><span style="font-size: 16px; color: rgb(51, 51, 51); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: normal; line-height: 1.57143; outline: 0px; overflow-wrap: break-word; box-sizing: border-box; border-radius: 4px;">destToSelExpr</span><span style="font-size: 16px; color: rgb(51, 51, 51); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: normal; line-height: 1.57143;">、</span><span style="font-size: 16px; color: rgb(51, 51, 51); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: normal; line-height: 1.57143; outline: 0px; overflow-wrap: break-word; box-sizing: border-box; border-radius: 4px;">destToAggregationExprs</span><span style="font-size: 16px; color: rgb(51, 51, 51); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: normal; line-height: 1.57143;">、</span><span style="font-size: 16px; color: rgb(51, 51, 51); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: normal; line-height: 1.57143; outline: 0px; overflow-wrap: break-word; box-sizing: border-box; border-radius: 4px;">destToDistinctFuncExprs</span><span style="font-size: 16px; color: rgb(51, 51, 51); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: normal; line-height: 1.57143;">三个属性中</span></div><div style="outline: 0px; padding: 0px; list-style: disc; overflow-wrap: break-word; box-sizing: border-box; margin: 8px 0px 0px 32px;"><span style="font-size: 16px; color: rgb(51, 51, 51); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: normal; line-height: 1.57143;">TOK_WHERE =&gt; 将Where部分的语法保存在QBParseInfo对象的destToWhereExpr属性中</span></div><div style="outline: 0px; padding: 0px; overflow-wrap: break-word; margin: 0px 0px 16px; box-sizing: border-box; font-size: 16px;"><span style="font-size: 16px; color: rgb(77, 77, 77); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: 400; line-height: 26px;">看一下slice中的例子：</span></div><div style="outline: 0px; padding: 0px; overflow-wrap: break-word; margin: 0px 0px 16px; box-sizing: border-box; font-size: 16px;"><span style="font-size: 16px; color: rgb(77, 77, 77); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: 400; line-height: 26px;"><img src="Hive SQL转化为MapReduce执行计划深度解析_files/70 [4]" type="image/png" data-filename="70" height="223" style="border:0px;outline:0px;overflow-wrap:break-word;max-width:100%;height:auto;box-sizing:border-box;cursor:zoom-in;" width="300"/><img src="Hive SQL转化为MapReduce执行计划深度解析_files/70 [5]" type="image/png" data-filename="70" height="225" style="border:0px;outline:0px;overflow-wrap:break-word;max-width:100%;height:auto;box-sizing:border-box;cursor:zoom-in;" width="300"/><img src="Hive SQL转化为MapReduce执行计划深度解析_files/70 [6]" type="image/png" data-filename="70" height="225" style="border:0px;outline:0px;overflow-wrap:break-word;max-width:100%;height:auto;box-sizing:border-box;cursor:zoom-in;" width="300"/></span></div><h3 style="outline: 0px; padding: 0px; overflow-wrap: break-word; box-sizing: border-box; margin: 8px 0px 16px; font-size: 22px;"><span style="font-size: 22px; color: rgb(79, 79, 79); font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; font-weight: 700; line-height: 30px; outline: 0px; overflow-wrap: break-word; box-sizing: border-box;">2.3 Phase3 逻辑操作符Operator和逻辑操作树Operator Tree</span></h3><div style="outline: 0px; padding: 0px; overflow-wrap: break-word; margin: 0px 0px 16px; box-sizing: border-box; font-size: 16px;"><span style="font-size: 16px; color: rgb(77, 77, 77); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: 700; line-height: 26px; outline: 0px; overflow-wrap: break-word; box-sizing: border-box;">Operator</span></div><div style="outline: 0px; padding: 0px; overflow-wrap: break-word; margin: 0px 0px 16px; box-sizing: border-box; font-size: 16px; text-indent: 0px;"><span style="font-size: 16px; color: rgb(77, 77, 77); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: 400; line-height: 26px;">Hive最终生成的MapReduce任务，Map阶段和Reduce阶段均由OperatorTree组成。逻辑操作符，就是在Map阶段或者Reduce阶段完成单一特定的操作。基本的操作符包括TableScanOperator，SelectOperator，FilterOperator，JoinOperator，GroupByOperator，ReduceSinkOperator。</span></div><div style="outline: 0px; padding: 0px; overflow-wrap: break-word; margin: 0px 0px 16px; box-sizing: border-box; font-size: 16px;"><span style="font-size: 16px; color: rgb(77, 77, 77); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: 400; line-height: 26px;">从名字就能猜出各个操作符完成的功能，TableScanOperator从MapReduce框架的Map接口原始输入表的数据，控制扫描表的数据行数，标记是从原表中取数据。JoinOperator完成Join操作。FilterOperator完成过滤操作。ReduceSinkOperator将Map端的字段组合序列化为Reduce Key/value, Partition Key，只可能出现在Map阶段，同时也标志着Hive生成的MapReduce程序中Map阶段的结束。</span></div><div style="outline: 0px; padding: 0px; overflow-wrap: break-word; margin: 0px 0px 16px; box-sizing: border-box; font-size: 16px;"><span style="font-size: 16px; color: rgb(77, 77, 77); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: 400; line-height: 26px;">Operator在Map Reduce阶段之间的数据传递都是一个流式的过程。每一个Operator对一行数据完成操作后之后将数据传递给childOperator计算。</span></div><div style="outline: 0px; padding: 0px; overflow-wrap: break-word; margin: 0px 0px 16px; box-sizing: border-box; font-size: 16px;"><span style="font-size: 16px; color: rgb(77, 77, 77); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: 700; line-height: 26px; outline: 0px; overflow-wrap: break-word; box-sizing: border-box;">QueryBlock生成Operator Tree</span></div><div style="outline: 0px; padding: 0px; overflow-wrap: break-word; margin: 0px 0px 16px; box-sizing: border-box; font-size: 16px;"><span style="font-size: 16px; color: rgb(77, 77, 77); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: 400; line-height: 26px;">QueryBlock生成Operator Tree就是遍历上一个过程中生成的QB和QBParseInfo对象的保存语法的属性，包含如下几个步骤：</span></div><div style="outline: 0px; padding: 0px; list-style: disc; overflow-wrap: break-word; box-sizing: border-box; margin: 8px 0px 0px 32px;"><span style="font-size: 16px; color: rgb(51, 51, 51); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: normal; line-height: 1.57143;">QB.aliasToSubq =&gt; 有子查询，递归调用</span></div><div style="outline: 0px; padding: 0px; list-style: disc; overflow-wrap: break-word; box-sizing: border-box; margin: 8px 0px 0px 32px;"><span style="font-size: 16px; color: rgb(51, 51, 51); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: normal; line-height: 1.57143;">QB.aliasToTabs =&gt; TableScanOperator</span></div><div style="outline: 0px; padding: 0px; list-style: disc; overflow-wrap: break-word; box-sizing: border-box; margin: 8px 0px 0px 32px;"><span style="font-size: 16px; color: rgb(51, 51, 51); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: normal; line-height: 1.57143;">QBParseInfo.joinExpr =&gt; QBJoinTree =&gt; ReduceSinkOperator + JoinOperator</span></div><div style="outline: 0px; padding: 0px; list-style: disc; overflow-wrap: break-word; box-sizing: border-box; margin: 8px 0px 0px 32px;"><span style="font-size: 16px; color: rgb(51, 51, 51); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: normal; line-height: 1.57143;">QBParseInfo.destToWhereExpr =&gt; FilterOperator</span></div><div style="outline: 0px; padding: 0px; list-style: disc; overflow-wrap: break-word; box-sizing: border-box; margin: 8px 0px 0px 32px;"><span style="font-size: 16px; color: rgb(51, 51, 51); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: normal; line-height: 1.57143;">QBParseInfo.destToGroupby =&gt; ReduceSinkOperator + GroupByOperator</span></div><div style="outline: 0px; padding: 0px; list-style: disc; overflow-wrap: break-word; box-sizing: border-box; margin: 8px 0px 0px 32px;"><span style="font-size: 16px; color: rgb(51, 51, 51); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: normal; line-height: 1.57143;">QBParseInfo.destToOrderby =&gt; ReduceSinkOperator + ExtractOperator</span></div><h3 style="outline: 0px; padding: 0px; overflow-wrap: break-word; box-sizing: border-box; margin: 8px 0px 16px; font-size: 22px;"><span style="font-size: 22px; color: rgb(79, 79, 79); font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; font-weight: 700; line-height: 30px;">2.4 Phase4 逻辑层优化器</span></h3><div style="outline: 0px; padding: 0px; overflow-wrap: break-word; margin: 0px 0px 16px; box-sizing: border-box; font-size: 16px;"><span style="font-size: 16px; color: rgb(77, 77, 77); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: 400; line-height: 26px;">大部分逻辑层优化器通过变换OperatorTree，合并操作符，达到减少MapReduce Job（② ），减少shuffle数据量的目的（①）。</span></div><div style="outline: 0px; margin: 0px 0px 24px; padding: 0px; overflow-wrap: break-word; box-sizing: border-box; overflow-x: auto;"><div><br/></div><table align="center" border="1" cellpadding="1" cellspacing="1" style="font-size: inherit; outline: 0px; border-spacing: 0px; overflow-wrap: break-word; box-sizing: border-box; display: table; text-align: left; margin-left: auto; margin-right: auto; border-collapse: collapse; margin-bottom: 0px; width: 600px;"><colgroup><col style="width: 300px;"></col><col style="width: 300px;"></col></colgroup><tbody style="outline:0px;overflow-wrap:break-word;box-sizing:border-box;border:0px;"><tr style="outline:0px;overflow-wrap:break-word;box-sizing:border-box;border-width:1px 0px 0px;border-right-style:initial;border-bottom-style:initial;border-left-style:initial;border-right-color:initial;border-bottom-color:initial;border-left-color:initial;border-image:initial;border-top-style:solid;border-top-color:rgb(221, 221, 221);background-color:rgb(255, 255, 255);"><td style="outline: 0px; margin: 0px; overflow-wrap: break-word; box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; text-align: left; padding: 8px; background-color: rgb(239, 243, 245);"><span style="font-size: 14px; color: rgb(79, 79, 79); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: 700; line-height: 22px;">名称</span></td><td style="outline: 0px; margin: 0px; overflow-wrap: break-word; box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; text-align: left; padding: 8px; background-color: rgb(239, 243, 245);"><div style="outline: 0px; overflow-wrap: break-word; box-sizing: border-box; text-align: left; margin: 0px; padding: 0px; font-size: 16px;"><span style="font-size: 16px; color: rgb(79, 79, 79); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: 700; line-height: 26px;">作用</span></div></td></tr><tr style="outline:0px;overflow-wrap:break-word;box-sizing:border-box;border-width:1px 0px 0px;border-right-style:initial;border-bottom-style:initial;border-left-style:initial;border-right-color:initial;border-bottom-color:initial;border-left-color:initial;border-image:initial;border-top-style:solid;border-top-color:rgb(221, 221, 221);background-color:rgb(255, 255, 255);"><td style="outline: 0px; margin: 0px; overflow-wrap: break-word; box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; text-align: left; padding: 8px;"><div style="outline: 0px; overflow-wrap: break-word; box-sizing: border-box; text-align: left; margin: 0px; padding: 0px; font-size: 16px;"><span style="font-size: 16px; color: rgb(79, 79, 79); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: 400; line-height: 26px;">② SimpleFetchOptimizer</span></div></td><td style="outline: 0px; margin: 0px; overflow-wrap: break-word; box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; text-align: left; padding: 8px;"><div style="outline: 0px; overflow-wrap: break-word; box-sizing: border-box; text-align: left; margin: 0px; padding: 0px; font-size: 16px;"><span style="font-size: 16px; color: rgb(79, 79, 79); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: 400; line-height: 26px;">优化没有GroupBy表达式的聚合查询</span></div></td></tr><tr style="outline:0px;overflow-wrap:break-word;box-sizing:border-box;border-width:1px 0px 0px;border-right-style:initial;border-bottom-style:initial;border-left-style:initial;border-right-color:initial;border-bottom-color:initial;border-left-color:initial;border-image:initial;border-top-style:solid;border-top-color:rgb(221, 221, 221);background-color:rgb(247, 247, 247);"><td style="outline: 0px; margin: 0px; overflow-wrap: break-word; box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; text-align: left; padding: 8px;"><div style="outline: 0px; overflow-wrap: break-word; box-sizing: border-box; text-align: left; margin: 0px; padding: 0px; font-size: 16px;"><span style="font-size: 16px; color: rgb(79, 79, 79); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: 400; line-height: 26px;">② MapJoinProcessor</span></div></td><td style="outline: 0px; margin: 0px; overflow-wrap: break-word; box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; text-align: left; padding: 8px;"><div style="outline: 0px; overflow-wrap: break-word; box-sizing: border-box; text-align: left; margin: 0px; padding: 0px; font-size: 16px;"><span style="font-size: 16px; color: rgb(79, 79, 79); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: 400; line-height: 26px;">MapJoin，需要SQL中提供hint，0.11版本已不用</span></div></td></tr><tr style="outline:0px;overflow-wrap:break-word;box-sizing:border-box;border-width:1px 0px 0px;border-right-style:initial;border-bottom-style:initial;border-left-style:initial;border-right-color:initial;border-bottom-color:initial;border-left-color:initial;border-image:initial;border-top-style:solid;border-top-color:rgb(221, 221, 221);background-color:rgb(255, 255, 255);"><td style="outline: 0px; margin: 0px; overflow-wrap: break-word; box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; text-align: left; padding: 8px;"><div style="outline: 0px; overflow-wrap: break-word; box-sizing: border-box; text-align: left; margin: 0px; padding: 0px; font-size: 16px;"><span style="font-size: 16px; color: rgb(79, 79, 79); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: 400; line-height: 26px;">② BucketMapJoinOptimizer</span></div></td><td style="outline: 0px; margin: 0px; overflow-wrap: break-word; box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; text-align: left; padding: 8px;"><div style="outline: 0px; overflow-wrap: break-word; box-sizing: border-box; text-align: left; margin: 0px; padding: 0px; font-size: 16px;"><span style="font-size: 16px; color: rgb(79, 79, 79); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: 400; line-height: 26px;">BucketMapJoin</span></div></td></tr><tr style="outline:0px;overflow-wrap:break-word;box-sizing:border-box;border-width:1px 0px 0px;border-right-style:initial;border-bottom-style:initial;border-left-style:initial;border-right-color:initial;border-bottom-color:initial;border-left-color:initial;border-image:initial;border-top-style:solid;border-top-color:rgb(221, 221, 221);background-color:rgb(247, 247, 247);"><td style="outline: 0px; margin: 0px; overflow-wrap: break-word; box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; text-align: left; padding: 8px;"><div style="outline: 0px; overflow-wrap: break-word; box-sizing: border-box; text-align: left; margin: 0px; padding: 0px; font-size: 16px;"><span style="font-size: 16px; color: rgb(79, 79, 79); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: 400; line-height: 26px;">② GroupByOptimizer</span></div></td><td style="outline: 0px; margin: 0px; overflow-wrap: break-word; box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; text-align: left; padding: 8px;"><div style="outline: 0px; overflow-wrap: break-word; box-sizing: border-box; text-align: left; margin: 0px; padding: 0px; font-size: 16px;"><span style="font-size: 16px; color: rgb(79, 79, 79); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: 400; line-height: 26px;">Map端聚合</span></div></td></tr><tr style="outline:0px;overflow-wrap:break-word;box-sizing:border-box;border-width:1px 0px 0px;border-right-style:initial;border-bottom-style:initial;border-left-style:initial;border-right-color:initial;border-bottom-color:initial;border-left-color:initial;border-image:initial;border-top-style:solid;border-top-color:rgb(221, 221, 221);background-color:rgb(255, 255, 255);"><td style="outline: 0px; margin: 0px; overflow-wrap: break-word; box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; text-align: left; padding: 8px;"><div style="outline: 0px; overflow-wrap: break-word; box-sizing: border-box; text-align: left; margin: 0px; padding: 0px; font-size: 16px;"><span style="font-size: 16px; color: rgb(79, 79, 79); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: 400; line-height: 26px;">① ReduceSinkDeDuplication</span></div></td><td style="outline: 0px; margin: 0px; overflow-wrap: break-word; box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; text-align: left; padding: 8px;"><div style="outline: 0px; overflow-wrap: break-word; box-sizing: border-box; text-align: left; margin: 0px; padding: 0px; font-size: 16px;"><span style="font-size: 16px; color: rgb(79, 79, 79); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: 400; line-height: 26px;">合并线性的OperatorTree中partition/sort key相同的reduce</span></div></td></tr><tr style="outline:0px;overflow-wrap:break-word;box-sizing:border-box;border-width:1px 0px 0px;border-right-style:initial;border-bottom-style:initial;border-left-style:initial;border-right-color:initial;border-bottom-color:initial;border-left-color:initial;border-image:initial;border-top-style:solid;border-top-color:rgb(221, 221, 221);background-color:rgb(247, 247, 247);"><td style="outline: 0px; margin: 0px; overflow-wrap: break-word; box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; text-align: left; padding: 8px;"><div style="outline: 0px; overflow-wrap: break-word; box-sizing: border-box; text-align: left; margin: 0px; padding: 0px; font-size: 16px;"><span style="font-size: 16px; color: rgb(79, 79, 79); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: 400; line-height: 26px;">① PredicatePushDown</span></div></td><td style="outline: 0px; margin: 0px; overflow-wrap: break-word; box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; text-align: left; padding: 8px;"><div style="outline: 0px; overflow-wrap: break-word; box-sizing: border-box; text-align: left; margin: 0px; padding: 0px; font-size: 16px;"><span style="font-size: 16px; color: rgb(79, 79, 79); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: 400; line-height: 26px;">谓词前置</span></div></td></tr><tr style="outline:0px;overflow-wrap:break-word;box-sizing:border-box;border-width:1px 0px 0px;border-right-style:initial;border-bottom-style:initial;border-left-style:initial;border-right-color:initial;border-bottom-color:initial;border-left-color:initial;border-image:initial;border-top-style:solid;border-top-color:rgb(221, 221, 221);background-color:rgb(255, 255, 255);"><td style="outline: 0px; margin: 0px; overflow-wrap: break-word; box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; text-align: left; padding: 8px;"><div style="outline: 0px; overflow-wrap: break-word; box-sizing: border-box; text-align: left; margin: 0px; padding: 0px; font-size: 16px;"><span style="font-size: 16px; color: rgb(79, 79, 79); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: 400; line-height: 26px;">① CorrelationOptimizer</span></div></td><td style="outline: 0px; margin: 0px; overflow-wrap: break-word; box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; text-align: left; padding: 8px;"><div style="outline: 0px; overflow-wrap: break-word; box-sizing: border-box; text-align: left; margin: 0px; padding: 0px; font-size: 16px;"><span style="font-size: 16px; color: rgb(79, 79, 79); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: 400; line-height: 26px;">利用查询中的相关性，合并有相关性的Job，HIVE-2206</span></div></td></tr><tr style="outline:0px;overflow-wrap:break-word;box-sizing:border-box;border-width:1px 0px 0px;border-right-style:initial;border-bottom-style:initial;border-left-style:initial;border-right-color:initial;border-bottom-color:initial;border-left-color:initial;border-image:initial;border-top-style:solid;border-top-color:rgb(221, 221, 221);background-color:rgb(247, 247, 247);"><td style="outline: 0px; margin: 0px; overflow-wrap: break-word; box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; text-align: left; padding: 8px;"><div style="outline: 0px; overflow-wrap: break-word; box-sizing: border-box; text-align: left; margin: 0px; padding: 0px; font-size: 16px;"><span style="font-size: 16px; color: rgb(79, 79, 79); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: 400; line-height: 26px;">ColumnPruner</span></div></td><td style="outline: 0px; margin: 0px; overflow-wrap: break-word; box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; text-align: left; padding: 8px;"><div style="outline: 0px; overflow-wrap: break-word; box-sizing: border-box; text-align: left; margin: 0px; padding: 0px; font-size: 16px;"><span style="font-size: 16px; color: rgb(79, 79, 79); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: 400; line-height: 26px;">字段剪枝</span></div></td></tr></tbody></table><div><br/></div></div><div style="outline: 0px; padding: 0px; overflow-wrap: break-word; margin: 0px 0px 16px; box-sizing: border-box; font-size: 16px;"><span style="font-size: 16px; color: rgb(77, 77, 77); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: 400; line-height: 26px;">表格中①的优化器均是一个Job干尽可能多的事情/合并。②的都是减少shuffle数据量，甚至不做Reduce。CorrelationOptimizer优化器非常复杂，都能利用查询中的相关性，合并有相关性的Job，参考 </span><a href="https://cwiki.apache.org/confluence/display/Hive/Correlation+Optimizer" style="margin: 0px; padding: 0px; outline: 0px; cursor: pointer; overflow-wrap: break-word; box-sizing: border-box; font-size: 16px; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: normal; line-height: 26px; color: rgb(78, 161, 219); text-decoration: none;">Hive Correlation Optimizer</a><span style="font-size: 16px; color: rgb(77, 77, 77); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: 400; line-height: 26px;">。</span></div><div style="outline: 0px; padding: 0px; overflow-wrap: break-word; margin: 0px 0px 16px; box-sizing: border-box; font-size: 16px;"><span style="font-size: 16px; color: rgb(77, 77, 77); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: 400; line-height: 26px;">注：具体的每个优化器优化了什么，没看太明白。其中：PredicatePushDown看slice是把一个查询的谓词（LKIE、BETWEEN、IS NULL、IS NOT NULL、IN、EXISTS）提到他在OperatorTree中的前置查询里。以提前减少数据量。</span></div><h3 style="outline: 0px; padding: 0px; overflow-wrap: break-word; box-sizing: border-box; margin: 8px 0px 16px; font-size: 22px;"><span style="font-size: 22px; color: rgb(79, 79, 79); font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; font-weight: 700; line-height: 30px;">2.5 Phase5 OperatorTree生成MapReduce Job的过程</span></h3><div style="outline: 0px; padding: 0px; overflow-wrap: break-word; margin: 0px 0px 16px; box-sizing: border-box; font-size: 16px;"><span style="font-size: 16px; color: rgb(77, 77, 77); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: 400; line-height: 26px;">OperatorTree转化为MapReduce Job的过程分为下面几个阶段</span></div><div style="outline: 0px; margin: 8px 0px 0px 40px; padding: 0px; list-style: decimal; overflow-wrap: break-word; box-sizing: border-box;"><span style="font-size: 16px; color: rgb(51, 51, 51); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: normal; line-height: 1.57143;">对输出表生成MoveTask</span></div><div style="outline: 0px; margin: 8px 0px 0px 40px; padding: 0px; list-style: decimal; overflow-wrap: break-word; box-sizing: border-box;"><span style="font-size: 16px; color: rgb(51, 51, 51); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: normal; line-height: 1.57143;">从OperatorTree的其中一个根节点向下深度优先遍历</span></div><div style="outline: 0px; margin: 8px 0px 0px 40px; padding: 0px; list-style: decimal; overflow-wrap: break-word; box-sizing: border-box;"><span style="font-size: 16px; color: rgb(51, 51, 51); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: normal; line-height: 1.57143;">ReduceSinkOperator标示Map/Reduce的界限，多个Job间的界限</span></div><div style="outline: 0px; margin: 8px 0px 0px 40px; padding: 0px; list-style: decimal; overflow-wrap: break-word; box-sizing: border-box;"><span style="font-size: 16px; color: rgb(51, 51, 51); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: normal; line-height: 1.57143;">遍历其他根节点，遇过碰到JoinOperator合并MapReduceTask</span></div><div style="outline: 0px; margin: 8px 0px 0px 40px; padding: 0px; list-style: decimal; overflow-wrap: break-word; box-sizing: border-box;"><span style="font-size: 16px; color: rgb(51, 51, 51); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: normal; line-height: 1.57143;">生成StatTask更新元数据</span></div><div style="outline: 0px; margin: 8px 0px 0px 40px; padding: 0px; list-style: decimal; overflow-wrap: break-word; box-sizing: border-box;"><span style="font-size: 16px; color: rgb(51, 51, 51); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: normal; line-height: 1.57143;">剪断Map与Reduce间的Operator的关系</span></div><div style="outline: 0px; padding: 0px; overflow-wrap: break-word; margin: 0px 0px 16px; box-sizing: border-box; font-size: 16px;"><span style="font-size: 16px; color: rgb(77, 77, 77); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: 400; line-height: 26px;">这一段太复杂。再次学习之后 再作补充。</span></div><div style="outline: 0px; padding: 0px; overflow-wrap: break-word; margin: 0px 0px 16px; box-sizing: border-box; font-size: 16px;"><span style="font-size: 16px; color: rgb(77, 77, 77); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: 400; line-height: 26px;">大致思想是：从operatorTree的根节点开始遍历。把各个根节点入队，然后遇到符合一定规则的组合，就划分Map/Reduce的界限，或者划分Job的界限。有好几个规则（Rules）。</span></div><div style="outline: 0px; padding: 0px; overflow-wrap: break-word; margin: 0px 0px 16px; box-sizing: border-box; font-size: 16px;"><span style="font-size: 16px; color: rgb(77, 77, 77); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: 400; line-height: 26px;">例如：遇到TS（QB.aliasToTabs），就生成一个MapWork，再遇到RS（ReduceSinkOperator），就从TS到RS划分为一个MapWork，从该RS到下一个RS前，划分为一个ReduceWork。下一个RS又生成一个MapWork。</span></div><div style="outline: 0px; padding: 0px; overflow-wrap: break-word; margin: 0px 0px 16px; box-sizing: border-box; font-size: 16px;"><span style="font-size: 16px; color: rgb(77, 77, 77); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: 400; line-height: 26px;">下图是一个从OperatorTree到MapReduceJob的示例。FS[19]和FS[21]是Stage间生成的中间文件。</span></div><div style="outline: 0px; padding: 0px; overflow-wrap: break-word; margin: 0px 0px 16px; box-sizing: border-box; font-size: 16px; text-align: center;"><span style="font-size: 16px; color: rgb(77, 77, 77); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: 400; line-height: 26px;"><img src="Hive SQL转化为MapReduce执行计划深度解析_files/70 [7]" type="image/png" data-filename="70" height="400" style="border:0px;outline:0px;overflow-wrap:break-word;max-width:100%;height:auto;box-sizing:border-box;cursor:zoom-in;" width="487"/></span></div><h3 style="outline: 0px; padding: 0px; overflow-wrap: break-word; box-sizing: border-box; margin: 8px 0px 16px; font-size: 22px;"><span style="font-size: 22px; color: rgb(79, 79, 79); font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; font-weight: 700; line-height: 30px;">2.6 Phase6 物理层优化器</span></h3><div style="outline: 0px; padding: 0px; overflow-wrap: break-word; margin: 0px 0px 16px; box-sizing: border-box; font-size: 16px;"><span style="font-size: 16px; color: rgb(77, 77, 77); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: 400; line-height: 26px;">这里不详细介绍每个优化器的原理，单独介绍一下MapJoin的优化器</span></div><div style="outline: 0px; margin: 0px 0px 24px; padding: 0px; overflow-wrap: break-word; box-sizing: border-box; overflow-x: auto;"><div><br/></div><table style="font-size: inherit; outline: 0px; border-spacing: 0px; overflow-wrap: break-word; box-sizing: border-box; display: table; text-align: left; margin-left: auto; margin-right: auto;"><colgroup><col style="width: 130px;"></col><col style="width: 130px;"></col></colgroup><tbody style="outline:0px;overflow-wrap:break-word;box-sizing:border-box;border:0px;"><tr style="outline: 0px; overflow-wrap: break-word; box-sizing: border-box; background-color: rgb(255, 255, 255);"><td style="outline: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; text-align: left; background-color: rgb(239, 243, 245); border-color: rgb(221, 221, 221);"><div style="outline: 0px; overflow-wrap: break-word; box-sizing: border-box; text-align: left; margin: 0px; padding: 0px; font-size: 16px;"><span style="font-size: 16px; color: rgb(79, 79, 79); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: 700; line-height: 26px;">名称</span></div></td><td style="outline: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; text-align: left; background-color: rgb(239, 243, 245); border-color: rgb(221, 221, 221);"><div style="outline: 0px; overflow-wrap: break-word; box-sizing: border-box; text-align: left; margin: 0px; padding: 0px; font-size: 16px;"><span style="font-size: 16px; color: rgb(79, 79, 79); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: 700; line-height: 26px;">作用</span></div></td></tr><tr style="outline: 0px; overflow-wrap: break-word; box-sizing: border-box; background-color: rgb(255, 255, 255);"><td style="outline: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; text-align: left; border-color: rgb(221, 221, 221);"><div style="outline: 0px; overflow-wrap: break-word; box-sizing: border-box; text-align: left; margin: 0px; padding: 0px; font-size: 16px;"><span style="font-size: 16px; color: rgb(79, 79, 79); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: 400; line-height: 26px;">Vectorizer</span></div></td><td style="outline: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; text-align: left; border-color: rgb(221, 221, 221);"><div style="outline: 0px; overflow-wrap: break-word; box-sizing: border-box; text-align: left; margin: 0px; padding: 0px; font-size: 16px;"><span style="font-size: 16px; color: rgb(79, 79, 79); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: 400; line-height: 26px;">HIVE-4160，将在0.13中发布</span></div></td></tr><tr style="outline: 0px; overflow-wrap: break-word; box-sizing: border-box; background-color: rgb(247, 247, 247);"><td style="outline: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; text-align: left; border-color: rgb(221, 221, 221);"><div style="outline: 0px; overflow-wrap: break-word; box-sizing: border-box; text-align: left; margin: 0px; padding: 0px; font-size: 16px;"><span style="font-size: 16px; color: rgb(79, 79, 79); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: 400; line-height: 26px;">SortMergeJoinResolver</span></div></td><td style="outline: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; text-align: left; border-color: rgb(221, 221, 221);"><div style="outline: 0px; overflow-wrap: break-word; box-sizing: border-box; text-align: left; margin: 0px; padding: 0px; font-size: 16px;"><span style="font-size: 16px; color: rgb(79, 79, 79); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: 400; line-height: 26px;">与bucket配合，类似于归并排序</span></div></td></tr><tr style="outline: 0px; overflow-wrap: break-word; box-sizing: border-box; background-color: rgb(255, 255, 255);"><td style="outline: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; text-align: left; border-color: rgb(221, 221, 221);"><div style="outline: 0px; overflow-wrap: break-word; box-sizing: border-box; text-align: left; margin: 0px; padding: 0px; font-size: 16px;"><span style="font-size: 16px; color: rgb(79, 79, 79); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: 400; line-height: 26px;">SamplingOptimizer</span></div></td><td style="outline: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; text-align: left; border-color: rgb(221, 221, 221);"><div style="outline: 0px; overflow-wrap: break-word; box-sizing: border-box; text-align: left; margin: 0px; padding: 0px; font-size: 16px;"><span style="font-size: 16px; color: rgb(79, 79, 79); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: 400; line-height: 26px;">并行order by优化器，在0.12中发布</span></div></td></tr><tr style="outline: 0px; overflow-wrap: break-word; box-sizing: border-box; background-color: rgb(247, 247, 247);"><td style="outline: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; text-align: left; border-color: rgb(221, 221, 221);"><div style="outline: 0px; overflow-wrap: break-word; box-sizing: border-box; text-align: left; margin: 0px; padding: 0px; font-size: 16px;"><span style="font-size: 16px; color: rgb(79, 79, 79); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: 400; line-height: 26px;">CommonJoinResolver + MapJoinResolver</span></div></td><td style="outline: 0px; overflow-wrap: break-word; box-sizing: border-box; font-size: 14px; text-align: left; border-color: rgb(221, 221, 221);"><div style="outline: 0px; overflow-wrap: break-word; box-sizing: border-box; text-align: left; margin: 0px; padding: 0px; font-size: 16px;"><span style="font-size: 16px; color: rgb(79, 79, 79); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: 400; line-height: 26px;">MapJoin优化器</span></div></td></tr></tbody></table><div><br/></div></div><div style="outline: 0px; padding: 0px; overflow-wrap: break-word; margin: 0px 0px 16px; box-sizing: border-box; font-size: 16px;"><span style="font-size: 16px; color: rgb(77, 77, 77); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: 700; line-height: 26px; outline: 0px; overflow-wrap: break-word; box-sizing: border-box;">MapJoin原理</span></div><div style="outline: 0px; padding: 0px; overflow-wrap: break-word; margin: 0px 0px 16px; box-sizing: border-box; font-size: 16px; text-align: center;"><span style="font-size: 16px; color: rgb(77, 77, 77); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: 400; line-height: 26px;"><a href="Hive SQL转化为MapReduce执行计划深度解析_files/mapjoin.png"><img src="Hive SQL转化为MapReduce执行计划深度解析_files/ad092e0acd3437eb6982f1bae7811d15.png" alt="mapjoin.png"></a></span></div><div style="outline: 0px; padding: 0px; overflow-wrap: break-word; margin: 0px 0px 16px; box-sizing: border-box; font-size: 16px;"><span style="font-size: 16px; color: rgb(77, 77, 77); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: 400; line-height: 26px;">MapJoin简单说就是在Map阶段将小表读入内存，顺序扫描大表完成Join。</span></div><div style="outline: 0px; padding: 0px; overflow-wrap: break-word; margin: 0px 0px 16px; box-sizing: border-box; font-size: 16px;"><span style="font-size: 16px; color: rgb(77, 77, 77); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: 400; line-height: 26px;">上图是Hive MapJoin的原理图，出自Facebook工程师Liyin Tang的一篇介绍Join优化的slice，从图中可以看出MapJoin分为两个阶段：</span></div><div style="outline: 0px; margin: 8px 0px 0px 40px; padding: 0px; list-style: decimal; overflow-wrap: break-word; box-sizing: border-box;"><div style="outline: 0px; padding: 0px; overflow-wrap: break-word; margin: 0px 0px 16px; box-sizing: border-box; font-size: 16px;"><span style="font-size: 16px; color: rgb(77, 77, 77); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: 400; line-height: 26px;">通过MapReduce Local Task，将小表读入内存，生成HashTableFiles上传至Distributed Cache中，这里会对HashTableFiles进行压缩。</span></div></div><div style="outline: 0px; margin: 8px 0px 0px 40px; padding: 0px; list-style: decimal; overflow-wrap: break-word; box-sizing: border-box;"><div style="outline: 0px; padding: 0px; overflow-wrap: break-word; margin: 0px 0px 16px; box-sizing: border-box; font-size: 16px;"><span style="font-size: 16px; color: rgb(77, 77, 77); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: 400; line-height: 26px;">MapReduce Job在Map阶段，每个Mapper从Distributed Cache读取HashTableFiles到内存中，顺序扫描大表，在Map阶段直接进行Join，将数据传递给下一个MapReduce任务。</span></div></div><div style="outline: 0px; padding: 0px; overflow-wrap: break-word; margin: 0px 0px 16px; box-sizing: border-box; font-size: 16px;"><span style="font-size: 16px; color: rgb(77, 77, 77); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: 400; line-height: 26px;"> </span></div><h2 style="outline: 0px; padding: 0px; overflow-wrap: break-word; box-sizing: border-box; margin: 8px 0px 16px; font-size: 24px;"><span style="font-size: 24px; color: rgb(79, 79, 79); font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; font-weight: 700; line-height: 32px;">3. 待续</span></h2><div style="outline: 0px; padding: 0px; overflow-wrap: break-word; margin: 0px 0px 16px; box-sizing: border-box; font-size: 16px;"><span style="font-size: 16px; color: rgb(77, 77, 77); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: 400; line-height: 26px;">还有很多没看</span><a href="https://blog.csdn.net/moon_yang_bj/article/details/31744381" style="margin: 0px; padding: 0px; outline: 0px; cursor: pointer; overflow-wrap: break-word; box-sizing: border-box; font-size: 16px; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: normal; line-height: 26px; color: rgb(78, 161, 219); text-decoration: none;">懂</a><span style="font-size: 16px; color: rgb(77, 77, 77); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: 400; line-height: 26px;">的地方，后续再总结和整理进来。</span></div><div style="outline: 0px; padding: 0px; overflow-wrap: break-word; margin: 0px 0px 16px; box-sizing: border-box; font-size: 16px;"><span style="font-size: 16px; color: rgb(77, 77, 77); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: 400; line-height: 26px;"> </span></div><div style="outline: 0px; padding: 0px; overflow-wrap: break-word; margin: 0px 0px 16px; box-sizing: border-box; font-size: 16px;"><span style="font-size: 16px; color: rgb(77, 77, 77); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: 400; line-height: 26px;"> </span></div><div style="outline: 0px; padding: 0px; overflow-wrap: break-word; margin: 0px 0px 16px; box-sizing: border-box; font-size: 16px;"><span style="font-size: 16px; color: rgb(77, 77, 77); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: 400; line-height: 26px;"> </span></div><div style="outline: 0px; padding: 0px; overflow-wrap: break-word; margin: 0px 0px 16px; box-sizing: border-box; font-size: 16px;"><span style="font-size: 16px; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px;"><b><font color="#FF0000"> 还可参考这篇文章: </font></b></span></div><div style="outline: 0px; padding: 0px; overflow-wrap: break-word; margin: 0px 0px 16px; box-sizing: border-box; font-size: 16px;"><b><font color="#FF0000"><span style="font-size: 16px; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px;"><span>    </span></span><span style="font-size: 12pt;"><a href="https://www.jianshu.com/p/660fd157c5eb" style="color: rgb(255, 0, 0);">https://www.jianshu.com/p/660fd157c5eb</a></span></font></b></div><div style="outline: 0px; padding: 0px; overflow-wrap: break-word; margin: 0px 0px 16px; box-sizing: border-box; font-size: 16px;"><span style="font-size: 16px; color: rgb(77, 77, 77); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-weight: 400; line-height: 26px;"> </span></div></div><div style="outline: 0px; box-sizing: inherit; margin: 0px; padding: 0px; overflow-wrap: break-word;"><div style="font-weight:normal;outline:0px;box-sizing:inherit;margin:0px;padding:0px;overflow-wrap:break-word;"></div></div><div style="font-weight: normal; height: 0px; visibility: hidden; clear: both;"></div></div></div></div></div></div></div></div></div><div><br/></div></span>
</div></body></html> 