<html>
<head>
  <title>day4-Scala Actor、AKKA Actor</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/603932 (zh-CN, DDL); Windows/10.0.0 (Win64); EDAMVersion=V2;"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 12pt;
    }
  </style>
</head>
<body>
<a name="8939"/>
<h1>day4-Scala Actor、AKKA Actor</h1>
<div>
<table bgcolor="#D4DDE5" border="0">
<tr><td><b>创建时间：</b></td><td><i>2021/7/3 16:05</i></td></tr>
<tr><td><b>更新时间：</b></td><td><i>2021/7/27 21:38</i></td></tr>
</table>
</div>
<br/>

<div>
<span><div><div>普通的网络编程的流程模型:</div><div><img src="day4-Scala Actor、AKKA Actor_files/Image.png" type="image/png" data-filename="Image.png"/></div><div>RPC模型: RPC最重要的就是把绿框中的两个箭头给封装了, 让客户像在本地调用某功能一样调用远端服务器的功能(详情见pdf)</div><div><img src="day4-Scala Actor、AKKA Actor_files/Image [1].png" type="image/png" data-filename="Image.png"/></div><div><br/></div><hr/><div>Actor:</div><div><span style="color: rgb(166, 0, 196);">Actor位于scala.actors包下</span>,但Scala的Actor类已被弃用。</div><div><span style="color: rgb(255, 0, 0);">Scala的Acto</span><span style="color: rgb(255, 0, 0);">r</span><span style="color: rgb(166, 0, 196);">在使用上</span><span style="color: rgb(255, 0, 0);">就等价于java中的Th</span><span style="font-size: unset; color: rgb(255, 0, 0); font-family: unset;">read类(底层并不一样, Java的Thread是基于加锁和共享内存的并发编程模型, Scala的Actor是基于消息传递的一种并发编程模型), Actor的act方法就等价于</span><span style="color: rgb(255, 0, 0);">Th</span><span style="font-size: unset; color: rgb(255, 0, 0); font-family: unset;">read</span><span style="font-size: unset; color: rgb(255, 0, 0); font-family: unset;">的run方法, </span><span style="font-size: unset; color: rgb(255, 0, 0); font-family: unset;">Actor的</span><span style="font-size: unset; color: rgb(255, 0, 0); font-family: unset;">start方法就等价于Thread类的start方法。</span><span style="font-size: unset; color: unset; font-family: unset;">从下图可以看出, Actor创建线程的方式和Java中Thread类创建线程的方式一模一样。</span></div><div><img src="day4-Scala Actor、AKKA Actor_files/Image [2].png" type="image/png" data-filename="Image.png"/></div><div><br/></div><div>java中每次线程访问共享内存时都需要加锁, 以防止在该线程修改某个资源时,该资源又被其他线程修改了, 并且java中的线程修改资源时, 不是直接在共享内存上修改, 而是先复制一份到线程自己独占的内存中, 再修改, 修改完再放回共享内存中, 所以每次修改共享资源的内容有很多步骤, 并不是原子操作。</div><div>Scala中的线程则通过加锁的方式访问共享内存, 而是通过消息传递的方式访问同一个资源, 比如线程A先修改某资源, 此时线程B也想修改, 得知A在修改后线程B则阻塞等待, 等A修改完该资源后不是放回共享内存中, 而是直接将该资源修改后的结果发送给线程B, 这样, 就省去了线程A将资源放回共享内存, 释放锁, 线程B再取该资源的多个步骤。</div><hr/><div>Akka Actor</div><div>区别于Scala Actor, Scala Actor已被弃用。Akka Actor是用Scala语言编写的, 基于scala Actor的一个rpc框架。</div><div>关于Akka的介绍看下面这个链接以及pdf。</div><div><a href="https://www.iteblog.com/archives/1154.html">https://www.iteblog.com/archives/1154.html</a></div><div>MailBox里面装的就是消息, 归根结底就是一个队列, 一个消息队列。</div><div>Actor是基于消息传递的一种并发模型, Actor放在ActorSystem里,     单例的    通过 actorOf方法能生成  Actor  实例</div><div>Actor非常轻量级, 1GB 的内存中可以运行 上百万的  actor, 所以actor一出现问题, 将直接弃用, 重新创建一个新的</div><div>既然Akka Actor基于scala Actor, 所以Akka Actor发送消息的方式也有以下三种:</div><div>! 发送异步消息，没有返回值。</div><div>!? 发送同步消息，等待返回值。 </div><div>!! 发送异步消息，返回值是 Future[Any]。</div><div><br/></div><div><br/></div><div><span style="font-weight: bold;">Actor和ActorSystem</span></div><div><br/></div><div><img src="day4-Scala Actor、AKKA Actor_files/Image [3].png" type="image/png" data-filename="Image.png"/></div><div><img src="day4-Scala Actor、AKKA Actor_files/Image [4].png" type="image/png" data-filename="Image.png"/></div><div>receive()几乎等同于Scala Actor中的act()方法, 也就是等价于java中Thread类的run()方法。</div><div>preStart()方法是在run()方法之前执行一次, 其实就相当于初始化</div><div><img src="day4-Scala Actor、AKKA Actor_files/Image [5].png" type="image/png" data-filename="Image.png"/></div><div><br/></div><div>------------------------------------------</div><div>案例:</div><div>由于Akka Actor不能直接在scala SDK中找到该类, 所以需要引入这些源码, 所以新建一个maven项目: </div><div><img src="day4-Scala Actor、AKKA Actor_files/Image [6].png" type="image/png" data-filename="Image.png"/></div><div><img src="day4-Scala Actor、AKKA Actor_files/Image [7].png" type="image/png" data-filename="Image.png"/></div><div><img src="day4-Scala Actor、AKKA Actor_files/Image [8].png" type="image/png" data-filename="Image.png"/></div><div>在src/main下新建一个scala目录, 并选中该目录, 右键 -&gt; Maven Directory as -&gt; Resources Root, 使得该目录由普通目录变成源代码目录, 之后再在scala目录下新建package如下: </div><div><img src="day4-Scala Actor、AKKA Actor_files/Image [9].png" type="image/png" data-filename="Image.png"/></div><div>之后由于项目中还没有scala的SDK, 所以还需要导入scala的sdk。</div><div>File -&gt; Project Structure -&gt; Libraries。看到如下图, 找到自己本地想用的scala sdk (可能没显示, 需要去本地目录找一下)。 </div><div><img src="day4-Scala Actor、AKKA Actor_files/Image [10].png" type="image/png" data-filename="Image.png"/></div><div><br/></div><div>在pom.xml文件里添加一些东西:</div><div><img src="day4-Scala Actor、AKKA Actor_files/Image [11].png" type="image/png" data-filename="Image.png"/></div><div>将下面的内容覆盖掉上图的pom.xml中的gav以下的所有内容(如上图阴影部分)</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>&lt;properties&gt;</div><div>    &lt;maven.compiler.source&gt;1.8&lt;/maven.compiler.source&gt;</div><div>    &lt;maven.compiler.target&gt;1.8&lt;/maven.compiler.target&gt;</div><div>    &lt;encoding&gt;UTF-8&lt;/encoding&gt;</div><div>    &lt;scala.version&gt;2.11.8&lt;/scala.version&gt;</div><div>    &lt;akka.version&gt;2.4.17&lt;/akka.version&gt;</div><div>  &lt;/properties&gt;</div><div><br/></div><div><br/></div><div>  &lt;dependencies&gt;</div><div>    &lt;dependency&gt;</div><div>      &lt;groupId&gt;org.scala-lang&lt;/groupId&gt;</div><div>      &lt;artifactId&gt;scala-library&lt;/artifactId&gt;</div><div>      &lt;version&gt;${scala.version}&lt;/version&gt;</div><div>    &lt;/dependency&gt;</div><div><br/></div><div><br/></div><div>    &lt;dependency&gt;</div><div>      &lt;groupId&gt;com.typesafe.akka&lt;/groupId&gt;</div><div>      &lt;artifactId&gt;akka-actor_2.11&lt;/artifactId&gt;</div><div>      &lt;version&gt;${akka.version}&lt;/version&gt;</div><div>    &lt;/dependency&gt;</div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div>    &lt;dependency&gt;</div><div>      &lt;groupId&gt;com.typesafe.akka&lt;/groupId&gt;</div><div>      &lt;artifactId&gt;akka-remote_2.11&lt;/artifactId&gt;</div><div>      &lt;version&gt;${akka.version}&lt;/version&gt;</div><div>    &lt;/dependency&gt;</div><div><br/></div><div><br/></div><div>    &lt;!-- https://mvnrepository.com/artifact/org.apache.hadoop/hadoop-client --&gt;</div><div>    &lt;dependency&gt;</div><div>      &lt;groupId&gt;org.apache.hadoop&lt;/groupId&gt;</div><div>      &lt;artifactId&gt;hadoop-client&lt;/artifactId&gt;</div><div>      &lt;version&gt;2.6.5&lt;/version&gt;</div><div>    &lt;/dependency&gt;</div><div><br/></div><div><br/></div><div>  &lt;/dependencies&gt;</div><div><br/></div><div><br/></div><div>  &lt;build&gt;</div><div>    &lt;pluginManagement&gt;</div><div>      &lt;plugins&gt;</div><div>        &lt;plugin&gt;</div><div>          &lt;groupId&gt;net.alchim31.maven&lt;/groupId&gt;</div><div>          &lt;artifactId&gt;scala-maven-plugin&lt;/artifactId&gt;</div><div>          &lt;version&gt;3.2.2&lt;/version&gt;</div><div>        &lt;/plugin&gt;</div><div>        &lt;plugin&gt;</div><div>          &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;</div><div>          &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;</div><div>          &lt;version&gt;3.5.1&lt;/version&gt;</div><div>        &lt;/plugin&gt;</div><div>      &lt;/plugins&gt;</div><div>    &lt;/pluginManagement&gt;</div><div>    &lt;plugins&gt;</div><div>      &lt;plugin&gt;</div><div>        &lt;groupId&gt;net.alchim31.maven&lt;/groupId&gt;</div><div>        &lt;artifactId&gt;scala-maven-plugin&lt;/artifactId&gt;</div><div>        &lt;executions&gt;</div><div>          &lt;execution&gt;</div><div>            &lt;id&gt;scala-compile-first&lt;/id&gt;</div><div>            &lt;phase&gt;process-resources&lt;/phase&gt;</div><div>            &lt;goals&gt;</div><div>              &lt;goal&gt;add-source&lt;/goal&gt;</div><div>              &lt;goal&gt;compile&lt;/goal&gt;</div><div>            &lt;/goals&gt;</div><div>          &lt;/execution&gt;</div><div>          &lt;execution&gt;</div><div>            &lt;id&gt;scala-test-compile&lt;/id&gt;</div><div>            &lt;phase&gt;process-test-resources&lt;/phase&gt;</div><div>            &lt;goals&gt;</div><div>              &lt;goal&gt;testCompile&lt;/goal&gt;</div><div>            &lt;/goals&gt;</div><div>          &lt;/execution&gt;</div><div>        &lt;/executions&gt;</div><div>      &lt;/plugin&gt;</div><div><br/></div><div><br/></div><div>      &lt;plugin&gt;</div><div>        &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;</div><div>        &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;</div><div>        &lt;executions&gt;</div><div>          &lt;execution&gt;</div><div>            &lt;phase&gt;compile&lt;/phase&gt;</div><div>            &lt;goals&gt;</div><div>              &lt;goal&gt;compile&lt;/goal&gt;</div><div>            &lt;/goals&gt;</div><div>          &lt;/execution&gt;</div><div>        &lt;/executions&gt;</div><div>      &lt;/plugin&gt;</div><div><br/></div><div><br/></div><div>      &lt;plugin&gt;</div><div>        &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;</div><div>        &lt;artifactId&gt;maven-shade-plugin&lt;/artifactId&gt;</div><div>        &lt;version&gt;2.4.3&lt;/version&gt;</div><div>        &lt;executions&gt;</div><div>          &lt;execution&gt;</div><div>            &lt;phase&gt;package&lt;/phase&gt;</div><div>            &lt;goals&gt;</div><div>              &lt;goal&gt;shade&lt;/goal&gt;</div><div>            &lt;/goals&gt;</div><div>            &lt;configuration&gt;</div><div>              &lt;filters&gt;</div><div>                &lt;filter&gt;</div><div>                  &lt;artifact&gt;*:*&lt;/artifact&gt;</div><div>                  &lt;excludes&gt;</div><div>                    &lt;exclude&gt;META-INF/*.SF&lt;/exclude&gt;</div><div>                    &lt;exclude&gt;META-INF/*.DSA&lt;/exclude&gt;</div><div>                    &lt;exclude&gt;META-INF/*.RSA&lt;/exclude&gt;</div><div>                  &lt;/excludes&gt;</div><div>                &lt;/filter&gt;</div><div>              &lt;/filters&gt;</div><div>            &lt;/configuration&gt;</div><div>          &lt;/execution&gt;</div><div>        &lt;/executions&gt;</div><div>      &lt;/plugin&gt;</div><div>    &lt;/plugins&gt;</div><div>  &lt;/build&gt;</div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div>&lt;/project&gt;</div></div><div><br/></div><div><br/></div><div><br/></div><div><a href="day4-Scala Actor、AKKA Actor_files/scala-part4-RPC远程过程调用.pdf"><img src="day4-Scala Actor、AKKA Actor_files/7726a94592f92df30ffa6cc01096e9d5.png" alt="scala-part4-RPC远程过程调用.pdf"></a></div><div><br/></div></div><div><br/></div></span>
</div></body></html> 