<html>
<head>
  <title>day5-数据库设计、数据库优化、MySQL的远程连接的实现、备份和还原、JDBC、dao开发</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/603932 (zh-CN, DDL); Windows/10.0.0 (Win64); EDAMVersion=V2;"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 12pt;
    }
  </style>
</head>
<body>
<a name="4797"/>
<h1>day5-数据库设计、数据库优化、MySQL的远程连接的实现、备份和还原、JDBC、dao开发</h1>
<div>
<table bgcolor="#D4DDE5" border="0">
<tr><td><b>创建时间：</b></td><td><i>2020/4/19 9:41</i></td></tr>
<tr><td><b>更新时间：</b></td><td><i>2021/9/2 11:44</i></td></tr>
</table>
</div>
<br/>

<div>
<span><div><span style="font-weight: bold;">1.数据库设计</span></div><div>  1.1 三个范式</div><div>     1NF:强调列的原子性(域原子性),保证每一列都是单一属性且不可再分的</div><div>     2NF: 在满足1NF的基础上再满足依赖性: <span style="font-size: 16px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(77, 77, 77); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif; font-variant-caps: normal; font-variant-ligatures: no-common-ligatures;">非主键类必须完全依赖于主键，而不能只依赖主键的一部分</span>(主要针对联合主键而言?)</div><div>     3NF: 在满足2NF的基础上再满足: <span style="font-size: 16px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(77, 77, 77); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif; font-variant-caps: normal; font-variant-ligatures: no-common-ligatures;">非主键列必须直接依赖于主键，不能存在传递依赖。</span> (<span style="font-size: 13px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(75, 75, 75); font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">确保每列都和主键列直接相关,而不是间接相关)</span></div><div>  1.2 ER图:实体关系图</div><div>  1.3 实体之间关系</div><div>      一对一</div><div>      一对多(多对一)</div><div>      多对多</div><div>  1.4 表的设计</div><div>      实现两张表的一对一的关系:</div><div>        方法1: 先让一张更重要的表(主表)的主键作为次表的外键,再对次表的该外键添加唯一约束,这样就能形成两张表的一对一关系了</div><div>                    <img src="day5-数据库设计、数据库优化、MySQL的远程连接的实现、备份和还原、JDBC、dao_files/Image.png" type="image/png" data-filename="Image.png" width="346"/></div><div>        方法2: 让次表的主键同时做外键,也能保证外键不重复出现引用主表的值,也可以保证两张表是一对一的关系</div><div>                    <img src="day5-数据库设计、数据库优化、MySQL的远程连接的实现、备份和还原、JDBC、dao_files/Image [1].png" type="image/png" data-filename="Image.png"/></div><div>      实现两张表的一对多的关系: </div><div>        添加外键即可,外键是添加在&quot;多&quot;方</div><div>      实现两张表的多对多的关系: </div><div>        方法: 添加第三张表维护关系,其中第三张表的两个字段分别是前两张表的主键做的外键,并将这</div><div>                    两个外键添加为联合主键(保证实体完整性)</div><div><br/></div><div><br/></div><div><br/></div><div><span style="font-weight: bold;">2.数据库优化 </span>  </div><div>  1.先筛选再join(连接、联合。也就是指表连接查询)</div><div>  2.join一般优于子查询(sql层级越深效率越低)</div><div>  3.order by 少用(造成io瓶颈,cpu占用太多)  </div><div>  4.写sql的时候尽量让查询走索引,不要有索引不用查了别的(出现索引失效状况)        </div><div>  5.尽量不要使用select(*)</div><div>  </div><div>  具体使用:</div><div>  1.在查询时尽量不要使用select(*)</div><div>    *是通配符,会先查询该表的所有字段名称,然后继续剩余操作。(即使把全表的字段名称都写一遍也优于写select(*))</div><div>    误区:</div><div>      1.select a,b from table和select a,b,c from table</div><div>        查询以记录为单位。所以上表并不是前面的语句性能优于后面,而是性能一样的</div><div>      2.select count(*)、count(1)、count(主键) </div><div>        三者含义不同但结果一致。count(1)、count(主键)的性能一般是优于count(*)的</div><div>        但count(1)和count(主键)不是在所有情况优于count(*)</div><div><span style="color: rgb(166, 0, 196);">        注意: count(1)不是只可以是数字1, 里面写任何数字都和写count(1)效果一样, 如count(0)、count(1.5)都等价于count(1)。</span></div><div>  2.尽量避免导致索引失效的状况: (以下情况若不遵守 ,都可以导致索引列失效)</div><div>    1.使用索引列时不能在条件语句中使用否定,如使用 null / not null / != / &lt;&gt;等</div><div>    2.使用索引列时不要参与计算或者使用函数(如不要使用四则运算,substr()等) </div><div>            如:                      select * from emp where sal/10&gt;100; (假如sal是索引列,那么这个索引已经失效了)</div><div>            优化后的写法是: select * from emp where sal&gt;100*10;</div><div>    3.使用索引列时不要使用'包含'或者模糊查询(like)</div><div>            如: select * from emp where name like '%h%'; (假如name是索引列,那么这个索引已经失效了)</div><div>            但: select * from emp where name like 'h%'; (这样索引就没有失效了 ,但效率仍旧是降低了)</div><div>            并且: select * from emp where name = 'mike';(使用精确查询的效率当然是优于模糊查询的,&quot;=&quot;必然优于&quot;like&quot;)</div><div>    4.使用索引列时尽量不要使用or(使用or也会使索引失效, 应该使用union/union all来代</div><div>                                                    替or。其中union all 优于union ,因为不用去重)    </div><div>            </div><div><span style="font-weight: bold;">3.MySQL如何允许远程连接</span>(首先要先看看防火墙的3306端口是否,开启)</div><div>  方法1.在连接了mysql 服务器中找到mysql库，并找到该库里的user表中,host字段都默认绑定localhost,将其修改为%。</div><div>            (但这里毕竟是修改了root用户的权限,要小心安全问题)</div><div>        在连接的mysql库中的user表中有显示host字段,不改的话当前主机的mysql只能连接localhost的用户,不支持远程连接</div><div>    <img src="day5-数据库设计、数据库优化、MySQL的远程连接的实现、备份和还原、JDBC、dao_files/Image [2].png" type="image/png" data-filename="Image.png"/></div><div>    修改方法:</div><div>        update user set Host = '%' where User = 'root';    #(&quot;%&quot;表示通配符,意思就是所有皆可,就像它在查询里的意思一样)</div><div>        flush privileges;  #上面是修改了权限,修改了权限光修改时不够的,需要立即刷新一下权限</div><div>       这时候再直接新建一个连接,如下图,192.168.5.226是路由器分配的IP地址,即ipconfig出来的路由地址,这时候也能直接连接上</div><div>            本机Windows系统里的MySQL服务器了（<span style="color: rgb(166, 0, 196);">这种用路由器（或者说网关）分配的ip地址连接mysql的方式也是远程连接</span>）</div><div>        <img src="day5-数据库设计、数据库优化、MySQL的远程连接的实现、备份和还原、JDBC、dao_files/Image [3].png" type="image/png" data-filename="Image.png" width="446"/></div><div><br/></div><div>    方法2. 专门给某个mysql的用户设置为可以远程访问的用户,并给其设置远程访问时登录的密码(该密码不一定要是本地登录的密码)</div><div>        grant all privileges on *.* to 'root'@'%' identified by 'root'</div><div>        with grant option;</div><div>        flush privileges;</div><div>        意义如下:<img src="day5-数据库设计、数据库优化、MySQL的远程连接的实现、备份和还原、JDBC、dao_files/Image [4].png" type="image/png" data-filename="Image.png"/></div><div>授权之后user表变为如下,新增的一行为远程登录的账号:</div><div><img src="day5-数据库设计、数据库优化、MySQL的远程连接的实现、备份和还原、JDBC、dao_files/Image [5].png" type="image/png" data-filename="Image.png"/></div><div><br/></div><div><span style="color: rgb(255, 0, 0);">    </span><span style="color: rgb(255, 0, 0);">  </span> <span style="color: rgb(166, 0, 196);">如果赋予了某虚拟机远程登陆权限，则可以直接在Windows上用主机名或网关分配的ip地址就能连接该虚拟机的mysql，如果没有</span><span style="font-size: unset; color: rgb(166, 0, 196); font-family: unset;">设置远程登录权限，则在Windows上连接不了该虚拟机的mysql，该虚拟机里的mysql只能被该虚拟机</span><span style="font-size: unset; color: rgb(166, 0, 196); font-family: unset;">自己的某软件通过网卡上的本机回环地址连接。Windows系统上的mysql也是一样的，如果没有远程登录权限，则不能被其他主机访问，也不能在自己主机上直接用网关分配的ip地址登录，因为网关分配的ip是由路由器给的，连接mysql的软件访问网卡，网卡还要访问路由器，这种间接得到ip地址的方式也是远程登录</span></div><div>下图是未设置远程登录权限的Windows中的mysql中的mysql库的user表（此时是不能用网关分配的ip地址连接该数据库的，只能用localhost或127.0.0.1连接该数据库）：</div><div><img src="day5-数据库设计、数据库优化、MySQL的远程连接的实现、备份和还原、JDBC、dao_files/Image [6].png" type="image/png" data-filename="Image.png"/></div><div>下图是已经用方法2赋予了远程登录权限的虚拟机中的mysql中的mysql库的user表（我的hadoop集群中，不管是哪台虚拟机，表都是如下图所示，其中赋予远程访问权限的方式与方法二的语句一模一样）：</div><div><img src="day5-数据库设计、数据库优化、MySQL的远程连接的实现、备份和还原、JDBC、dao_files/Image [7].png" type="image/png" data-filename="Image.png"/></div><div>观察上面两图，可以发现虚拟机中已经有很多方式可以连接该虚拟机的mysql，即支持远程连接；而Windows中则只能用localhost或127.0.0.1连接mysql，即还不支持远程连接。</div><div><br/></div><div><br/></div><div><span style="font-weight: bold;">4.备份和还原</span>(在cmd里直接执行的,不需要先登录MySQL)</div><div>  备份:</div><div>    mysqldump -uroot -p dbname tname <span style="color: rgb(166, 0, 196);">&gt;</span> d:/a.sql</div><div>    其中:mysqldump是备份的命令; -uroot -p(root)表示用root用户的身份登录mysql; dbname表示要备份的数据库;</div><div>            &gt;表示重定向的意思,重定向到d:/a.sql这个本地地址中去,也就是保存(引用)到这个本地地址中去,</div><div>            因为&quot;mysqldump -uroot -proot dbname tname&quot;是以引用的形式存在,还没有备份到具体的地址,而&quot;&gt;&quot;和&quot;d:/a.sql&quot;</div><div>            就是起这个作用的。</div><div><br/></div><div>  还原:(将备份好的数据还原到mysql服务器中)</div><div>    mysql -uroot -proot <span style="color: rgb(166, 0, 196);">&lt;</span> d:/a.sql    #&quot;&gt;&quot;是输出;&quot;&lt;&quot;是输入</div><div>    先登录到mysql数据库再还原数据的命令是: source d:/a.sql</div><div><br/></div><div><span style="font-weight: bold;">5.JDBC</span></div><div>1.什么是JDBC(java database connectivity)</div><div>  sun提出的用于java连接数据库的统一规范,主要由一系列接口组成。</div><div>    如果程序员想用每次都用同一套代码来实现对不同数据库的操作, 就可以用到jdbc。不然的话每次都要写不同的代码连接</div><div>    不同的数据库服务器</div><div>  <img src="day5-数据库设计、数据库优化、MySQL的远程连接的实现、备份和还原、JDBC、dao_files/Image [8].png" type="image/png" data-filename="Image.png" width="970"/></div><div>  进行jdbc开发的前提:</div><div>    写好jdbc接口:在 jdk中(java.sql / javax.sql)</div><div>    找到不同数据库驱动: 即不同数据库的具体代码实现(由数据库厂商提供)</div><div>2.jdbc实现原理</div><div>    <img src="day5-数据库设计、数据库优化、MySQL的远程连接的实现、备份和还原、JDBC、dao_files/Image [9].png" type="image/png" data-filename="Image.png"/></div><div>3.JDBC的开发步骤</div><div>  1.注册驱动(即上图的JDBC Driver, 目的是要让jdbc知道我们要连接的是哪个数据库)</div><div>  2.获取连接</div><div>  3.给数据库服务器发送sql命令</div><div>  4.获取响应数据并处理</div><div>  5.释放资源(即关闭连接。如果不释放其他的客户端就没法连接该数据库服务器了)</div><div>4.入门案例</div><div>  4.1 创建一个java程序,然后导入MySQL的jdbc的驱动(JDBC Driver)的jar包, 这个在安装完MySQL的时候就提供了,</div><div>        在如下目录</div><div>    <img src="day5-数据库设计、数据库优化、MySQL的远程连接的实现、备份和还原、JDBC、dao_files/Image [10].png" type="image/png" data-filename="Image.png"/></div><div>    将上面这个文件复制到创建的项目中去(新建一个lib文件夹,将其放在其中)。并且右键该文件, 通过&quot;Add to Build Path&quot;将</div><div>    这个jar包引用到项目中</div><div>    <img src="day5-数据库设计、数据库优化、MySQL的远程连接的实现、备份和还原、JDBC、dao_files/Image [11].png" type="image/png" data-filename="Image.png" width="553"/></div><div>    结果如图所示:</div><div>    <img src="day5-数据库设计、数据库优化、MySQL的远程连接的实现、备份和还原、JDBC、dao_files/Image [12].png" type="image/png" data-filename="Image.png"/></div><div><br/></div><div>  4.2 注册驱动</div><div>  4.3 获取连接(java程序和mysql服务器建立连接)</div><div>    如何获取连接?</div><div>      类似于我们访问百度时的url(统一资源定位符):</div><div>      <a href="http://www.baidu.com/">http://www.baidu.com:80</a></div><div>        而在百度搜索&quot;斗鱼直播&quot;时的url是:  http://www.baidu.com/s?wd=斗鱼直播&amp;rsv_spt=1&amp;...</div><div>        即说明访问网站的url格式是:  <a href="prot://ip:port/path?k1=v1&amp;k2=v2">prot://ip:port/path</a><a href="prot://ip:port/path?k1=v1&amp;k2=v2" style="color: rgb(255, 0, 0);">?</a>k1=v1&amp;k2=v2</div><div>        我们连接数据库服务器的url格式是类似的,是: 协议:子协议://端口/具体的数据库名<span style="color: rgb(166, 0, 196);">?</span>用户名=xxx&amp;密码=xxx</div><div>      则访问我们mysql创建好的数据库的url就是:  jdbc:<a href="mysql://localhost:3306/bd1811?user=root&amp;password=root">mysql://localhost:3306/bd1811?user=root&amp;password=root</a> </div><div>    同样的,访问其他数据库也类似。</div><div>        连接oracle数据库的url是:  jdbc:oracle:thin://localhost:1521/具体的数据库名?用户名=xxx&amp;密码=xxx</div><div><br/></div><div>        http:// 超文本传输协议(html文档)  明文传输(所有内容都可见)</div><div>        https://  SSL/TLS:校验,密文传输</div><div>      所以访问我们mysql创建好的数据库的url最好加一个SSL,使用加密传输:</div><div>                jdbc:<a href="mysql://localhost:3306/bd1811?user=root&amp;password=root">mysql://localhost:3306/bd1811?user=root&amp;password=root</a>&amp;useSSL=true </div><div><br/></div><div>   4.4 发送sql命令(可以直接将java程序当成MySQL的客户端了)</div><div>   4.5 释放资源</div><div>    具体代码如下:详情见eclipse的workplace为&quot;F:\Java\eclipse_workplace_ALL\MySQL网课代码&quot;下的项目JdbcDemo下的test包的</div><div>        Test.java文件</div><div>        <img src="day5-数据库设计、数据库优化、MySQL的远程连接的实现、备份和还原、JDBC、dao_files/Image [13].png" type="image/png" data-filename="Image.png" width="934"/></div><div>        <img src="day5-数据库设计、数据库优化、MySQL的远程连接的实现、备份和还原、JDBC、dao_files/Image [14].png" type="image/png" data-filename="Image.png" width="933"/></div><div>5.sql注入问题</div><div>  sql注入:利用SQL语句,绕开sql运算规则,使得程序无法正确校验</div><div>     原因:sql拼接导致校验规则被修改</div><div>  statement对象发送的是静态sql(也就是确定的,一段完整的已固定的sql)  </div><div>        以下代码是使用statement对象模仿网站登录时的数据库访问   </div><div><img src="day5-数据库设计、数据库优化、MySQL的远程连接的实现、备份和还原、JDBC、dao_files/Image [15].png" type="image/png" data-filename="Image.png"/></div><div><img src="day5-数据库设计、数据库优化、MySQL的远程连接的实现、备份和还原、JDBC、dao_files/Image [16].png" type="image/png" data-filename="Image.png"/></div><div><img src="day5-数据库设计、数据库优化、MySQL的远程连接的实现、备份和还原、JDBC、dao_files/Image [17].png" type="image/png" data-filename="Image.png"/></div><div><img src="day5-数据库设计、数据库优化、MySQL的远程连接的实现、备份和还原、JDBC、dao_files/Image [18].png" type="image/png" data-filename="Image.png" width="1097"/></div><div><br/></div><div>  所以引入PreparedStatement接口: 他是Statement的子接口</div><div>        PreparedStatement的好处是可以先对sql执行预编译,动态实现赋值</div><div>      以下代码是用PreparedStatement来解决上一个login方法中因为使用了字符串拼接导致改变了原有的sql规则的问题</div><div>        新写了一个login2方法,其中改变的只有以下部分:</div><div><img src="day5-数据库设计、数据库优化、MySQL的远程连接的实现、备份和还原、JDBC、dao_files/Image [19].png" type="image/png" data-filename="Image.png"/> </div><div><span style="color: rgb(166, 0, 196);">这些代码的详情见eclipse的workplace为&quot;F:\Java\eclipse_workplace_ALL\MySQL网课代码&quot;下的项目JdbcDemo下的test</span></div><div><span style="color: rgb(166, 0, 196);">        包的</span><span style="color: rgb(166, 0, 196);">Test.java文件</span></div><div>6.dao的开发</div><div>  (1)</div><div>  分层开发的具体:<img src="day5-数据库设计、数据库优化、MySQL的远程连接的实现、备份和还原、JDBC、dao_files/Image [20].png" type="image/png" data-filename="Image.png" width="1040"/>    </div><div>    早期的web架构图,这也是为什么分层开发的由来?<img src="day5-数据库设计、数据库优化、MySQL的远程连接的实现、备份和还原、JDBC、dao_files/Image [21].png" type="image/png" data-filename="Image.png" width="934"/></div><div><br/></div><div> (2)dao的面向接口开发</div><div>    一个接口 + 一个或多个实现类  </div><div>    </div><div>    面向接口开发的体现,就是: 当实例化接口类时,new的是该接口的实现类,这样的话,实现类里的具体东西进行修改就对他完全没有影响了</div><div>    如下图:其中StuDao是接口类,StuDaoImpl是StuDao的实现类</div><div>     <img src="day5-数据库设计、数据库优化、MySQL的远程连接的实现、备份和还原、JDBC、dao_files/Image [22].png" type="image/png" data-filename="Image.png"/> </div><div><span style="color: rgb(166, 0, 196);">具体代码的详情见eclipse的workplace为&quot;F:\Java\eclipse_workplace_ALL\MySQL网课代码&quot;下的项目JdbcDemo下的dao</span></div><div><span style="color: rgb(166, 0, 196);">        包、entity包和test包下的所有内容(test.java类就只有主方法是相关的,其他方法都是前面的内容的代码)。其中dao/impl包</span></div><div><span style="color: rgb(166, 0, 196);">        下的</span><span style="color: rgb(166, 0, 196);">StuDaoImpl2类和</span><span style="color: rgb(166, 0, 196);">StuDaoImpl3类是</span><span style="color: rgb(166, 0, 196);">StuDaoImpl类的代码优化而已</span></div><div>    更加松耦合的方式如下: 其中类D是接口类, 类B和类E是D的两个不同的实现类,当类A需要调用类D的方法由类B中的实现变为</div><div>        类E中的实现时,类似于上图的这种写法 D d = new B();是要改这句代码的,要将这句改为D d = new E(); 而改原码是不方便的, </div><div>        更好的方法是如下图类A的做法,在成员变量里只定义一个 类D的对象, 而在其构造方法里来传入具体使用的是哪个实现类,给类</div><div>        A传哪个,它就调用哪个实现类。</div><div>        <img src="day5-数据库设计、数据库优化、MySQL的远程连接的实现、备份和还原、JDBC、dao_files/Image [23].png" type="image/png" data-filename="Image.png"/></div><div>        <img src="day5-数据库设计、数据库优化、MySQL的远程连接的实现、备份和还原、JDBC、dao_files/Image [24].png" type="image/png" data-filename="Image.png"/></div><div>        <img src="day5-数据库设计、数据库优化、MySQL的远程连接的实现、备份和还原、JDBC、dao_files/Image [25].png" type="image/png" data-filename="Image.png"/>     </div><div>      </div><div>      </div><div>      </div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div>        </div><div>      </div><div>      </div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div>      </div></span>
</div></body></html> 